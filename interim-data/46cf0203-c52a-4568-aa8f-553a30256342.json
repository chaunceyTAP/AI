{"guid":"46cf0203-c52a-4568-aa8f-553a30256342","title":"JavaScript scripts and templates","path":"help\\workflow\\using\\javascript-scripts-and-templates.md","fullText":"---\nproduct: campaign\ntitle: JavaScript scripts and templates\ndescription: JavaScript scripts and templates\nfeature: Workflows\nexl-id: 4a3647d1-cf8c-4867-871e-472287be7c6a\n---\n# JavaScript scripts and templates{#javascript-scripts-and-templates}\n\n\n\nScripts make it possible to calculate values, exchange data between different tasks in the process and to execute specific operations using SOAP calls.\n\nScripts are ubiquitous in a workflow diagram:\n\n* All activities have initialization scripts. An initialization script is executed when the activity is activated and can be used to initialize variables and to modify the properties.\n* The 'JavaScript code' activity is simply used to execute a script.\n* The 'Test' activity evaluates JavaScript expressions in order to activate the appropriate transition.\n* Most text fields are JavaScript templates: JavaScript expressions can be included between <%= and %>. These fields offer a button that opens a drop-down list to help you enter expressions.\n\n  ![](assets/script-button.png)\n\n## Objects exposed {#objects-exposed}\n\nJavaScripts executed in the context of a workflow access a series of additional global objects.\n\n* **instance**: Represents the workflow being executed. The schema of this object is **xtk:workflow**.\n* **task**: Represents the tasks being executed. The schema of this object is **xtk:workflowTask**.\n* **event**: Represents the events that activated the task being executed. The schema of this object is **xtk:workflowEvent**. This object is not initialized for **AND-join** type activities that have been activated from multiple transitions.\n* **events**: Represents the list of events which activated the current task. The schema of this object is **xtk:workflowEvent**. This table usually contains one element but may contain several for **AND-join** type activities which have been activated based on several transitions.\n* **activity**: Represents the model of the task being executed. The schema of this object depends on the activity type. This object can be modified by the initialization script, in other scripts, modifications with have indeterminable effects.\n\nThe properties available for these objects are can be viewed in a drop-down list by clicking the button at the right of the script toolbar.\n\n>[!CAUTION]\n>\n>The properties of these objects are read-only except for the sub-properties of the vars property. \n>  \n>Most of these properties are only updated after executing an elementary task or when the instance is passivated. The values that are read do not necessarily match the current status but the previous status.\n\n**Example**\n\nIn this example, and in the following examples, create a workflow that includes a **JavaScript code** activity and an **End** activity as shown in the following diagram.\n\n![](assets/script-1.png)\n\nDouble-click the **JavaScript code** activity and insert the following script:\n\n```\nlogInfo(\"Label: \" + instance.label)\nlogInfo(\"Start date: \" + task.creationDate)\n```\n\nThe **[!UICONTROL logInfo(message)]** function inserts a message into the log.\n\nClick **[!UICONTROL OK]** to close the creation wizard, then start the workflow using the action buttons situated at the top right of the list of workflows. At the end of execution, consult the log. You should see two messages corresponding to the script: one displays the label of the workflow, the other displays the date that the script was activated.\n\n## Variables {#variables}\n\nThe variables are the free properties of the **[!UICONTROL instance]**, **[!UICONTROL task]** and **[!UICONTROL event]** objects. The JavaScript types authorized for these variables are **[!UICONTROL string]**, **[!UICONTROL number]** and **[!UICONTROL Date]**.\n\n### Instance variables {#instance-variables}\n\nThe instance variables (**[!UICONTROL instance.vars.xxx]**) are comparable to global variables. They are shared by all activities.\n\n### Task variables {#task-variables}\n\nThe task variables (**[!UICONTROL task.vars.xxx]**) are comparable to local variables. They are only used by the current task. These variables are used by persistent activities to keep data and are sometimes used to exchange data between the different scripts of a same activity.\n\n### Event variables {#event-variables}\n\nThe event variables (**[!UICONTROL vars.xxx]**) enable the exchange of data between the elementary tasks of a workflow process. These variables are passed by the task that activated the task in progress. It is possible to modify them and to define new ones. They are then passed to the following activities.\n\n>[!CAUTION]\n>\n>In the case of [AND-join](and-join.md) type activities, the variables are merged but if a same variable is defined twice, there is a conflict and the value remains undetermined.\n\nEvent are the most often used variables, and they should be used in preference to instance variables.\n\nCertain event variables are modified or read by the various activities. These are all string-type variables. For example, an export sets the **[!UICONTROL vars.filename]** variable with the full name of the file that has just been exported. All these read or modified variables are documented in [About activities](about-activities.md), in the sections **Input parameters** and **Output parameters** of the activities.\n\n### Use cases {#example}\n\n>[!NOTE]\n>\n>Additional workflow use cases are available in [this section](about-workflow-use-cases.md).\n\n**Example 1**\n\nIn this example, an instance variable is used to compute dynamically the split percentage to apply on a population.\n\n1. Create a workflow and add a Start activity.\n\n1. Add and configure a JavaScript code activity to define an instance variable.\n\n    For example: `instance.vars.segmentpercent = 10;`\n\n    ![](assets/js_ex1.png)\n\n1. Add a Query activity and target recipients according to your needs.\n\n1. Add a Split activity and configure it to perform a random sampling of the incoming population. The sampling percentage can be anything of your choice. It is set to 50% in this example.\n\n    It is this percentage which is updated dynamically thanks to the instance variable defined previously.\n\n    ![](assets/js_ex2.png)\n\n1. Inside the Initialization script section of the Advanced tab of the Split activity, define a JS condition. The JS condition selects the random sampling percentage of the first transition coming out of the Split activity and updates it to a value set by the instance variable created previously.\n\n    ```\n    activity.transitions.extractOutput[0].limiter.percent = instance.vars.segmentpercent;\n    ```\n\n    ![](assets/js_ex3.png)\n\n1. Make sure that the complement is generated in a separate transition of the Split activity and add End activities after each of the outbound transitions.\n\n1. Save and execute the workflow. The dynamic sampling gets applied according to the instance variable.\n\n    ![](assets/js_ex4.png)\n\n**Example 2**\n\n1. Take the workflow from the preceding example and replace the script of the **JavaScript Code** activity with the following script:\n\n    ```\n    instance.vars.foo = \"bar1\"\n    vars.foo = \"bar2\"\n    task.vars.foo = \"bar3\"\n    ```\n\n1. Add the following script to the initialization script of the **End** activity:\n\n    ```\n    logInfo(\"instance.vars.foo = \" + instance.vars.foo)\n    logInfo(\"vars.foo = \" + vars.foo)\n    logInfo(\"task.vars.foo = \" + task.vars.foo)\n    ```\n\n1. Start the workflow, and then look at the log.\n\n    ```\n    Workflow finished\n    task.vars.foo = undefined\n    vars.foo = bar2\n    instance.vars.foo = bar1\n    Starting workflow (operator 'admin')\n    ```\n\nThis example shows that the activity following **JavaScript Code** accesses the instance variables and event variables, but the task variables are not accessible from the outside ('undefined').\n\n### Calling an instance variable in a query {#calling-an-instance-variable-in-a-query}\n\nOnce you have specified an instance variable in an activity, you can re-use it in a workflow query.\n\nThus, to call a variable **instance.vars.xxx = \"yyy\"** in a filter, enter **$(instance/vars/xxx)**.\n\nFor example:\n\n1. Create an instance variable that defines a delivery's internal name via the **[!UICONTROL JavaScript code]**: **instance.vars.deliveryIN = \"DM42\"**.\n\n   ![](assets/wkf_js_activity_1.png)\n\n1. Create a query whose targeting and filtering dimensions are the recipients. In the conditions, specify that you would like to find all the recipients that were sent the delivery specified by the variable.\n\n   As a reminder, this information is stored in the delivery logs.\n\n   To reference the instance variable in the **[!UICONTROL Value]** column, enter **$(instance/vars/@deliveryIN)**.\n\n   The workflow will return the recipients of the DM42 delivery.\n\n   ![](assets/wkf_var_in_query.png)\n\n## Advanced functions {#advanced-functions}\n\nIn addition to the standard JavaScript functions, special functions are available for manipulating files, reading or modifying data in the database, or adding messages to the log.\n\n### Journal {#journal}\n\n**[!UICONTROL logInfo(message)]** was detailed in the above examples. This function adds an information message to the journal.\n\n**[!UICONTROL logError(message)]** adds an error message to the log. The script interrupts its execution and the workflow changes to error status (by default, the instance will be paused).\n\n## Initialization script {#initialization-script}\n\nUnder certain conditions, you can modify a property of an activity at the time of execution.\n\nMost properties of activities can be calculated dynamically, either using a JavaScript template or because the workflow properties explicitly allow the value to be calculated by a script.\n\nFor other properties, however, you must use the initialization script. This script is evaluated before the task is executed. The **[!UICONTROL activity]** variable references the activity corresponding to the task. The properties of this activity can be modified and will affect this task only.\n\n**Related topics**\n[Examples of JavaScript code in workflows](javascript-in-workflows.md)\n","headers":[["title","JavaScript scripts and templates"],["description","JavaScript scripts and templates"],["feature","Workflows"]],"sections":[{"section":"JavaScript scripts and templates","sectionId":"cb3c47e7-0f6b-4e97-aead-fbad8650ca23","paragraphs":["Scripts make it possible to calculate values, exchange data between different tasks in the process and to execute specific operations using SOAP calls.","Scripts are ubiquitous in a workflow diagram:","All activities have initialization scripts. An initialization script is executed when the activity is activated and can be used to initialize variables and to modify the properties.","The 'JavaScript code' activity is simply used to execute a script.","The 'Test' activity evaluates JavaScript expressions in order to activate the appropriate transition.","Most text fields are JavaScript templates: JavaScript expressions can be included between <%= and %>. These fields offer a button that opens a drop-down list to help you enter expressions."]},{"section":"Objects exposed","sectionId":"06b99c34-912e-416c-8d0e-a8ea437b4384","paragraphs":["JavaScripts executed in the context of a workflow access a series of additional global objects.","instance: Represents the workflow being executed. The schema of this object is xtk:workflow.\ntask: Represents the tasks being executed. The schema of this object is xtk:workflowTask.\nevent: Represents the events that activated the task being executed. The schema of this object is xtk:workflowEvent. This object is not initialized for AND-join type activities that have been activated from multiple transitions.\nevents: Represents the list of events which activated the current task. The schema of this object is xtk:workflowEvent. This table usually contains one element but may contain several for AND-join type activities which have been activated based on several transitions.\nactivity: Represents the model of the task being executed. The schema of this object depends on the activity type. This object can be modified by the initialization script, in other scripts, modifications with have indeterminable effects.","The properties available for these objects are can be viewed in a drop-down list by clicking the button at the right of the script toolbar.","CAUTION","The properties of these objects are read-only except for the sub-properties of the vars property.","Most of these properties are only updated after executing an elementary task or when the instance is passivated. The values that are read do not necessarily match the current status but the previous status.","Example","In this example, and in the following examples, create a workflow that includes a JavaScript code activity and an End activity as shown in the following diagram.","Double-click the JavaScript code activity and insert the following script:","logInfo(\"Label: \" + instance.label)\nlogInfo(\"Start date: \" + task.creationDate)","The logInfo(message) function inserts a message into the log.","Click OK to close the creation wizard, then start the workflow using the action buttons situated at the top right of the list of workflows. At the end of execution, consult the log. You should see two messages corresponding to the script: one displays the label of the workflow, the other displays the date that the script was activated."]},{"section":"Variables","sectionId":"98348455-7ade-428c-adc8-e8ad8985d410","paragraphs":["The variables are the free properties of the instance, task and event objects. The JavaScript types authorized for these variables are string, number and Date."]},{"section":"Instance variables","sectionId":"f6bb15de-f026-49f0-9cd9-9bcaa8985ccd","paragraphs":["The instance variables (instance.vars.xxx) are comparable to global variables. They are shared by all activities."]},{"section":"Task variables","sectionId":"bec25f1d-54af-4ea3-859a-a1fa275cd609","paragraphs":["The task variables (task.vars.xxx) are comparable to local variables. They are only used by the current task. These variables are used by persistent activities to keep data and are sometimes used to exchange data between the different scripts of a same activity."]},{"section":"Event variables","sectionId":"3ef296ca-788f-4b8d-ba9a-bf951cc55a3b","paragraphs":["The event variables (vars.xxx) enable the exchange of data between the elementary tasks of a workflow process. These variables are passed by the task that activated the task in progress. It is possible to modify them and to define new ones. They are then passed to the following activities.","CAUTION","In the case of AND-join type activities, the variables are merged but if a same variable is defined twice, there is a conflict and the value remains undetermined.","Event are the most often used variables, and they should be used in preference to instance variables.","Certain event variables are modified or read by the various activities. These are all string-type variables. For example, an export sets the vars.filename variable with the full name of the file that has just been exported. All these read or modified variables are documented in About activities, in the sections Input parameters and Output parameters of the activities."]},{"section":"Use cases","sectionId":"6785f923-8580-4af1-8742-52a7fe122792","paragraphs":["NOTE","Additional workflow use cases are available in this section.","Example 1","In this example, an instance variable is used to compute dynamically the split percentage to apply on a population.","Create a workflow and add a Start activity.","Add and configure a JavaScript code activity to define an instance variable.","For example: instance.vars.segmentpercent = 10;","","Add a Query activity and target recipients according to your needs.","Add a Split activity and configure it to perform a random sampling of the incoming population. The sampling percentage can be anything of your choice. It is set to 50% in this example.","It is this percentage which is updated dynamically thanks to the instance variable defined previously.","","Inside the Initialization script section of the Advanced tab of the Split activity, define a JS condition. The JS condition selects the random sampling percentage of the first transition coming out of the Split activity and updates it to a value set by the instance variable created previously.","activity.transitions.extractOutput[0].limiter.percent = instance.vars.segmentpercent;","","Make sure that the complement is generated in a separate transition of the Split activity and add End activities after each of the outbound transitions.","Save and execute the workflow. The dynamic sampling gets applied according to the instance variable.","Example 2","Take the workflow from the preceding example and replace the script of the JavaScript Code activity with the following script:","instance.vars.foo = \"bar1\"\nvars.foo = \"bar2\"\ntask.vars.foo = \"bar3\"","Add the following script to the initialization script of the End activity:","logInfo(\"instance.vars.foo = \" + instance.vars.foo)\nlogInfo(\"vars.foo = \" + vars.foo)\nlogInfo(\"task.vars.foo = \" + task.vars.foo)","Start the workflow, and then look at the log.","Workflow finished\ntask.vars.foo = undefined\nvars.foo = bar2\ninstance.vars.foo = bar1\nStarting workflow (operator 'admin')","This example shows that the activity following JavaScript Code accesses the instance variables and event variables, but the task variables are not accessible from the outside ('undefined')."]},{"section":"Calling an instance variable in a query","sectionId":"1d969109-738a-4864-b57e-9b7883689294","paragraphs":["Once you have specified an instance variable in an activity, you can re-use it in a workflow query.","Thus, to call a variable instance.vars.xxx = \"yyy\" in a filter, enter $(instance/vars/xxx).","For example:","Create an instance variable that defines a delivery's internal name via the JavaScript code: instance.vars.deliveryIN = \"DM42\".","Create a query whose targeting and filtering dimensions are the recipients. In the conditions, specify that you would like to find all the recipients that were sent the delivery specified by the variable.","As a reminder, this information is stored in the delivery logs.","To reference the instance variable in the Value column, enter $(instance/vars/@deliveryIN).","The workflow will return the recipients of the DM42 delivery."]},{"section":"Advanced functions","sectionId":"44a11109-f0f4-40d7-a796-8887937c9608","paragraphs":["In addition to the standard JavaScript functions, special functions are available for manipulating files, reading or modifying data in the database, or adding messages to the log."]},{"section":"Journal","sectionId":"11fad6b1-5aa0-43be-aacf-24094c529a3d","paragraphs":["logInfo(message) was detailed in the above examples. This function adds an information message to the journal.","logError(message) adds an error message to the log. The script interrupts its execution and the workflow changes to error status (by default, the instance will be paused)."]},{"section":"Initialization script","sectionId":"23380bec-4dd2-442d-b4d1-1a810474fcbb","paragraphs":["Under certain conditions, you can modify a property of an activity at the time of execution.","Most properties of activities can be calculated dynamically, either using a JavaScript template or because the workflow properties explicitly allow the value to be calculated by a script.","For other properties, however, you must use the initialization script. This script is evaluated before the task is executed. The activity variable references the activity corresponding to the task. The properties of this activity can be modified and will affect this task only.","Related topics\nExamples of JavaScript code in workflows"]}]}