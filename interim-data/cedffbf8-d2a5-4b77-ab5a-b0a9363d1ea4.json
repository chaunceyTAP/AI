{"guid":"cedffbf8-d2a5-4b77-ab5a-b0a9363d1ea4","title":"Use aggregates","path":"help\\workflow\\using\\using-aggregates.md","fullText":"---\nproduct: campaign\ntitle: Use aggregates\ndescription: Learn how to use aggregates\nfeature: Workflows\nexl-id: 12b173e9-5068-4d45-9e1e-2aecc9866e9c\n---\n# Use aggregates{#using-aggregates}\n\n\n\nThis use case details how to automatically identify the last recipients added to the database.\n\nUsing the following process, the creation date of recipients in the database is compared to the last known date on which a recipient was created using an aggregate. All recipients created on the same day will also be selected.\n\nTo carry out a **Creation date = max (Creation date)** type filter on the recipients, you must run a workflow to follow these steps:\n\n1. Retrieve database recipients using a basic query. For more on this step, refer to [Creating a query](query.md#creating-a-query).\n1. Calculate the last known date a recipient was created using the result generated from the **max (Creation date)** aggregation function.\n1. Link each recipient to the aggregation function result in the same schema.\n1. Filter recipients using the aggregate via the edited schema.\n\n![](assets/datamanagement_usecase_1.png)\n\n## Step 1: Calculating the aggregate result {#step-1--calculating-the-aggregate-result}\n\n1. Create a query. Here, the goal is to calculate the last known creation date out of all of the recipients in the database. The query therefore does not contain a filter.\n1. Select **[!UICONTROL Add data]**.\n1. In the windows that open, select **[!UICONTROL Data linked to the filtering dimension]** then **[!UICONTROL Filtering dimension data]**.\n1. In the **[!UICONTROL Data to add]** window, add a column that calculates the maximum value for the **Creation date** field in the table of recipients. You can use the expression editor or enter **max(@created)** directly into a field in the **[!UICONTROL Expression]** column. Then click the **[!UICONTROL Finish]** button. \n\n   ![](assets/datamanagement_usecase_2.png)\n\n1. Click **[!UICONTROL Edit additional data]** then **[!UICONTROL Advanced parameters...]**. Check the **[!UICONTROL Disable automatic adding of the primary keys of the targeting dimension]** option.\n\n   This option ensures that all the recipients are not displayed as a result and that data added explicitly is not kept. In this case, it refers to the last date a recipient was created.\n\n   Leave the **[!UICONTROL Remove duplicate rows (DISTINCT)]** option checked.\n\n## Step 2: Linking the recipients and the aggregation function result {#step-2--linking-the-recipients-and-the-aggregation-function-result}\n\nTo link the query dealing with recipients to the query carrying out the aggregation function calculation, you must use a schema edit activity.\n\n1. Define the query for recipients as a main set.\n1. In the **[!UICONTROL Links]** tab, add a new link and enter the information in the window that opens as follows:\n\n    * Select the temporary schema relating to the aggregate. The data for this schema will be added to the members of the main set.\n    * Select **[!UICONTROL Use a simple join]** to link the aggregate result to every recipient of the main set.\n    * Finally, specify that the link is a **[!UICONTROL Type 11 simple link]**.\n\n   ![](assets/datamanagement_usecase_3.png)\n\nThe aggregation result is therefore linked to every recipient.\n\n## Step 3: Filtering recipients using the aggregate. {#step-3--filtering-recipients-using-the-aggregate-}\n\nOnce the link has been established, the aggregate result and the recipients make up part of the same temporary schema. It is therefore possible to create a filter on the schema to compare the creation date of recipients and the last known creation date, represented by the aggregation function. This filter is carried out using a split activity.\n\n1. In the **[!UICONTROL General]** tab, select **Recipients** as the targeting dimension and **Edit schema** as the filtering dimension (to filter on the inbound transition schema activity). \n1. In the **[!UICONTROL subsets]** tab, select **[!UICONTROL Add a filtering condition on the inbound population]** then click **[!UICONTROL Edit...]**.\n1. Using the expression editor, add an equality criterion between the creation date of the recipients and the creation date calculated by the aggregate.\n\n   The date type fields in the database are generally saved to the millisecond. You must therefore extend these for the entire day to avoid retrieving recipients created that same millisecond only.\n\n   To do this, use the **ToDate** function, available in the expression editor, which converts dates and hours into simple dates.\n\n   The expressions to use for the criteria are therefore:\n\n    * **[!UICONTROL Expression]**: `toDate([target/@created])`.\n    * **[!UICONTROL Value]**: `toDate([datemax/expr####])`, where expr#### relates to the aggregate specified in the aggregation function query.\n\n   ![](assets/datamanagement_usecase_4.png)\n\nThe result of the split activity thus relates to the recipients created the same day as the last known creation date.\n\nYou can then add other activities such as a list update or a delivery to enrich your workflow.\n","headers":[["title","Use aggregates"],["description","Learn how to use aggregates"],["feature","Workflows"]],"sections":[{"section":"Use aggregates","sectionId":"3920d31a-c483-4325-999e-98b2945776db","paragraphs":["This use case details how to automatically identify the last recipients added to the database.","Using the following process, the creation date of recipients in the database is compared to the last known date on which a recipient was created using an aggregate. All recipients created on the same day will also be selected.","To carry out a Creation date = max (Creation date) type filter on the recipients, you must run a workflow to follow these steps:","Retrieve database recipients using a basic query. For more on this step, refer to Creating a query.\nCalculate the last known date a recipient was created using the result generated from the max (Creation date) aggregation function.\nLink each recipient to the aggregation function result in the same schema.\nFilter recipients using the aggregate via the edited schema."]},{"section":"Step 1: Calculating the aggregate result","sectionId":"d5a41742-6a44-4556-b8c6-e1c72d1d6b33","paragraphs":["Create a query. Here, the goal is to calculate the last known creation date out of all of the recipients in the database. The query therefore does not contain a filter.","Select Add data.","In the windows that open, select Data linked to the filtering dimension then Filtering dimension data.","In the Data to add window, add a column that calculates the maximum value for the Creation date field in the table of recipients. You can use the expression editor or enter max(@created) directly into a field in the Expression column. Then click the Finish button.","Click Edit additional data then Advanced parameters.... Check the Disable automatic adding of the primary keys of the targeting dimension option.","This option ensures that all the recipients are not displayed as a result and that data added explicitly is not kept. In this case, it refers to the last date a recipient was created.","Leave the Remove duplicate rows (DISTINCT) option checked."]},{"section":"Step 2: Linking the recipients and the aggregation function result","sectionId":"177ff6c4-a604-4450-889a-befcb361bd3f","paragraphs":["To link the query dealing with recipients to the query carrying out the aggregation function calculation, you must use a schema edit activity.","Define the query for recipients as a main set.","In the Links tab, add a new link and enter the information in the window that opens as follows:","Select the temporary schema relating to the aggregate. The data for this schema will be added to the members of the main set.\nSelect Use a simple join to link the aggregate result to every recipient of the main set.\nFinally, specify that the link is a Type 11 simple link.","The aggregation result is therefore linked to every recipient."]},{"section":"Step 3: Filtering recipients using the aggregate.","sectionId":"56db37d5-30d4-4eb1-840e-3bea04e6c8ce","paragraphs":["Once the link has been established, the aggregate result and the recipients make up part of the same temporary schema. It is therefore possible to create a filter on the schema to compare the creation date of recipients and the last known creation date, represented by the aggregation function. This filter is carried out using a split activity.","In the General tab, select Recipients as the targeting dimension and Edit schema as the filtering dimension (to filter on the inbound transition schema activity).","In the subsets tab, select Add a filtering condition on the inbound population then click Edit....","Using the expression editor, add an equality criterion between the creation date of the recipients and the creation date calculated by the aggregate.","The date type fields in the database are generally saved to the millisecond. You must therefore extend these for the entire day to avoid retrieving recipients created that same millisecond only.","To do this, use the ToDate function, available in the expression editor, which converts dates and hours into simple dates.","The expressions to use for the criteria are therefore:","Expression: toDate([target/@created]).\nValue: toDate([datemax/expr####]), where expr#### relates to the aggregate specified in the aggregation function query.","The result of the split activity thus relates to the recipients created the same day as the last known creation date."]},{"section":"relates to the aggregate specified in the aggregation function query.","sectionId":"08a68b28-aa1a-42bc-94be-2fc4f2c7b173","paragraphs":["Use aggregates","This use case details how to automatically identify the last recipients added to the database.","Using the following process, the creation date of recipients in the database is compared to the last known date on which a recipient was created using an aggregate. All recipients created on the same day will also be selected.","To carry out a Creation date = max (Creation date) type filter on the recipients, you must run a workflow to follow these steps:","Retrieve database recipients using a basic query. For more on this step, refer to Creating a query.\nCalculate the last known date a recipient was created using the result generated from the max (Creation date) aggregation function.\nLink each recipient to the aggregation function result in the same schema.\nFilter recipients using the aggregate via the edited schema.","Step 1: Calculating the aggregate result","Create a query. Here, the goal is to calculate the last known creation date out of all of the recipients in the database. The query therefore does not contain a filter.","Select Add data.","In the windows that open, select Data linked to the filtering dimension then Filtering dimension data.","In the Data to add window, add a column that calculates the maximum value for the Creation date field in the table of recipients. You can use the expression editor or enter max(@created) directly into a field in the Expression column. Then click the Finish button.","Click Edit additional data then Advanced parameters.... Check the Disable automatic adding of the primary keys of the targeting dimension option.","This option ensures that all the recipients are not displayed as a result and that data added explicitly is not kept. In this case, it refers to the last date a recipient was created.","Leave the Remove duplicate rows (DISTINCT) option checked.","Step 2: Linking the recipients and the aggregation function result","To link the query dealing with recipients to the query carrying out the aggregation function calculation, you must use a schema edit activity.","Define the query for recipients as a main set.","In the Links tab, add a new link and enter the information in the window that opens as follows:","Select the temporary schema relating to the aggregate. The data for this schema will be added to the members of the main set.\nSelect Use a simple join to link the aggregate result to every recipient of the main set.\nFinally, specify that the link is a Type 11 simple link.","The aggregation result is therefore linked to every recipient.","Step 3: Filtering recipients using the aggregate.","Once the link has been established, the aggregate result and the recipients make up part of the same temporary schema. It is therefore possible to create a filter on the schema to compare the creation date of recipients and the last known creation date, represented by the aggregation function. This filter is carried out using a split activity.","In the General tab, select Recipients as the targeting dimension and Edit schema as the filtering dimension (to filter on the inbound transition schema activity).","In the subsets tab, select Add a filtering condition on the inbound population then click Edit....","Using the expression editor, add an equality criterion between the creation date of the recipients and the creation date calculated by the aggregate.","The date type fields in the database are generally saved to the millisecond. You must therefore extend these for the entire day to avoid retrieving recipients created that same millisecond only.","To do this, use the ToDate function, available in the expression editor, which converts dates and hours into simple dates.","The expressions to use for the criteria are therefore:","Expression: toDate([target/@created]).\nValue: toDate([datemax/expr####]), where expr#### relates to the aggregate specified in the aggregation function query.","The result of the split activity thus relates to the recipients created the same day as the last known creation date.","You can then add other activities such as a list update or a delivery to enrich your workflow."]}]}