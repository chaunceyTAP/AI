{"guid":"d4c6ad67-f290-4aba-83fc-e1ce037bbcfe","title":"General configurations","path":"help\\migration\\using\\general-configurations.md","fullText":"---\nproduct: campaign\ntitle: General configurations\ndescription: General configurations\nfeature: Upgrade\naudience: migration\ncontent-type: reference\ntopic-tags: configuration\nhide: yes\nhidefromtoc: yes\nexl-id: 7aad0e49-8d9c-40c7-9d6a-42fee0ae5870\n---\n# General configurations{#general-configurations}\n\n\n\nThis section details the configuration to be carried out in Adobe Campaign v7 when migrating from a v5.11 or a v6.02.\n\nIn addition:\n\n* If you migrate from v5.11, you must also complete the configuration detailed in [this section](../../migration/using/configuring-your-platform.md#specific-configurations-in-v5-11).\n* If you migrate from v6.02, you must also complete the configuration detailed  in [this section](../../migration/using/configuring-your-platform.md#specific-configurations-in-v6-02).\n\n## Time zones {#time-zones}\n\n### Multi time zone mode {#multi-time-zone-mode}\n\nIn v6.02, the \"multi time zone\" mode was only available for PostgreSQL database engines. It is now offered no matter what type of database engine is used. We strongly recommend that you transform your base to a \"multi timezone\" base.\n\nTo use the TIMESTAMP WITH TIMEZONE mode, you also need to add the **-userTimestamptz:1** option to the postupgrade command line.\n\n>[!IMPORTANT]\n>\n>If the **-usetimestamptz:1** parameter is used with an incompatible database engine, your database will be corrupted and you will have to restore a backup of your database and re-execute the command above.\n\n>[!NOTE]\n>\n>It is possible to alter the timezone after migration via the console (**[!UICONTROL Administration > Platform > Options > WdbcTimeZone]** node).\n>\n>For more on time zone management, refer to [this section](../../installation/using/time-zone-management.md).\n\n### Oracle {#oracle}\n\nIf you get an **ORA 01805** error during postupgrade, this means that the Oracle timezone files between the application server and the database server are out of sync. To re-synchronize them, apply the following steps:\n\n1. To identify the time zone file used, run the following command:\n\n   ```\n   select * from v$timezone_file\n   ```\n\n   Time zone files are usually found in the **ORACLE_HOME/oracore/zoneinfo/** folder.\n\n1. Make sure the time zone files are identical on both servers.\n\nFor more information, visit: [https://docs.oracle.com/cd/E11882_01/server.112/e10729/ch4datetime.htm#NLSPG004](https://docs.oracle.com/cd/E11882_01/server.112/e10729/ch4datetime.htm#NLSPG004).\n\nA time zone misalignment between client and server can also cause some lags. That is why we recommend using the same version of Oracle library on the client and server sides, both time zones must be the same.\n\nTo check if both sides are on the same time zones:\n\n1. Check the version of the time zone file on the client side by running the following command:\n\n   ```\n   genezi -v\n   ```\n\n   genezi is a binary found in **$ORACLE_HOME/bin** repository.\n\n1. Check the version of the time zone file on the server side by running the following command:\n\n   ```\n   select * from v$timezone_file\n   ```\n\n1. To change the time zone file on the client side, use the **ORA_TZFILE** environment variable.\n\n## Security {#security}\n\n### Security zones {#security-zones}\n\n>[!IMPORTANT]\n>\n>For security reasons, the Adobe Campaign platform is no longer accessible by default: you must configure the security zones, and therefore collect operator IP addresses.\n\nAdobe Campaign v7 involves the concept of **security zones**. Each user must be associated with a zone in order to log on to an instance and the user's IP address must be included in the addresses or address ranges defined in the security zone. Configuring the security zones can be done in the Adobe Campaign server configuration file. The security zone to which a user is associated must be defined in the console (**[!UICONTROL Administration > Access management > Operators]**).\n\n**Before the migration**, ask your network administrator to help you define the security zones to be activated after the migration.\n\n**After the postupgrade** (before the server restart), you must configure the security zones.\n\nSecurity zone configuration is found in [this section](../../installation/using/security-zones.md).\n\n### User passwords {#user-passwords}\n\nIn v7, **internal** and **admin** operator connection must be secured by a password. We strongly recommend assigning passwords to these accounts and all operator accounts, **before migration**. If you have not specified a password for **internal**, you will not be able to connect. To assign a password to **internal**, enter the following command:\n\n```\nnlserver config -internalpassword\n```\n\n>[!IMPORTANT]\n>\n>The **internal** password must be identical for all the tracking servers. For more information, refer to [this section](../../installation/using/configuring-campaign-server.md#internal-identifier) and [this section](../../platform/using/access-management.md).\n\n### New features in v7 {#new-features-in-v7}\n\n* Users with no permissions can no longer connect to Adobe Campaign. Their permissions must be manually added, for example, by creating a permission called **connect**.\n\n  Users impacted by this modification are identified and listed during the postupgrade.\n\n* Tracking no longer works if the password is empty. If this is the case, an error message will let you know and ask you to reconfigure it.\n* User passwords are no longer stored in the **xtk:sessionInfo** schema.\n* Administration permissions are now necessary to use the **`xtk:builder:EvaluateJavaScript`** and **`xtk:builder:EvaluateJavaScriptTemplate`** functions.\n\nCertain out-of-the-box schemas have been modified and are now by default only accessible with write access for operators with the **admin** permission:\n\n* ncm:publishing\n* nl:monitoring\n* nms:calendar\n* xtk:builder\n* xtk:connections\n* xtk:dbInit\n* xtk:entityBackupNew\n* xtk:entityBackupOriginal\n* xtk:entityOriginal\n* xtk:form\n* xtk:funcList\n* xtk:fusion\n* xtk:image\n* xtk:javascript\n* xtk:jssp\n* xtk:jst\n* xtk:navtree\n* xtk:operatorGroup\n* xtk:package\n* xtk:queryDef\n* xtk:resourceMenu\n* xtk:rights\n* xtk:schema\n* xtk:scriptContext\n* xtk:specFile\n* xtk:sql\n* xtk:sqlSchema\n* xtk:srcSchema\n* xtk:strings\n* xtk:xslt\n\n### Sessiontoken parameter {#sessiontoken-parameter}\n\nIn v5, the **sessiontoken** parameter worked on both client side (list of overview type screens, link editor, etc.) and server side (web applications, reports, jsp, jssp, etc.). In v7, it only works on the server side. If you would like to go back to full functionality as on v5, you must modify the links using this parameter and pass via the connection page:\n\nLink example:\n\n```\n/view/recipientOverview?__sessiontoken=<trusted login>\n```\n\nNew link using the connection page:\n\n```\n/nl/jsp/logon.jsp?login=<trusted login>&action=submit&target=/view/recipientOverview\n```\n\n>[!IMPORTANT]\n>\n>If you use an operator linked with a trusted IP mask, check that it has the minimum rights and that it is in a security zone in **sessionTokenOnly** mode.\n\n### SQL Functions {#sql-functions}\n\nUnknown SQL function calls are no longer naturally sent to the server. Currently, all SQL functions must be added to the **xtk:funcList** schema (for more on this, refer to [this section](../../configuration/using/adding-additional-sql-functions.md)). When migrating, an option is added during the postupgrade that allows you to maintain compatibility with old undeclared SQL functions. If you would like to continue using these functions, check that the **XtkPassUnknownSQLFunctionsToRDBMS** option is indeed defined at the **[!UICONTROL Administration > Platform > Options]** node level.\n\n>[!IMPORTANT]\n>\n>We strongly recommend against using this option due to the security risks it introduces.\n\n### JSSP {#jssp}\n\nIf you would like to authorize access to certain pages via the HTTP protocol (not HTTPS), in your Web apps for example, regardless of the configuration carried out in the security zones, you must specify the **httpAllowed=\"true\"** parameter in the corresponding relay rule.\n\nIf you use anonymous JSSPs, you must add the **httpAllowed=\"true\"** parameter in a relay rule for your JSSP (**[!UICONTROL serverConf.xml]** file):\n\nFor example:\n\n```\n<url IPMask=\"\" deny=\"\" hostMask=\"\" httpAllowed=\"true\" relayHost=\"true\" relayPath=\"true\"\n           status=\"blacklist\" targetUrl=\"https://localhost:8080\" timeout=\"\" urlPath=\"*/cus/myPublicPage.jssp\"/>\n```\n\n## Syntax {#syntax}\n\n### JavaScript {#javascript}\n\nAdobe Campaign v7 integrates a more recent JavaScript interpreter. However, this update may lead to certain scripts malfunctioning. As the previous engine was more permissive, certain syntaxes would work which is no longer the case with the new version of the engine.\n\nThe **[!UICONTROL myObject.@attribute]** syntax is now only valid for XML objects. This syntax may be used for personalizing deliveries and content management. If you used this type of syntax on a non XML object, the personalization features will no longer work.\n\nFor all other object types, the syntax is now **[!UICONTROL myObject`[`\"attribute\"`]`]**. For instance, a non-XML object which used the following syntax: **[!UICONTROL employee.@sn]**, must now use the following syntax: **[!UICONTROL employee`[`\"sn\"`]`]**.\n\n* Former syntax:\n\n  ```\n  employee.@sn\n  ```\n\n* New syntax:\n\n  ```\n  employee[\"sn\"]\n  ```\n\nTo change a value in an XML object, you now need to start by updating the value before you add the XML node:\n\n* Old JavaScript code:\n\n  ```\n  var cellStyle = node.style.copy();\n  this.styles.appendChild(cellStyle);\n  cellStyle.@width = column.@width;\n  ```\n\n* New JavaScript code:\n\n  ```\n  \n  var cellStyle = node.style.copy();\n  cellStyle.@width = column.@width;\n  this.styles.appendChild(cellStyle);\n  ```\n\nYou can no longer use an XML attribute as a table key.\n\n* Former syntax:\n\n  ```\n  if(serverForm.activities[ctx.activityHistory.activity[0].@name].type !=\"end\")\n  ```\n\n* New syntax:\n\n  ```\n  if(serverForm.activities[String(ctx.activityHistory.activity[0].@name)].type !=\"end\"\n  ```\n\n### SQLData {#sqldata}\n\nIn order to strengthen the instance security, a new syntax has been introduced in Adobe Campaign v7 to replace the syntax based on SQLData. If you use these code elements with this syntax, you have to modify them. The main elements concerned are:\n\n* Filtering by sub-query: the new syntax is based on the `<subQuery>`  element to define a sub-query\n* Aggregates: the new syntax is \"aggregate function(collection)\"\n* Filtering by join: the new syntax is `[schemaName:alias:xPath]`\n\nThe queryDef (xtk:queryDef) schema has been modified:\n\n* a new `<subQuery>`  element is available to replace the SELECT included in SQLData\n* two new values, \"IN\" and \"NOT IN\" are introduced for the @setOperator attribute\n* a new `<where>`  element, which is a child of the `<node>` element: this enables you to make \"sub-selections\" in SELECT\n\nWhen an \"@expr\" attribute is used, the SQLData may be present. A search for the following terms can be performed: \"SQLData\", \"aliasSqlTable\", \"sql\".\n\nAdobe Campaign v7 instances are secured by default. Security comes in terms of definitions of security zones in the **[!UICONTROL serverConf.xml]** file: the **allowSQLInjection** attribute manages the SQL syntax security.\n\nIf an SQLData error occurs during postupgrade execution, you must modify this attribute to temporarily allow the use of SQLData based syntaxes, allowing you to rewrite the code. In order to do this, the following option must be changed in the **serverConf.xml** file:\n\n```\nallowSQLInjection=\"true\"\n```\n\nTherefore, relaunch the postupgrade with the following command:\n\n```\nnlserver config -postupgrade -instance:<instance_name> -force\n```\n\nYou must configure the security zones (refer to [Security](#security)), then reactivate the security by changing the option:\n\n```\nallowSQLInjection=\"false\"\n```\n\nBelow you will find comparative examples between the old and new syntax.\n\n**Filtering by sub-queries**\n\n* Former syntax:\n\n  ```\n  <condition expr=\"@id NOT IN ([SQLDATA[SELECT iOperatorId FROM XtkOperatorGroup WHERE iGroupId = $(../@owner-id)]])\" enabledIf=\"$(/ignored/@ownerType)=1\"/>\n  ```\n\n* New syntax:\n\n  ```\n  <condition setOperator=\"NOT IN\" expr=\"@id\" enabledIf=\"$(/ignored/@ownerType)=1\">\n    <subQuery schema=\"xtk:operatorGroup\">\n       <select>\n         <node expr=\"[@operator-id]\" />\n       </select>\n       <where>\n         <condition expr=\"[@group-id]=$long(../@owner-id)\"/>\n       </where>\n     </subQuery>\n  </condition>\n  ```\n\n* Former syntax:\n\n  ```\n  <queryFilter name=\"dupEmail\" label=\"Emails duplicated in the folder\" schema=\"nms:recipient\">\n      <where>\n        <condition sql=\"sEmail in (select sEmail from nmsRecipient where iFolderId=$(folderId) group by sEmail having count(sEmail)>1)\" internalId=\"1\"/>\n      </where>\n      <folder _operation=\"none\" name=\"nmsSegment\"/>\n    </queryFilter>\n  ```\n\n* New syntax:\n\n  ```\n  <queryFilter name=\"dupEmail\" label=\" Emails duplicated in the folder \" schema=\"nms:recipient\">\n      <where>\n        <condition expr=\"@email\" setOperator=\"IN\" internalId=\"1\">\n          <subQuery schema=\"nms:recipient\">\n            <select><node expr=\"@email\"/></select>\n            <where><condition expr=\"[@folder-id]=$(folderId)\"/></where>\n            <groupBy><node expr=\"@email\"/></groupBy>\n            <having><condition expr=\"count(@email)>1\"/></having>\n          </subQuery>\n        </condition>\n      </where>\n      <folder _operation=\"none\" name=\"nmsSegment\"/>\n    </queryFilter>\n  ```\n\n**The aggregate**\n\nAggregate function(collection)\n\n* Former syntax:\n\n  ```\n  <node sql=\"(select count(*) from NmsNewsgroup WHERE O0.iOperationId=iOperationId)\" alias=\"@nbMessages\"/>\n  ```\n\n* New syntax:\n\n  ```\n  <node expr=\"count([newsgroup/@id])\" alias=\"../@nbMessages\"/>\n  ```\n\n  >[!NOTE]\n  >\n  >Joints are automatically carried out for the aggregate functions. It is no longer necessary to specify the condition WHERE O0.iOperationId=iOperationId.\n  >\n  >It is no longer possible to use the \"count(&#42;)\" function. You must use \"countall()\".\n\n* Former syntax:\n\n  ```\n  <node sql=\"(select Sum(iToDeliver) from NmsDelivery WHERE O0.iOperationId=iOperationId AND iSandboxMode=0 AND iState>=45)\" alias=\"@nbMessages\"/>\n  ```\n\n* New syntax:\n\n  ```\n  <node expr=\"Sum([delivery-linkedDelivery/properties/@toDeliver])\" alias= \"../@sumToDeliver\">\n                    <where><condition expr=\"[validation/@sandboxMode]=0 AND @state>=45\" /></where></node>\n  ```\n\n**Filters by joins**\n\n`[schemaName:alias:xPath]`\n\nThe alias is optional\n\n* Former syntax:\n\n  ```\n  <condition expr={\"[\" + joinPart.destination.nodePath + \"] = [SQLDATA[W.\" + joinPart.source.SQLName + \"]]\"}\n                                           aliasSqlTable={nodeSchemaRoot.SQLTable + \" W\"}/>\n  ```\n\n* New syntax:\n\n  ```\n  <condition expr={\"[\" + joinPart.destination.nodePath + \"] = [\" + nodeSchema.id + \":\" + joinPart.source.nodePath + \"]]\"}/>\n  ```\n\n**Tips and tricks**\n\nIn a `<subQuery>` element, to reference a \"field\" field of the main `<queryDef>`   element, use the following syntax: `[../@field]`\n\nExample:\n\n```\n<queryDef operation=\"select\" schema=\"xtk:jobLog\" startPath=\"/\" xtkschema=\"xtk:queryDef\">\n  <select>\n    <node expr=\"[job/@pid]\" alias=\"@pid\"/>\n    <node expr=\"@id\" ordered=\"true\"/>\n    <node expr=\"@logType\"/>\n  </select>\n  <where>\n    <condition expr=\"[@job-id]=99\"/>\n    <condition expr=\"@logType\" setOperator=\"IN\">\n      <subQuery schema=\"xtk:jobLog\">\n        <select><node expr=\"@logType\"/></select>\n        <where><condition expr=\"[@job-id]=[../job/@id]\"/></where>\n        <groupBy><node expr=\"@logType\"/></groupBy>\n        <having><condition expr=\"count(@logType)>1\"/></having>\n      </subQuery>\n    </condition>\n  </where>\n</queryDef>\n```\n\n## Conflicts {#conflicts}\n\nThe migration is performed through a postupgrade and conflicts may appear in reports, forms or web applications. These conflicts can be resolved from the console.\n\nAfter the resource synchronization, the **postupgrade** command lets you detect if the synchronization generates errors or warnings.\n\n### View the synchronization result {#view-the-synchronization-result}\n\nThe synchronization result can be viewed in two ways:\n\n* In the command-line interface, errors are materialized by a triple chevron **>>>** and synchronization is stopped automatically. Warnings are materialized by a double chevron **>>** and must be resolved once synchronization is complete. At the end of the postupgrade, a summary is displayed in the command prompt. For example:\n\n  ```\n  2013-04-09 07:48:39.749Z        00002E7A          1     info    log     =========Summary of the update==========\n  2013-04-09 07:48:39.749Z        00002E7A          1     info    log     test instance, 6 warning(s) and 0 error(s) during the update.\n  2013-04-09 07:48:39.749Z        00002E7A          1     warning log     The document with identifier 'mobileAppDeliveryFeedback' and type 'xtk:report' is in conflict with the new version.\n  2013-04-09 07:48:39.749Z        00002E7A          1     warning log     The document with identifier 'opensByUserAgent' and type 'xtk:report' is in conflict with the new version.\n  2013-04-09 07:48:39.750Z        00002E7A          1     warning log     The document with identifier 'deliveryValidation' and type 'nms:webApp' is in conflict with the new version.\n  2013-04-09 07:48:39.750Z        00002E7A          1     warning log     Document of identifier 'nms:includeView' and type 'xtk:srcSchema' updated in the database and found in the file system. You will have to merge the two versions manually.\n  ```\n\n  If the warning concerns a conflict of resources, operator attention is required to resolve it.\n\n* The **postupgrade_`<server version number>`_time of postupgrade`>`.log** file contains the synchronization result. It is available by default in the following directory: **installation directory/var/`<instance>`postupgrade**. Errors and warnings are indicated by the **error** and **warning** attributes.\n\n### Resolve a conflict {#resolve-a-conflict}\n\nResolving conflicts must only be performed by advanced operators and those that have been given 'Administrator' rights.\n\nTo resolve a conflict, apply the following process:\n\n1. In the Adobe Campaign tree structure, place your cursor over **[!UICONTROL Administration > Configuration > Package management > Edit conflicts]**.\n1. Select the conflict that you want to resolve in the list.\n\nThere are three possible ways to resolve a conflict:\n\n* **[!UICONTROL Declared as resolved]**: requires operator intervention beforehand.\n* **[!UICONTROL Accept the new version]**: recommended if the resources provided with Adobe Campaign have not been changed by the user.\n* **[!UICONTROL Keep the current version]**: means that the update is rejected.\n\n  >[!IMPORTANT]\n  >\n  >If you select this resolution mode, you risk losing patches in the new version. It is therefore strongly recommended that this option is not used or reserved only for expert operators.\n\nIf you choose to manually resolve the conflict, proceed as follows:\n\n1. In the lower section of the window, search for the **`_conflict_ string`** to locate the entities with conflicts. The entity installed with the new version contains the **new** argument, the entity that matches the previous version contains the **cus** argument.\n\n   ![](assets/s_ncs_production_conflict002.png)\n\n1. Delete the version you do not want to keep. Delete the **`_conflict_argument_ string`** of the entity you are keeping.\n\n   ![](assets/s_ncs_production_conflict003.png)\n\n1. Go to the conflict you would have resolved. Click the **[!UICONTROL Actions]** icon and select **[!UICONTROL Declare as resolved]**. \n1. Save your changes: the conflict is now resolved.\n\n<!--\n## Tomcat {#tomcat}\n\nThe integrated Tomcat server in Adobe Campaign v7 has changed version. Its installation folder (tomcat-6) has therefore also changed (tomcat 7). After the postupgrade, make sure to check that the paths do link to the updated folder (in the **[!UICONTROL serverConf.xml]** file):\n\n```\n$(XTK_INSTALL_DIR)/tomcat-X/bin/bootstrap.jar \n$(XTK_INSTALL_DIR)/tomcat-X/bin/tomcat-juli.jar\n$(XTK_INSTALL_DIR)/tomcat-X/lib/tomcat-util.jar\n$(XTK_INSTALL_DIR)/tomcat-X/lib/tomcat-api.jar\n$(XTK_INSTALL_DIR)/tomcat-X/lib/servlet-api.jar\n$(XTK_INSTALL_DIR)/tomcat-X/lib/jsp-api.jar\n$(XTK_INSTALL_DIR)/tomcat-X/lib/el-api.jar\n```\n-->\n\n## Interaction {#interaction}\n\n### Prerequisites {#prerequisites}\n\n**Before the postupgrade**, you must delete all schema references from 6.02 that will no longer exist in v7.\n\n* nms:emailOfferView\n* nms:webOfferView \n* nms:callCenterOfferView \n* nms:mobileOfferView \n* nms:paperOfferView\n\n### Offer content {#offer-content}\n\nIn v7, the offer content has been moved. In v6.02 the content was in each representation schema (**nms:emailOfferView**). In v7, the content is now in the offer schema. After the postupgrade, the content will therefore not be visible in the interface. After the postupgrade, you must recreate the offer content, or develop a script which automatically moves the content from the representation schema to the offer schema.\n\n>[!IMPORTANT]\n>\n>If some deliveries using configured offers were to be sent after the migration, you must delete and recreate all these deliveries in v7. If you cannot do that, a \"compatibility mode\" is offered. This mode is not recommended because you will not benefit from all the new features in Interaction v7. This is a transitional mode which allows you to complete ongoing campaigns before the actual 6.1 migration. For more information regarding this mode, please contact us.\n\nAn example of a movement script (**interactionTo610_full_XX.js**) is available in the **Migration** folder within the Adobe Campaign v7 folder. This file shows an example of a script for a client using a single email representation per offer (the **[!UICONTROL htmlSource]** and **[!UICONTROL textSource]** fields). The content that was in the **NmsEmailOfferView** table has been moved to the offer table.\n\n>[!NOTE]\n>\n>Using this script does not allow you to benefit from the \"content management\" and \"rendering functions\" options. To benefit from these functions, you must rethink the catalog offers, particularly the offer content and configuration spaces.\n\n```\nloadLibrary(\"/nl/core/shared/nl.js\");\n\nNL.require(\"/nl/core/shared/xtk.js\");\n\n// 1. Restore old emailOfferView schema\nlogInfo(\"Restoring old emailOfferView schema\");\nvar oldOfferViewSchemas = <entities schema=\"xtk:srcSchema\"/>;\n\noldOfferViewSchemas.appendChild(\n  <srcSchema img=\"nms:offerView.png\"\n             label=\"Email offer representations\"\n             labelSingular=\"Email offer representation\"\n             name=\"emailOfferView\" namespace=\"nlmig\"\n             genAccessors=\"false\" implements=\"xtk:persist\">\n    <element name=\"emailOfferView\" template=\"nms:offerView\" sqltable=\"NmsEmailOfferView\">\n      <element name=\"offer\" revLabel=\"Email representation\" revIntegrity=\"owncopy\"/>\n      <element   name=\"htmlSource\"      type=\"html\" label=\"HTML content\"  xml=\"true\"/>\n      <element   name=\"textSource\"      type=\"CDATA\" label=\"Text content\" xml=\"true\"/>\n      <element   name=\"htmlSource_jst\"  type=\"CDATA\" label=\"HTML script\"  desc=\"HTML content calculation script.\"  xml=\"true\" advanced=\"true\"/>\n      <element   name=\"textSource_jst\"  type=\"CDATA\" label=\"Text script\" desc=\"Text content calculation script.\" xml=\"true\" advanced=\"true\"/>\n    </element>\n  </srcSchema>);\n\nvar oldOfferViewsPkg = <builder><package buildNumber=\"*\">{oldOfferViewSchemas}</package></builder>;\nxtk.builder.InstallPackage(oldOfferViewsPkg);\n\n// 2. Migrate data from old emailOfferView table to nms:offer\nlogInfo(\"Moving data from old EmailOfferView table to NmsOffer\");\nvar OFFER_STATUS_VALIDATED = 3;\n\nvar queryDef = xtk.queryDef.create(\n  <queryDef operation=\"select\" schema=\"nlmig:emailOfferView\">\n    <select>\n      <node expr=\"[@offer-id]\"/>\n      <node expr=\"[@space-id]\"/>\n      <node expr=\"htmlSource_jst\"/>\n      <node expr=\"textSource_jst\"/>\n    </select>\n  </queryDef>);\nvar res = queryDef.ExecuteQuery();\n\nvar processedOffers = {};\nfor each( var emailOfferView in res.emailOfferView )\n{\n  if( processedOffers[String(emailOfferView.@[\"offer-id\"])] != undefined )\n  {\n    logWarning(\"Found 2 or more eff fffffmail representations for offer \" + String(emailOfferView.@[\"offer-id\"]) + \". Only keep the first one here.\");\n    continue;\n  }\n  xtk.session.Write(\n    <offer id={emailOfferView.@[\"offer-id\"]} status={OFFER_STATUS_VALIDATED} xtkschema=\"nms:offer\">\n      <view>\n        {emailOfferView.mdSource_jst}\n        {emailOfferView.textSource_jst}\n      </view>\n    </offer>\n  );\n  processedOffers[String(emailOfferView.@[\"offer-id\"])] = 1;\n}\n\n// 3. Get rid of emailOfferView schema now that data has been moved.\nlogInfo(\"Deleting EmailOfferView schema\");\nxtk.session.Write(<srcSchema xtkschema=\"xtk:srcSchema\" name=\"emailOfferView\" namespace=\"nlmig\" _operation=\"delete\"/>);\n\nlogInfo(\"Done\");\n```\n\n### Tests and configuration {#tests-and-configuration}\n\nHere is the procedure to follow after having moved the offer content if you only have one environment. In this case let's take \"ENV\" as an example.\n\n1. In all \"ENV\" environment offer spaces, update the list of fields used. For example, for an offer space that only uses the **[!UICONTROL htmlSource]**, you must add the **[!UICONTROL view/htmlSource]**. \n\n   ![](assets/migration_interaction_2.png)\n\n1. In the **[!UICONTROL Type of Environment]** field within the **[!UICONTROL General]** tab, select **[!UICONTROL Live]**.\n\n   ![](assets/migration_interaction_3.png)\n\n1. Create a design environment (\"ENV_DESIGN\", for example) and connect it to the ENV online environment. \n\n   ![](assets/migration_interaction_4.png)\n\n1. Deploy all \"ENV\" environment offer spaces (right click > **[!UICONTROL Actions > Deploy]**) and select the \"ENV_DESIGN\" environment.\n\n   ![](assets/migration_interaction_5.png)\n\n1. Do the same for all \"ENV\" environment offers.\n1. Activate all environment offers \"ENV_DESIGN\" on the relevant channels.\n1. Test making an offer go live. If you do not encounter any problems, execute pending tasks on the latest workflow task **[!UICONTROL Offer notification]** (offerMgt) to make all of the offers go live. \n\n   ![](assets/migration_interaction_6.png)\n\n1. Perform comprehensive tests.\n\n   >[!NOTE]\n   >\n   >The names of categories and offers online are modified after going live. On the incoming channel, update all references to offers and categories.\n\n## Reports {#reports}\n\n### Standard reports {#standard-reports}\n\nAll standard reports currently use rendering engine v6.x. If you had added JavaScript into these reports, certain elements may no longer work. Indeed, the old version of JavaScript is not compatible with the v6.x rendering engine. You must therefore check the JavaScript code and later adapt it. You should test every report, particularly the exporting function.\n\n### Personalized reports {#personalized-reports}\n\n<!--If you want to have the blue banner from v7 (allowing you access to the tabs), you must republish reports. If you encounter problems, you can force the v6.0 rendering engine. To do this, go to **[!UICONTROL Properties]** within the report, click **[!UICONTROL Rendering]** and choose the **[!UICONTROL Version 6.0 (Flash & OpenOffice)]** rendering engine.\n\n![](assets/migration_reports_1.png)\n-->\nIf you wish to benefit from the new report functionalities, you must republish reports. In this case, check all of your scripts and change them if necessary. In regards to PDF export, if you had added specific script for Open Office, this will no longer work with the new PDF export engine (PhantomJS).\n\n## Web applications {#web-applications}\n\nThere are two web application families:\n\n* identified web applications (seen together, approval forms, extranet internal developments),\n* anonymous web applications (web or questionnaire forms).\n\n### Identified web applications {#identified-web-applications}\n\nJust as for reports ([learn more](#reports)), if you had added JavaScript, you must check and adapt if necessary. If you wish to benefit from the v7 blue banner (containing the blue tabs), you must republish the web application.\n\nWeb application connection methods have changed in v7. If you encounter any connection problems in your identified web applications, you must temporarily activate the **allowUserPassword** and **sessionTokenOnly** options in the **serverConf.xml** file. After the postupgrade, modify these option values:\n\n```\nallowUserPassword=\"true\"\n```\n\n```\nsessionTokenOnly=\"true\"\n```\n\nTherefore, relaunch the postupgrade with the following command:\n\n```\nnlserver config -postupgrade -instance:<instance_name> -force\n```\n\nTest your web applications in the v6.x rendering engine, before publishing them. Then deactivate these two options.\n\n```\nallowUserPassword=\"false\"\n```\n\n```\nsessionTokenOnly=\"false\"\n```\n\n### Anonymous web applications {#anonymous-web-applications}\n\nIf you encounter any problems, republish the web application.\n","headers":[["title","General configurations"],["description","General configurations"],["feature","Upgrade"],["topic-tags","configuration"]],"sections":[{"section":"General configurations","sectionId":"b11c24de-58a0-440f-b03b-e7c83b1065ae","paragraphs":["This section details the configuration to be carried out in Adobe Campaign v7 when migrating from a v5.11 or a v6.02.","In addition:","If you migrate from v5.11, you must also complete the configuration detailed in this section.\nIf you migrate from v6.02, you must also complete the configuration detailed  in this section."]},{"section":"Time zones","sectionId":"a99ad07a-4071-4caa-8201-f2317ad602d8","paragraphs":[]},{"section":"Multi time zone mode","sectionId":"e75329fe-186d-4803-97a8-4ab86a56b160","paragraphs":["In v6.02, the \"multi time zone\" mode was only available for PostgreSQL database engines. It is now offered no matter what type of database engine is used. We strongly recommend that you transform your base to a \"multi timezone\" base.","To use the TIMESTAMP WITH TIMEZONE mode, you also need to add the -userTimestamptz:1 option to the postupgrade command line.","IMPORTANT","If the -usetimestamptz:1 parameter is used with an incompatible database engine, your database will be corrupted and you will have to restore a backup of your database and re-execute the command above.","NOTE","It is possible to alter the timezone after migration via the console (Administration > Platform > Options > WdbcTimeZone node).","For more on time zone management, refer to this section."]},{"section":"Oracle","sectionId":"33911b8f-1b31-479c-8f00-6ed02c88c76e","paragraphs":["If you get an ORA 01805 error during postupgrade, this means that the Oracle timezone files between the application server and the database server are out of sync. To re-synchronize them, apply the following steps:","To identify the time zone file used, run the following command:","select * from v$timezone_file","Time zone files are usually found in the ORACLE_HOME/oracore/zoneinfo/ folder.","Make sure the time zone files are identical on both servers.","For more information, visit: https://docs.oracle.com/cd/E11882_01/server.112/e10729/ch4datetime.htm#NLSPG004.","A time zone misalignment between client and server can also cause some lags. That is why we recommend using the same version of Oracle library on the client and server sides, both time zones must be the same.","To check if both sides are on the same time zones:","Check the version of the time zone file on the client side by running the following command:","genezi -v","genezi is a binary found in $ORACLE_HOME/bin repository.","Check the version of the time zone file on the server side by running the following command:","select * from v$timezone_file","To change the time zone file on the client side, use the ORA_TZFILE environment variable."]},{"section":"Security","sectionId":"952c2377-92e7-4228-8cd2-6ec02a95409d","paragraphs":[]},{"section":"Security zones","sectionId":"28d8a33c-eda7-4738-a8c0-e6614f53c318","paragraphs":["IMPORTANT","For security reasons, the Adobe Campaign platform is no longer accessible by default: you must configure the security zones, and therefore collect operator IP addresses.","Adobe Campaign v7 involves the concept of security zones. Each user must be associated with a zone in order to log on to an instance and the user's IP address must be included in the addresses or address ranges defined in the security zone. Configuring the security zones can be done in the Adobe Campaign server configuration file. The security zone to which a user is associated must be defined in the console (Administration > Access management > Operators).","Before the migration, ask your network administrator to help you define the security zones to be activated after the migration.","After the postupgrade (before the server restart), you must configure the security zones.","Security zone configuration is found in this section."]},{"section":"User passwords","sectionId":"19bb8811-1616-434f-b293-513155a06adf","paragraphs":["In v7, internal and admin operator connection must be secured by a password. We strongly recommend assigning passwords to these accounts and all operator accounts, before migration. If you have not specified a password for internal, you will not be able to connect. To assign a password to internal, enter the following command:","nlserver config -internalpassword","IMPORTANT","The internal password must be identical for all the tracking servers. For more information, refer to this section and this section."]},{"section":"New features in v7","sectionId":"8dab42ab-03d2-48c3-80eb-4b4804c57475","paragraphs":["Users with no permissions can no longer connect to Adobe Campaign. Their permissions must be manually added, for example, by creating a permission called connect.","Users impacted by this modification are identified and listed during the postupgrade.","Tracking no longer works if the password is empty. If this is the case, an error message will let you know and ask you to reconfigure it.","User passwords are no longer stored in the xtk:sessionInfo schema.","Administration permissions are now necessary to use the xtk:builder:EvaluateJavaScript and xtk:builder:EvaluateJavaScriptTemplate functions.","Certain out-of-the-box schemas have been modified and are now by default only accessible with write access for operators with the admin permission:","ncm:publishing\nnl:monitoring\nnms:calendar\nxtk:builder\nxtk:connections\nxtk:dbInit\nxtk:entityBackupNew\nxtk:entityBackupOriginal\nxtk:entityOriginal\nxtk:form\nxtk:funcList\nxtk:fusion\nxtk:image\nxtk:javascript\nxtk:jssp\nxtk:jst\nxtk:navtree\nxtk:operatorGroup\nxtk:package\nxtk:queryDef\nxtk:resourceMenu\nxtk:rights\nxtk:schema\nxtk:scriptContext\nxtk:specFile\nxtk:sql\nxtk:sqlSchema\nxtk:srcSchema\nxtk:strings\nxtk:xslt"]},{"section":"Sessiontoken parameter","sectionId":"c772f1e4-0c7a-4080-845d-0f53f9779ae7","paragraphs":["In v5, the sessiontoken parameter worked on both client side (list of overview type screens, link editor, etc.) and server side (web applications, reports, jsp, jssp, etc.). In v7, it only works on the server side. If you would like to go back to full functionality as on v5, you must modify the links using this parameter and pass via the connection page:","Link example:","/view/recipientOverview?__sessiontoken=<trusted login>","New link using the connection page:","/nl/jsp/logon.jsp?login=<trusted login>&action=submit&target=/view/recipientOverview","IMPORTANT","If you use an operator linked with a trusted IP mask, check that it has the minimum rights and that it is in a security zone in sessionTokenOnly mode."]},{"section":"SQL Functions","sectionId":"81aad03c-0eeb-483b-b145-e42e8bc7e352","paragraphs":["Unknown SQL function calls are no longer naturally sent to the server. Currently, all SQL functions must be added to the xtk:funcList schema (for more on this, refer to this section). When migrating, an option is added during the postupgrade that allows you to maintain compatibility with old undeclared SQL functions. If you would like to continue using these functions, check that the XtkPassUnknownSQLFunctionsToRDBMS option is indeed defined at the Administration > Platform > Options node level.","IMPORTANT","We strongly recommend against using this option due to the security risks it introduces."]},{"section":"JSSP","sectionId":"f495c33d-eb9e-4d1f-b8cc-488be90db818","paragraphs":["If you would like to authorize access to certain pages via the HTTP protocol (not HTTPS), in your Web apps for example, regardless of the configuration carried out in the security zones, you must specify the httpAllowed=\"true\" parameter in the corresponding relay rule.","If you use anonymous JSSPs, you must add the httpAllowed=\"true\" parameter in a relay rule for your JSSP (serverConf.xml file):","For example:","<url IPMask=\"\" deny=\"\" hostMask=\"\" httpAllowed=\"true\" relayHost=\"true\" relayPath=\"true\"\n           status=\"blacklist\" targetUrl=\"https://localhost:8080\" timeout=\"\" urlPath=\"*/cus/myPublicPage.jssp\"/>"]},{"section":"Syntax","sectionId":"7a03bdce-f3c2-4b3e-85c3-0bd6f7b14393","paragraphs":[]},{"section":"JavaScript","sectionId":"a6f11da0-8697-4398-b2ed-a764470202cc","paragraphs":["Adobe Campaign v7 integrates a more recent JavaScript interpreter. However, this update may lead to certain scripts malfunctioning. As the previous engine was more permissive, certain syntaxes would work which is no longer the case with the new version of the engine.","The myObject.@attribute syntax is now only valid for XML objects. This syntax may be used for personalizing deliveries and content management. If you used this type of syntax on a non XML object, the personalization features will no longer work.","For all other object types, the syntax is now myObject[\"attribute\"``]. For instance, a non-XML object which used the following syntax: employee.@sn, must now use the following syntax: employee[\"sn\"``].","Former syntax:","employee.@sn","New syntax:","employee[\"sn\"]","To change a value in an XML object, you now need to start by updating the value before you add the XML node:","Old JavaScript code:","var cellStyle = node.style.copy();\nthis.styles.appendChild(cellStyle);\ncellStyle.@width = column.@width;","New JavaScript code:","var cellStyle = node.style.copy();\ncellStyle.@width = column.@width;\nthis.styles.appendChild(cellStyle);","You can no longer use an XML attribute as a table key.","Former syntax:","if(serverForm.activities[ctx.activityHistory.activity[0].@name].type !=\"end\")","New syntax:","if(serverForm.activities[String(ctx.activityHistory.activity[0].@name)].type !=\"end\""]},{"section":"SQLData","sectionId":"864e0a7c-b226-4aef-920f-8f3fb41b7ded","paragraphs":["In order to strengthen the instance security, a new syntax has been introduced in Adobe Campaign v7 to replace the syntax based on SQLData. If you use these code elements with this syntax, you have to modify them. The main elements concerned are:","Filtering by sub-query: the new syntax is based on the <subQuery>  element to define a sub-query\nAggregates: the new syntax is \"aggregate function(collection)\"\nFiltering by join: the new syntax is [schemaName:alias:xPath]","The queryDef (xtk:queryDef) schema has been modified:","a new <subQuery>  element is available to replace the SELECT included in SQLData\ntwo new values, \"IN\" and \"NOT IN\" are introduced for the @setOperator attribute\na new <where>  element, which is a child of the <node> element: this enables you to make \"sub-selections\" in SELECT","When an \"@expr\" attribute is used, the SQLData may be present. A search for the following terms can be performed: \"SQLData\", \"aliasSqlTable\", \"sql\".","Adobe Campaign v7 instances are secured by default. Security comes in terms of definitions of security zones in the serverConf.xml file: the allowSQLInjection attribute manages the SQL syntax security.","If an SQLData error occurs during postupgrade execution, you must modify this attribute to temporarily allow the use of SQLData based syntaxes, allowing you to rewrite the code. In order to do this, the following option must be changed in the serverConf.xml file:","allowSQLInjection=\"true\"","Therefore, relaunch the postupgrade with the following command:","nlserver config -postupgrade -instance:<instance_name> -force","You must configure the security zones (refer to Security), then reactivate the security by changing the option:","allowSQLInjection=\"false\"","Below you will find comparative examples between the old and new syntax.","Filtering by sub-queries","Former syntax:","<condition expr=\"@id NOT IN ([SQLDATA[SELECT iOperatorId FROM XtkOperatorGroup WHERE iGroupId = $(../@owner-id)]])\" enabledIf=\"$(/ignored/@ownerType)=1\"/>","New syntax:","<condition setOperator=\"NOT IN\" expr=\"@id\" enabledIf=\"$(/ignored/@ownerType)=1\">\n  <subQuery schema=\"xtk:operatorGroup\">\n     <select>\n       <node expr=\"[@operator-id]\" />\n     </select>\n     <where>\n       <condition expr=\"[@group-id]=$long(../@owner-id)\"/>\n     </where>\n   </subQuery>\n</condition>","Former syntax:","<queryFilter name=\"dupEmail\" label=\"Emails duplicated in the folder\" schema=\"nms:recipient\">\n    <where>\n      <condition sql=\"sEmail in (select sEmail from nmsRecipient where iFolderId=$(folderId) group by sEmail having count(sEmail)>1)\" internalId=\"1\"/>\n    </where>\n    <folder _operation=\"none\" name=\"nmsSegment\"/>\n  </queryFilter>","New syntax:","<queryFilter name=\"dupEmail\" label=\" Emails duplicated in the folder \" schema=\"nms:recipient\">\n    <where>\n      <condition expr=\"@email\" setOperator=\"IN\" internalId=\"1\">\n        <subQuery schema=\"nms:recipient\">\n          <select><node expr=\"@email\"/></select>\n          <where><condition expr=\"[@folder-id]=$(folderId)\"/></where>\n          <groupBy><node expr=\"@email\"/></groupBy>\n          <having><condition expr=\"count(@email)>1\"/></having>\n        </subQuery>\n      </condition>\n    </where>\n    <folder _operation=\"none\" name=\"nmsSegment\"/>\n  </queryFilter>","The aggregate","Aggregate function(collection)","Former syntax:","<node sql=\"(select count(*) from NmsNewsgroup WHERE O0.iOperationId=iOperationId)\" alias=\"@nbMessages\"/>","New syntax:","<node expr=\"count([newsgroup/@id])\" alias=\"../@nbMessages\"/>","NOTE","Joints are automatically carried out for the aggregate functions. It is no longer necessary to specify the condition WHERE O0.iOperationId=iOperationId.","It is no longer possible to use the \"count(&#42;)\" function. You must use \"countall()\".","Former syntax:","<node sql=\"(select Sum(iToDeliver) from NmsDelivery WHERE O0.iOperationId=iOperationId AND iSandboxMode=0 AND iState>=45)\" alias=\"@nbMessages\"/>","New syntax:","<node expr=\"Sum([delivery-linkedDelivery/properties/@toDeliver])\" alias= \"../@sumToDeliver\">\n                  <where><condition expr=\"[validation/@sandboxMode]=0 AND @state>=45\" /></where></node>","Filters by joins","[schemaName:alias:xPath]","The alias is optional","Former syntax:","<condition expr=\n                                         aliasSqlTable=/>","New syntax:","<condition expr=/>","Tips and tricks","In a <subQuery> element, to reference a \"field\" field of the main <queryDef>   element, use the following syntax: [../@field]","Example:","<queryDef operation=\"select\" schema=\"xtk:jobLog\" startPath=\"/\" xtkschema=\"xtk:queryDef\">\n  <select>\n    <node expr=\"[job/@pid]\" alias=\"@pid\"/>\n    <node expr=\"@id\" ordered=\"true\"/>\n    <node expr=\"@logType\"/>\n  </select>\n  <where>\n    <condition expr=\"[@job-id]=99\"/>\n    <condition expr=\"@logType\" setOperator=\"IN\">\n      <subQuery schema=\"xtk:jobLog\">\n        <select><node expr=\"@logType\"/></select>\n        <where><condition expr=\"[@job-id]=[../job/@id]\"/></where>\n        <groupBy><node expr=\"@logType\"/></groupBy>\n        <having><condition expr=\"count(@logType)>1\"/></having>\n      </subQuery>\n    </condition>\n  </where>\n</queryDef>"]},{"section":"Conflicts","sectionId":"059ef085-88cf-452d-9c7a-c2f6d935b796","paragraphs":["The migration is performed through a postupgrade and conflicts may appear in reports, forms or web applications. These conflicts can be resolved from the console.","After the resource synchronization, the postupgrade command lets you detect if the synchronization generates errors or warnings."]},{"section":"View the synchronization result","sectionId":"8c3a6eb1-4a8c-4ad6-b7da-8a1c16f49b2b","paragraphs":["The synchronization result can be viewed in two ways:","In the command-line interface, errors are materialized by a triple chevron >>> and synchronization is stopped automatically. Warnings are materialized by a double chevron >> and must be resolved once synchronization is complete. At the end of the postupgrade, a summary is displayed in the command prompt. For example:","2013-04-09 07:48:39.749Z        00002E7A          1     info    log     =========Summary of the update==========\n2013-04-09 07:48:39.749Z        00002E7A          1     info    log     test instance, 6 warning(s) and 0 error(s) during the update.\n2013-04-09 07:48:39.749Z        00002E7A          1     warning log     The document with identifier 'mobileAppDeliveryFeedback' and type 'xtk:report' is in conflict with the new version.\n2013-04-09 07:48:39.749Z        00002E7A          1     warning log     The document with identifier 'opensByUserAgent' and type 'xtk:report' is in conflict with the new version.\n2013-04-09 07:48:39.750Z        00002E7A          1     warning log     The document with identifier 'deliveryValidation' and type 'nms:webApp' is in conflict with the new version.\n2013-04-09 07:48:39.750Z        00002E7A          1     warning log     Document of identifier 'nms:includeView' and type 'xtk:srcSchema' updated in the database and found in the file system. You will have to merge the two versions manually.","If the warning concerns a conflict of resources, operator attention is required to resolve it.","The postupgrade_<server version number>_time of postupgrade>.log file contains the synchronization result. It is available by default in the following directory: installation directory/var/<instance>postupgrade. Errors and warnings are indicated by the error and warning attributes."]},{"section":"Resolve a conflict","sectionId":"2e37fd53-9aba-4be1-b843-94d10c8fad7e","paragraphs":["Resolving conflicts must only be performed by advanced operators and those that have been given 'Administrator' rights.","To resolve a conflict, apply the following process:","In the Adobe Campaign tree structure, place your cursor over Administration > Configuration > Package management > Edit conflicts.\nSelect the conflict that you want to resolve in the list.","There are three possible ways to resolve a conflict:","Declared as resolved: requires operator intervention beforehand.","Accept the new version: recommended if the resources provided with Adobe Campaign have not been changed by the user.","Keep the current version: means that the update is rejected.","IMPORTANT","If you select this resolution mode, you risk losing patches in the new version. It is therefore strongly recommended that this option is not used or reserved only for expert operators.","If you choose to manually resolve the conflict, proceed as follows:","In the lower section of the window, search for the _conflict_ string to locate the entities with conflicts. The entity installed with the new version contains the new argument, the entity that matches the previous version contains the cus argument.","Delete the version you do not want to keep. Delete the _conflict_argument_ string of the entity you are keeping.","Go to the conflict you would have resolved. Click the Actions icon and select Declare as resolved.","Save your changes: the conflict is now resolved.","Interaction","Prerequisites","Before the postupgrade, you must delete all schema references from 6.02 that will no longer exist in v7.","nms:emailOfferView\nnms:webOfferView \nnms:callCenterOfferView \nnms:mobileOfferView \nnms:paperOfferView","Offer content","In v7, the offer content has been moved. In v6.02 the content was in each representation schema (nms:emailOfferView). In v7, the content is now in the offer schema. After the postupgrade, the content will therefore not be visible in the interface. After the postupgrade, you must recreate the offer content, or develop a script which automatically moves the content from the representation schema to the offer schema.","IMPORTANT","If some deliveries using configured offers were to be sent after the migration, you must delete and recreate all these deliveries in v7. If you cannot do that, a \"compatibility mode\" is offered. This mode is not recommended because you will not benefit from all the new features in Interaction v7. This is a transitional mode which allows you to complete ongoing campaigns before the actual 6.1 migration. For more information regarding this mode, please contact us.","An example of a movement script (interactionTo610_full_XX.js) is available in the Migration folder within the Adobe Campaign v7 folder. This file shows an example of a script for a client using a single email representation per offer (the htmlSource and textSource fields). The content that was in the NmsEmailOfferView table has been moved to the offer table.","NOTE","Using this script does not allow you to benefit from the \"content management\" and \"rendering functions\" options. To benefit from these functions, you must rethink the catalog offers, particularly the offer content and configuration spaces.","loadLibrary(\"/nl/core/shared/nl.js\");","NL.require(\"/nl/core/shared/xtk.js\");","// 1. Restore old emailOfferView schema\nlogInfo(\"Restoring old emailOfferView schema\");\nvar oldOfferViewSchemas = <entities schema=\"xtk:srcSchema\"/>;","oldOfferViewSchemas.appendChild(\n  <srcSchema img=\"nms:offerView.png\"\n             label=\"Email offer representations\"\n             labelSingular=\"Email offer representation\"\n             name=\"emailOfferView\" namespace=\"nlmig\"\n             genAccessors=\"false\" implements=\"xtk:persist\">\n    <element name=\"emailOfferView\" template=\"nms:offerView\" sqltable=\"NmsEmailOfferView\">\n      <element name=\"offer\" revLabel=\"Email representation\" revIntegrity=\"owncopy\"/>\n      <element   name=\"htmlSource\"      type=\"html\" label=\"HTML content\"  xml=\"true\"/>\n      <element   name=\"textSource\"      type=\"CDATA\" label=\"Text content\" xml=\"true\"/>\n      <element   name=\"htmlSource_jst\"  type=\"CDATA\" label=\"HTML script\"  desc=\"HTML content calculation script.\"  xml=\"true\" advanced=\"true\"/>\n      <element   name=\"textSource_jst\"  type=\"CDATA\" label=\"Text script\" desc=\"Text content calculation script.\" xml=\"true\" advanced=\"true\"/>\n    </element>\n  </srcSchema>);","var oldOfferViewsPkg = <builder><package buildNumber=\"*\"></package></builder>;\nxtk.builder.InstallPackage(oldOfferViewsPkg);","// 2. Migrate data from old emailOfferView table to nms:offer\nlogInfo(\"Moving data from old EmailOfferView table to NmsOffer\");\nvar OFFER_STATUS_VALIDATED = 3;","var queryDef = xtk.queryDef.create(\n  <queryDef operation=\"select\" schema=\"nlmig:emailOfferView\">\n    <select>\n      <node expr=\"[@offer-id]\"/>\n      <node expr=\"[@space-id]\"/>\n      <node expr=\"htmlSource_jst\"/>\n      <node expr=\"textSource_jst\"/>\n    </select>\n  </queryDef>);\nvar res = queryDef.ExecuteQuery();","var processedOffers = ;\nfor each( var emailOfferView in res.emailOfferView )\n{\n  if( processedOffers[String(emailOfferView.@[\"offer-id\"])] != undefined )\n  {\n    logWarning(\"Found 2 or more eff fffffmail representations for offer \" + String(emailOfferView.@[\"offer-id\"]) + \". Only keep the first one here.\");\n    continue;\n  }\n  xtk.session.Write(\n    <offer id= status= xtkschema=\"nms:offer\">\n      <view>\n        \n        \n      </view>\n    </offer>\n  );\n  processedOffers[String(emailOfferView.@[\"offer-id\"])] = 1;\n}","// 3. Get rid of emailOfferView schema now that data has been moved.\nlogInfo(\"Deleting EmailOfferView schema\");\nxtk.session.Write(<srcSchema xtkschema=\"xtk:srcSchema\" name=\"emailOfferView\" namespace=\"nlmig\" _operation=\"delete\"/>);","logInfo(\"Done\");","Tests and configuration","Here is the procedure to follow after having moved the offer content if you only have one environment. In this case let's take \"ENV\" as an example.","In all \"ENV\" environment offer spaces, update the list of fields used. For example, for an offer space that only uses the htmlSource, you must add the view/htmlSource.","In the Type of Environment field within the General tab, select Live.","Create a design environment (\"ENV_DESIGN\", for example) and connect it to the ENV online environment.","Deploy all \"ENV\" environment offer spaces (right click > Actions > Deploy) and select the \"ENV_DESIGN\" environment.","Do the same for all \"ENV\" environment offers.","Activate all environment offers \"ENV_DESIGN\" on the relevant channels.","Test making an offer go live. If you do not encounter any problems, execute pending tasks on the latest workflow task Offer notification (offerMgt) to make all of the offers go live.","Perform comprehensive tests.","NOTE","The names of categories and offers online are modified after going live. On the incoming channel, update all references to offers and categories.","Reports","Standard reports","All standard reports currently use rendering engine v6.x. If you had added JavaScript into these reports, certain elements may no longer work. Indeed, the old version of JavaScript is not compatible with the v6.x rendering engine. You must therefore check the JavaScript code and later adapt it. You should test every report, particularly the exporting function.","Personalized reports","If you wish to benefit from the new report functionalities, you must republish reports. In this case, check all of your scripts and change them if necessary. In regards to PDF export, if you had added specific script for Open Office, this will no longer work with the new PDF export engine (PhantomJS).","Web applications","There are two web application families:","identified web applications (seen together, approval forms, extranet internal developments),\nanonymous web applications (web or questionnaire forms).","Identified web applications","Just as for reports (learn more), if you had added JavaScript, you must check and adapt if necessary. If you wish to benefit from the v7 blue banner (containing the blue tabs), you must republish the web application.","Web application connection methods have changed in v7. If you encounter any connection problems in your identified web applications, you must temporarily activate the allowUserPassword and sessionTokenOnly options in the serverConf.xml file. After the postupgrade, modify these option values:","allowUserPassword=\"true\"","sessionTokenOnly=\"true\"","Therefore, relaunch the postupgrade with the following command:","nlserver config -postupgrade -instance:<instance_name> -force","Test your web applications in the v6.x rendering engine, before publishing them. Then deactivate these two options.","allowUserPassword=\"false\"","sessionTokenOnly=\"false\"","Anonymous web applications"]},{"section":"Tomcat","sectionId":"f29c4ea8-15dd-47c9-a185-1ae6968e4417","paragraphs":["General configurations","This section details the configuration to be carried out in Adobe Campaign v7 when migrating from a v5.11 or a v6.02.","In addition:","If you migrate from v5.11, you must also complete the configuration detailed in this section.\nIf you migrate from v6.02, you must also complete the configuration detailed  in this section.","Time zones","Multi time zone mode","In v6.02, the \"multi time zone\" mode was only available for PostgreSQL database engines. It is now offered no matter what type of database engine is used. We strongly recommend that you transform your base to a \"multi timezone\" base.","To use the TIMESTAMP WITH TIMEZONE mode, you also need to add the -userTimestamptz:1 option to the postupgrade command line.","IMPORTANT","If the -usetimestamptz:1 parameter is used with an incompatible database engine, your database will be corrupted and you will have to restore a backup of your database and re-execute the command above.","NOTE","It is possible to alter the timezone after migration via the console (Administration > Platform > Options > WdbcTimeZone node).","For more on time zone management, refer to this section.","Oracle","If you get an ORA 01805 error during postupgrade, this means that the Oracle timezone files between the application server and the database server are out of sync. To re-synchronize them, apply the following steps:","To identify the time zone file used, run the following command:","select * from v$timezone_file","Time zone files are usually found in the ORACLE_HOME/oracore/zoneinfo/ folder.","Make sure the time zone files are identical on both servers.","For more information, visit: https://docs.oracle.com/cd/E11882_01/server.112/e10729/ch4datetime.htm#NLSPG004.","A time zone misalignment between client and server can also cause some lags. That is why we recommend using the same version of Oracle library on the client and server sides, both time zones must be the same.","To check if both sides are on the same time zones:","Check the version of the time zone file on the client side by running the following command:","genezi -v","genezi is a binary found in $ORACLE_HOME/bin repository.","Check the version of the time zone file on the server side by running the following command:","select * from v$timezone_file","To change the time zone file on the client side, use the ORA_TZFILE environment variable.","Security","Security zones","IMPORTANT","For security reasons, the Adobe Campaign platform is no longer accessible by default: you must configure the security zones, and therefore collect operator IP addresses.","Adobe Campaign v7 involves the concept of security zones. Each user must be associated with a zone in order to log on to an instance and the user's IP address must be included in the addresses or address ranges defined in the security zone. Configuring the security zones can be done in the Adobe Campaign server configuration file. The security zone to which a user is associated must be defined in the console (Administration > Access management > Operators).","Before the migration, ask your network administrator to help you define the security zones to be activated after the migration.","After the postupgrade (before the server restart), you must configure the security zones.","Security zone configuration is found in this section.","User passwords","In v7, internal and admin operator connection must be secured by a password. We strongly recommend assigning passwords to these accounts and all operator accounts, before migration. If you have not specified a password for internal, you will not be able to connect. To assign a password to internal, enter the following command:","nlserver config -internalpassword","IMPORTANT","The internal password must be identical for all the tracking servers. For more information, refer to this section and this section.","New features in v7","Users with no permissions can no longer connect to Adobe Campaign. Their permissions must be manually added, for example, by creating a permission called connect.","Users impacted by this modification are identified and listed during the postupgrade.","Tracking no longer works if the password is empty. If this is the case, an error message will let you know and ask you to reconfigure it.","User passwords are no longer stored in the xtk:sessionInfo schema.","Administration permissions are now necessary to use the xtk:builder:EvaluateJavaScript and xtk:builder:EvaluateJavaScriptTemplate functions.","Certain out-of-the-box schemas have been modified and are now by default only accessible with write access for operators with the admin permission:","ncm:publishing\nnl:monitoring\nnms:calendar\nxtk:builder\nxtk:connections\nxtk:dbInit\nxtk:entityBackupNew\nxtk:entityBackupOriginal\nxtk:entityOriginal\nxtk:form\nxtk:funcList\nxtk:fusion\nxtk:image\nxtk:javascript\nxtk:jssp\nxtk:jst\nxtk:navtree\nxtk:operatorGroup\nxtk:package\nxtk:queryDef\nxtk:resourceMenu\nxtk:rights\nxtk:schema\nxtk:scriptContext\nxtk:specFile\nxtk:sql\nxtk:sqlSchema\nxtk:srcSchema\nxtk:strings\nxtk:xslt","Sessiontoken parameter","In v5, the sessiontoken parameter worked on both client side (list of overview type screens, link editor, etc.) and server side (web applications, reports, jsp, jssp, etc.). In v7, it only works on the server side. If you would like to go back to full functionality as on v5, you must modify the links using this parameter and pass via the connection page:","Link example:","/view/recipientOverview?__sessiontoken=<trusted login>","New link using the connection page:","/nl/jsp/logon.jsp?login=<trusted login>&action=submit&target=/view/recipientOverview","IMPORTANT","If you use an operator linked with a trusted IP mask, check that it has the minimum rights and that it is in a security zone in sessionTokenOnly mode.","SQL Functions","Unknown SQL function calls are no longer naturally sent to the server. Currently, all SQL functions must be added to the xtk:funcList schema (for more on this, refer to this section). When migrating, an option is added during the postupgrade that allows you to maintain compatibility with old undeclared SQL functions. If you would like to continue using these functions, check that the XtkPassUnknownSQLFunctionsToRDBMS option is indeed defined at the Administration > Platform > Options node level.","IMPORTANT","We strongly recommend against using this option due to the security risks it introduces.","JSSP","If you would like to authorize access to certain pages via the HTTP protocol (not HTTPS), in your Web apps for example, regardless of the configuration carried out in the security zones, you must specify the httpAllowed=\"true\" parameter in the corresponding relay rule.","If you use anonymous JSSPs, you must add the httpAllowed=\"true\" parameter in a relay rule for your JSSP (serverConf.xml file):","For example:","<url IPMask=\"\" deny=\"\" hostMask=\"\" httpAllowed=\"true\" relayHost=\"true\" relayPath=\"true\"\n           status=\"blacklist\" targetUrl=\"https://localhost:8080\" timeout=\"\" urlPath=\"*/cus/myPublicPage.jssp\"/>","Syntax","JavaScript","Adobe Campaign v7 integrates a more recent JavaScript interpreter. However, this update may lead to certain scripts malfunctioning. As the previous engine was more permissive, certain syntaxes would work which is no longer the case with the new version of the engine.","The myObject.@attribute syntax is now only valid for XML objects. This syntax may be used for personalizing deliveries and content management. If you used this type of syntax on a non XML object, the personalization features will no longer work.","For all other object types, the syntax is now myObject[\"attribute\"``]. For instance, a non-XML object which used the following syntax: employee.@sn, must now use the following syntax: employee[\"sn\"``].","Former syntax:","employee.@sn","New syntax:","employee[\"sn\"]","To change a value in an XML object, you now need to start by updating the value before you add the XML node:","Old JavaScript code:","var cellStyle = node.style.copy();\nthis.styles.appendChild(cellStyle);\ncellStyle.@width = column.@width;","New JavaScript code:","var cellStyle = node.style.copy();\ncellStyle.@width = column.@width;\nthis.styles.appendChild(cellStyle);","You can no longer use an XML attribute as a table key.","Former syntax:","if(serverForm.activities[ctx.activityHistory.activity[0].@name].type !=\"end\")","New syntax:","if(serverForm.activities[String(ctx.activityHistory.activity[0].@name)].type !=\"end\"","SQLData","In order to strengthen the instance security, a new syntax has been introduced in Adobe Campaign v7 to replace the syntax based on SQLData. If you use these code elements with this syntax, you have to modify them. The main elements concerned are:","Filtering by sub-query: the new syntax is based on the <subQuery>  element to define a sub-query\nAggregates: the new syntax is \"aggregate function(collection)\"\nFiltering by join: the new syntax is [schemaName:alias:xPath]","The queryDef (xtk:queryDef) schema has been modified:","a new <subQuery>  element is available to replace the SELECT included in SQLData\ntwo new values, \"IN\" and \"NOT IN\" are introduced for the @setOperator attribute\na new <where>  element, which is a child of the <node> element: this enables you to make \"sub-selections\" in SELECT","When an \"@expr\" attribute is used, the SQLData may be present. A search for the following terms can be performed: \"SQLData\", \"aliasSqlTable\", \"sql\".","Adobe Campaign v7 instances are secured by default. Security comes in terms of definitions of security zones in the serverConf.xml file: the allowSQLInjection attribute manages the SQL syntax security.","If an SQLData error occurs during postupgrade execution, you must modify this attribute to temporarily allow the use of SQLData based syntaxes, allowing you to rewrite the code. In order to do this, the following option must be changed in the serverConf.xml file:","allowSQLInjection=\"true\"","Therefore, relaunch the postupgrade with the following command:","nlserver config -postupgrade -instance:<instance_name> -force","You must configure the security zones (refer to Security), then reactivate the security by changing the option:","allowSQLInjection=\"false\"","Below you will find comparative examples between the old and new syntax.","Filtering by sub-queries","Former syntax:","<condition expr=\"@id NOT IN ([SQLDATA[SELECT iOperatorId FROM XtkOperatorGroup WHERE iGroupId = $(../@owner-id)]])\" enabledIf=\"$(/ignored/@ownerType)=1\"/>","New syntax:","<condition setOperator=\"NOT IN\" expr=\"@id\" enabledIf=\"$(/ignored/@ownerType)=1\">\n  <subQuery schema=\"xtk:operatorGroup\">\n     <select>\n       <node expr=\"[@operator-id]\" />\n     </select>\n     <where>\n       <condition expr=\"[@group-id]=$long(../@owner-id)\"/>\n     </where>\n   </subQuery>\n</condition>","Former syntax:","<queryFilter name=\"dupEmail\" label=\"Emails duplicated in the folder\" schema=\"nms:recipient\">\n    <where>\n      <condition sql=\"sEmail in (select sEmail from nmsRecipient where iFolderId=$(folderId) group by sEmail having count(sEmail)>1)\" internalId=\"1\"/>\n    </where>\n    <folder _operation=\"none\" name=\"nmsSegment\"/>\n  </queryFilter>","New syntax:","<queryFilter name=\"dupEmail\" label=\" Emails duplicated in the folder \" schema=\"nms:recipient\">\n    <where>\n      <condition expr=\"@email\" setOperator=\"IN\" internalId=\"1\">\n        <subQuery schema=\"nms:recipient\">\n          <select><node expr=\"@email\"/></select>\n          <where><condition expr=\"[@folder-id]=$(folderId)\"/></where>\n          <groupBy><node expr=\"@email\"/></groupBy>\n          <having><condition expr=\"count(@email)>1\"/></having>\n        </subQuery>\n      </condition>\n    </where>\n    <folder _operation=\"none\" name=\"nmsSegment\"/>\n  </queryFilter>","The aggregate","Aggregate function(collection)","Former syntax:","<node sql=\"(select count(*) from NmsNewsgroup WHERE O0.iOperationId=iOperationId)\" alias=\"@nbMessages\"/>","New syntax:","<node expr=\"count([newsgroup/@id])\" alias=\"../@nbMessages\"/>","NOTE","Joints are automatically carried out for the aggregate functions. It is no longer necessary to specify the condition WHERE O0.iOperationId=iOperationId.","It is no longer possible to use the \"count(&#42;)\" function. You must use \"countall()\".","Former syntax:","<node sql=\"(select Sum(iToDeliver) from NmsDelivery WHERE O0.iOperationId=iOperationId AND iSandboxMode=0 AND iState>=45)\" alias=\"@nbMessages\"/>","New syntax:","<node expr=\"Sum([delivery-linkedDelivery/properties/@toDeliver])\" alias= \"../@sumToDeliver\">\n                  <where><condition expr=\"[validation/@sandboxMode]=0 AND @state>=45\" /></where></node>","Filters by joins","[schemaName:alias:xPath]","The alias is optional","Former syntax:","<condition expr=\n                                         aliasSqlTable=/>","New syntax:","<condition expr=/>","Tips and tricks","In a <subQuery> element, to reference a \"field\" field of the main <queryDef>   element, use the following syntax: [../@field]","Example:","<queryDef operation=\"select\" schema=\"xtk:jobLog\" startPath=\"/\" xtkschema=\"xtk:queryDef\">\n  <select>\n    <node expr=\"[job/@pid]\" alias=\"@pid\"/>\n    <node expr=\"@id\" ordered=\"true\"/>\n    <node expr=\"@logType\"/>\n  </select>\n  <where>\n    <condition expr=\"[@job-id]=99\"/>\n    <condition expr=\"@logType\" setOperator=\"IN\">\n      <subQuery schema=\"xtk:jobLog\">\n        <select><node expr=\"@logType\"/></select>\n        <where><condition expr=\"[@job-id]=[../job/@id]\"/></where>\n        <groupBy><node expr=\"@logType\"/></groupBy>\n        <having><condition expr=\"count(@logType)>1\"/></having>\n      </subQuery>\n    </condition>\n  </where>\n</queryDef>","Conflicts","The migration is performed through a postupgrade and conflicts may appear in reports, forms or web applications. These conflicts can be resolved from the console.","After the resource synchronization, the postupgrade command lets you detect if the synchronization generates errors or warnings.","View the synchronization result","The synchronization result can be viewed in two ways:","In the command-line interface, errors are materialized by a triple chevron >>> and synchronization is stopped automatically. Warnings are materialized by a double chevron >> and must be resolved once synchronization is complete. At the end of the postupgrade, a summary is displayed in the command prompt. For example:","2013-04-09 07:48:39.749Z        00002E7A          1     info    log     =========Summary of the update==========\n2013-04-09 07:48:39.749Z        00002E7A          1     info    log     test instance, 6 warning(s) and 0 error(s) during the update.\n2013-04-09 07:48:39.749Z        00002E7A          1     warning log     The document with identifier 'mobileAppDeliveryFeedback' and type 'xtk:report' is in conflict with the new version.\n2013-04-09 07:48:39.749Z        00002E7A          1     warning log     The document with identifier 'opensByUserAgent' and type 'xtk:report' is in conflict with the new version.\n2013-04-09 07:48:39.750Z        00002E7A          1     warning log     The document with identifier 'deliveryValidation' and type 'nms:webApp' is in conflict with the new version.\n2013-04-09 07:48:39.750Z        00002E7A          1     warning log     Document of identifier 'nms:includeView' and type 'xtk:srcSchema' updated in the database and found in the file system. You will have to merge the two versions manually.","If the warning concerns a conflict of resources, operator attention is required to resolve it.","The postupgrade_<server version number>_time of postupgrade>.log file contains the synchronization result. It is available by default in the following directory: installation directory/var/<instance>postupgrade. Errors and warnings are indicated by the error and warning attributes.","Resolve a conflict","Resolving conflicts must only be performed by advanced operators and those that have been given 'Administrator' rights.","To resolve a conflict, apply the following process:","In the Adobe Campaign tree structure, place your cursor over Administration > Configuration > Package management > Edit conflicts.\nSelect the conflict that you want to resolve in the list.","There are three possible ways to resolve a conflict:","Declared as resolved: requires operator intervention beforehand.","Accept the new version: recommended if the resources provided with Adobe Campaign have not been changed by the user.","Keep the current version: means that the update is rejected.","IMPORTANT","If you select this resolution mode, you risk losing patches in the new version. It is therefore strongly recommended that this option is not used or reserved only for expert operators.","If you choose to manually resolve the conflict, proceed as follows:","In the lower section of the window, search for the _conflict_ string to locate the entities with conflicts. The entity installed with the new version contains the new argument, the entity that matches the previous version contains the cus argument.","Delete the version you do not want to keep. Delete the _conflict_argument_ string of the entity you are keeping.","Go to the conflict you would have resolved. Click the Actions icon and select Declare as resolved.","Save your changes: the conflict is now resolved."]},{"section":"Interaction","sectionId":"69c094a8-c6a4-4d6a-80c1-514c710c9c19","paragraphs":[]},{"section":"Prerequisites","sectionId":"79f388d2-e3bc-40a1-b3de-c0af9fb3bc2a","paragraphs":["Before the postupgrade, you must delete all schema references from 6.02 that will no longer exist in v7.","nms:emailOfferView\nnms:webOfferView \nnms:callCenterOfferView \nnms:mobileOfferView \nnms:paperOfferView"]},{"section":"Offer content","sectionId":"0a341fd2-66d7-427d-96fe-e8df1e90a9a4","paragraphs":["In v7, the offer content has been moved. In v6.02 the content was in each representation schema (nms:emailOfferView). In v7, the content is now in the offer schema. After the postupgrade, the content will therefore not be visible in the interface. After the postupgrade, you must recreate the offer content, or develop a script which automatically moves the content from the representation schema to the offer schema.","IMPORTANT","If some deliveries using configured offers were to be sent after the migration, you must delete and recreate all these deliveries in v7. If you cannot do that, a \"compatibility mode\" is offered. This mode is not recommended because you will not benefit from all the new features in Interaction v7. This is a transitional mode which allows you to complete ongoing campaigns before the actual 6.1 migration. For more information regarding this mode, please contact us.","An example of a movement script (interactionTo610_full_XX.js) is available in the Migration folder within the Adobe Campaign v7 folder. This file shows an example of a script for a client using a single email representation per offer (the htmlSource and textSource fields). The content that was in the NmsEmailOfferView table has been moved to the offer table.","NOTE","Using this script does not allow you to benefit from the \"content management\" and \"rendering functions\" options. To benefit from these functions, you must rethink the catalog offers, particularly the offer content and configuration spaces.","loadLibrary(\"/nl/core/shared/nl.js\");","NL.require(\"/nl/core/shared/xtk.js\");","// 1. Restore old emailOfferView schema\nlogInfo(\"Restoring old emailOfferView schema\");\nvar oldOfferViewSchemas = <entities schema=\"xtk:srcSchema\"/>;","oldOfferViewSchemas.appendChild(\n  <srcSchema img=\"nms:offerView.png\"\n             label=\"Email offer representations\"\n             labelSingular=\"Email offer representation\"\n             name=\"emailOfferView\" namespace=\"nlmig\"\n             genAccessors=\"false\" implements=\"xtk:persist\">\n    <element name=\"emailOfferView\" template=\"nms:offerView\" sqltable=\"NmsEmailOfferView\">\n      <element name=\"offer\" revLabel=\"Email representation\" revIntegrity=\"owncopy\"/>\n      <element   name=\"htmlSource\"      type=\"html\" label=\"HTML content\"  xml=\"true\"/>\n      <element   name=\"textSource\"      type=\"CDATA\" label=\"Text content\" xml=\"true\"/>\n      <element   name=\"htmlSource_jst\"  type=\"CDATA\" label=\"HTML script\"  desc=\"HTML content calculation script.\"  xml=\"true\" advanced=\"true\"/>\n      <element   name=\"textSource_jst\"  type=\"CDATA\" label=\"Text script\" desc=\"Text content calculation script.\" xml=\"true\" advanced=\"true\"/>\n    </element>\n  </srcSchema>);","var oldOfferViewsPkg = <builder><package buildNumber=\"*\"></package></builder>;\nxtk.builder.InstallPackage(oldOfferViewsPkg);","// 2. Migrate data from old emailOfferView table to nms:offer\nlogInfo(\"Moving data from old EmailOfferView table to NmsOffer\");\nvar OFFER_STATUS_VALIDATED = 3;","var queryDef = xtk.queryDef.create(\n  <queryDef operation=\"select\" schema=\"nlmig:emailOfferView\">\n    <select>\n      <node expr=\"[@offer-id]\"/>\n      <node expr=\"[@space-id]\"/>\n      <node expr=\"htmlSource_jst\"/>\n      <node expr=\"textSource_jst\"/>\n    </select>\n  </queryDef>);\nvar res = queryDef.ExecuteQuery();","var processedOffers = ;\nfor each( var emailOfferView in res.emailOfferView )\n{\n  if( processedOffers[String(emailOfferView.@[\"offer-id\"])] != undefined )\n  {\n    logWarning(\"Found 2 or more eff fffffmail representations for offer \" + String(emailOfferView.@[\"offer-id\"]) + \". Only keep the first one here.\");\n    continue;\n  }\n  xtk.session.Write(\n    <offer id= status= xtkschema=\"nms:offer\">\n      <view>\n        \n        \n      </view>\n    </offer>\n  );\n  processedOffers[String(emailOfferView.@[\"offer-id\"])] = 1;\n}","// 3. Get rid of emailOfferView schema now that data has been moved.\nlogInfo(\"Deleting EmailOfferView schema\");\nxtk.session.Write(<srcSchema xtkschema=\"xtk:srcSchema\" name=\"emailOfferView\" namespace=\"nlmig\" _operation=\"delete\"/>);","logInfo(\"Done\");"]},{"section":"Tests and configuration","sectionId":"d0c73809-434a-4cf2-8f85-bba0960ed84d","paragraphs":["Here is the procedure to follow after having moved the offer content if you only have one environment. In this case let's take \"ENV\" as an example.","In all \"ENV\" environment offer spaces, update the list of fields used. For example, for an offer space that only uses the htmlSource, you must add the view/htmlSource.","In the Type of Environment field within the General tab, select Live.","Create a design environment (\"ENV_DESIGN\", for example) and connect it to the ENV online environment.","Deploy all \"ENV\" environment offer spaces (right click > Actions > Deploy) and select the \"ENV_DESIGN\" environment.","Do the same for all \"ENV\" environment offers.","Activate all environment offers \"ENV_DESIGN\" on the relevant channels.","Test making an offer go live. If you do not encounter any problems, execute pending tasks on the latest workflow task Offer notification (offerMgt) to make all of the offers go live.","Perform comprehensive tests.","NOTE","The names of categories and offers online are modified after going live. On the incoming channel, update all references to offers and categories."]},{"section":"Reports","sectionId":"5cb1c39a-d5e6-4854-93ae-e45f733f7f88","paragraphs":[]},{"section":"Standard reports","sectionId":"bc70b11f-8f2d-46e5-b10c-a1c85471282a","paragraphs":["All standard reports currently use rendering engine v6.x. If you had added JavaScript into these reports, certain elements may no longer work. Indeed, the old version of JavaScript is not compatible with the v6.x rendering engine. You must therefore check the JavaScript code and later adapt it. You should test every report, particularly the exporting function."]},{"section":"Personalized reports","sectionId":"ac0a2b4a-cb01-4242-b154-11d5d37411d6","paragraphs":["If you wish to benefit from the new report functionalities, you must republish reports. In this case, check all of your scripts and change them if necessary. In regards to PDF export, if you had added specific script for Open Office, this will no longer work with the new PDF export engine (PhantomJS)."]},{"section":"Web applications","sectionId":"21370f54-cf41-425f-a1bf-5637ba879263","paragraphs":["There are two web application families:","identified web applications (seen together, approval forms, extranet internal developments),\nanonymous web applications (web or questionnaire forms)."]},{"section":"Identified web applications","sectionId":"61fbee84-99fd-4891-b687-bea4bbcb8549","paragraphs":["Just as for reports (learn more), if you had added JavaScript, you must check and adapt if necessary. If you wish to benefit from the v7 blue banner (containing the blue tabs), you must republish the web application.","Web application connection methods have changed in v7. If you encounter any connection problems in your identified web applications, you must temporarily activate the allowUserPassword and sessionTokenOnly options in the serverConf.xml file. After the postupgrade, modify these option values:","allowUserPassword=\"true\"","sessionTokenOnly=\"true\"","Therefore, relaunch the postupgrade with the following command:","nlserver config -postupgrade -instance:<instance_name> -force","Test your web applications in the v6.x rendering engine, before publishing them. Then deactivate these two options.","allowUserPassword=\"false\"","sessionTokenOnly=\"false\""]},{"section":"Anonymous web applications","sectionId":"54408c81-3366-4cea-898f-12da51a2298b","paragraphs":["If you encounter any problems, republish the web application."]}]}