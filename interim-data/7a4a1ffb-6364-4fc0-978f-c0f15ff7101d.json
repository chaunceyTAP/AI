{"guid":"7a4a1ffb-6364-4fc0-978f-c0f15ff7101d","title":"Testing the migration","path":"help\\migration\\using\\testing-the-migration.md","fullText":"---\nproduct: campaign\ntitle: Testing the migration\ndescription: Testing the migration\nfeature: Upgrade\naudience: migration\ncontent-type: reference\ntopic-tags: migration-procedure\nhide: yes\nhidefromtoc: yes\nexl-id: 228ee9e4-46a0-4d82-b8ba-b019bc0e7cac\n---\n# Migration tests{#testing-the-migration}\n\n\n\n## General procedure {#general-procedure}\n\nDepending on your configuration, there are several ways of carrying out migration tests.\n\nYou should have a test/development environment to carry out migration tests. Adobe Campaign environments are subject to license: check your license contract or contact your Adobe representative.\n\n1. Stop all developments in progress and carry them over to the production environment.\n1. Make a backup of the development environment database.\n1. Stop all Adobe Campaign processes on the development instance.\n1. Make a backup of the production environment database and restore it as a development environment.\n1. Before starting the Adobe Campaign services, run the **freezeInstance.js** cauterization script which lets you clear the database of any objects that were running when the backup was started.\n\n   ```\n   nlserver javascript nms:freezeInstance.js -instance:<instance> -arg:<run|dry>\n   ```\n\n   >[!NOTE]\n   >\n   >The command launches by default in **dry** mode, and lists all the requests that were executed by that command, without launching them. To execute cauterization requests, use **run** in the command.\n\n1. Make sure your backups are correct by trying to restore them. Make sure you can access your database, your tables, your data, etc.\n1. Test the migration procedure in the development environment.\n1. If the migration of the development environment is successful, you can migrate the production environment.\n\n>[!CAUTION]\n>\n>Due to changes made to the data structure, importing and exporting data packages is not possible between a v5 platform and a v7 platform.\n\n\n## Migration tools {#migration-tools}\n\nVarious options let you measure the impact from a migration and identify the potential problems. These options are to be executed:\n\n* in the **config** command:\n\n  ```\n  nlserver.exe config <option> -instance:<instance-name>\n  ```\n\n* or at the postupgrade:\n\n  ```\n  nlserver.exe config -postupgrade <option> -instance:<instance-name>\n  ```\n\n>[!NOTE]\n>\n>* You must use the **-instance:`<instanceame>`** option. We do not recommend using the **-allinstances** option.\n>* The Adobe Campaign update command (**postupgrade**) lets you synchronize resources and update schemas and the database. This operation can only be carried out once and only on the application server. After synchronizing resources, the **postupgrade** command lets you detect whether the synchronization generates any errors or warnings.\n\n### Non-standard or missing objects\n\n* The **-showCustomEntities** option displays the list of all non-standard objects:\n\n  ```\n  nlserver.exe config -showCustomEntities -instance:<instance-name>\n  ```\n\n  Example of a sent message:\n\n  ```\n  xtk_migration:opsecurity2 xtk:entity\n  ```\n\n* The **-showDeletedEntities** option displays the list of all the standard objects that are missing in the database or the file system. For each missing object, the path is specified.\n\n  ```\n  nlserver.exe config -showDeletedEntities -instance:<instance-name>\n  ```\n\n  Example of a sent message:\n\n  ```\n  Out of the box object 'nms:deliveryCustomizationMdl' belonging to the 'xtk:srcSchema' schema has not been found in the file system.\n  ```\n\n### Verification process {#verification-process}\n\nIntegrated as standard in the postupgrade command, this process lets you display warnings and errors that could make the migration fail. **If errors are displayed, the migration has not been executed.** If this happens, correct all the errors then re-start the postupgrade.\n\nYou can start the verification process on its own (without migration) using the command:\n\n```\nnlserver.exe config -postupgrade -check -instance:<instance-name>\n```\n\n>[!NOTE]\n>\n>You can ignore all warnings and errors with the JST-310040 code.\n\nThe following expressions are searched for (case sensitive):\n\n<table> \n <thead> \n  <tr> \n   <th> Expression<br /> </th> \n   <th> Error code<br /> </th> \n   <th> Log type<br /> </th> \n   <th> Comments<br /> </th> \n  </tr> \n </thead> \n <tbody> \n  <tr> \n   <td> .@<br /> </td> \n   <td> PU-0001<br /> </td> \n   <td> Warning<br /> </td> \n   <td> This type of syntax is no longer supported in delivery personalization. <br /> </td> \n  </tr> \n  <tr> \n   <td> common.js<br /> </td> \n   <td> PU-0002<br /> </td> \n   <td> Warning<br /> </td> \n   <td> This library must not be used.<br /> </td> \n  </tr> \n  <tr> \n   <td> logon(<br /> </td> \n   <td> PU-0003<br /> </td> \n   <td> Warning<br /> </td> \n   <td> This connection method must be no longer be used.<br /> </td> \n  </tr> \n  <tr> \n   <td> new SoapMethodCall(<br /> </td> \n   <td> PU-0004<br /> </td> \n   <td> Warning<br /> </td> \n   <td> This function is only supported when it is used in JavaScript code executed from a security zone that is in <strong>sessionTokenOnly</strong> mode.<br /> </td> \n  </tr> \n  <tr> \n   <td> sql=<br /> </td> \n   <td> PU-0005<br /> </td> \n   <td> Error<br /> </td> \n   <td> This type of error leads to a migration failure.<br /> </td> \n  </tr> \n  <tr> \n   <td> crmDeploymentType=\"onpremise\"<br /> </td> \n   <td> PU-0007<br /> </td> \n   <td> Error<br /> </td> \n   <td> This type of deployment is no longer supported. Office 365 and On-premise Microsoft CRM connector deployment type have now been deprecated. \n   </br>If you are using one of these deprecated deployment types in an external account, this external account should be deleted and you should then run the <b>postupgrade</b> command. \n   </br>To change to Web API deployment, refer to <a href=\"../../platform/using/crm-ms-dynamics.md#configure-acc-for-microsoft\" target=\"_blank\">Web applications</a>.<br /> </td>\n  </tr> \n  <tr> \n   <td> CRM v1(mscrmWorkflow/sfdcWorkflow)<br /> </td> \n   <td> PU-0008<br /> </td> \n   <td> Error<br /> </td> \n   <td> Microsoft CRM, Salesforce, Oracle CRM On Demand action activities are no longer available. To configure the data synchronization between Adobe Campaign and a CRM system, you need to use the <a href=\"../../workflow/using/crm-connector.md\" target=\"_blank\">CRM connector</a> targeting activity.<br /> </td>\n  </tr> \n </tbody> \n</table>\n\nA database and schema coherence check is also carried out.\n\n### Restoration option {#restoration-option}\n\nThis option lets you restore out-of-the-box objects if they had been modified. For each restored object, a backup of your changes is stored in the selected folder:\n\n```\nnlserver.exe config -postupgrade -restoreFactory:<backupfolder> -instance:<instance-name>\n```\n\n>[!NOTE]\n>\n>We strongly recommend using absolute folder paths and keeping the folder tree structure. For example: backupFolder\\nms\\srcSchema\\billing.xml.\n\n### Resume the migration {#resuming-migration}\n\nIf you restart the postupgrade after a migration failure, it resumes from the same place it was stopped.\n","headers":[["title","Testing the migration"],["description","Testing the migration"],["feature","Upgrade"],["topic-tags","migration-procedure"]],"sections":[{"section":"Migration tests","sectionId":"259b5831-4860-4256-8155-d91b93d7334e","paragraphs":[]},{"section":"General procedure","sectionId":"ae4c0a8a-e4fa-4d8b-9f7f-35fd854440ba","paragraphs":["Depending on your configuration, there are several ways of carrying out migration tests.","You should have a test/development environment to carry out migration tests. Adobe Campaign environments are subject to license: check your license contract or contact your Adobe representative.","Stop all developments in progress and carry them over to the production environment.","Make a backup of the development environment database.","Stop all Adobe Campaign processes on the development instance.","Make a backup of the production environment database and restore it as a development environment.","Before starting the Adobe Campaign services, run the freezeInstance.js cauterization script which lets you clear the database of any objects that were running when the backup was started.","nlserver javascript nms:freezeInstance.js -instance:<instance> -arg:<run|dry>","NOTE","The command launches by default in dry mode, and lists all the requests that were executed by that command, without launching them. To execute cauterization requests, use run in the command.","Make sure your backups are correct by trying to restore them. Make sure you can access your database, your tables, your data, etc.","Test the migration procedure in the development environment.","If the migration of the development environment is successful, you can migrate the production environment.","CAUTION","Due to changes made to the data structure, importing and exporting data packages is not possible between a v5 platform and a v7 platform."]},{"section":"Migration tools","sectionId":"b7985311-8871-45cf-8640-a1bd36d135be","paragraphs":["Various options let you measure the impact from a migration and identify the potential problems. These options are to be executed:","in the config command:","nlserver.exe config <option> -instance:<instance-name>","or at the postupgrade:","nlserver.exe config -postupgrade <option> -instance:<instance-name>","NOTE","You must use the -instance:<instanceame> option. We do not recommend using the -allinstances option.\nThe Adobe Campaign update command (postupgrade) lets you synchronize resources and update schemas and the database. This operation can only be carried out once and only on the application server. After synchronizing resources, the postupgrade command lets you detect whether the synchronization generates any errors or warnings."]},{"section":"Non-standard or missing objects","sectionId":"38076fe3-5222-43de-b655-8a22044beda8","paragraphs":["The -showCustomEntities option displays the list of all non-standard objects:","nlserver.exe config -showCustomEntities -instance:<instance-name>","Example of a sent message:","xtk_migration:opsecurity2 xtk:entity","The -showDeletedEntities option displays the list of all the standard objects that are missing in the database or the file system. For each missing object, the path is specified.","nlserver.exe config -showDeletedEntities -instance:<instance-name>","Example of a sent message:","Out of the box object 'nms:deliveryCustomizationMdl' belonging to the 'xtk:srcSchema' schema has not been found in the file system."]},{"section":"Verification process","sectionId":"64f4e7fc-6152-4b3c-a2df-9c051208d06a","paragraphs":["Integrated as standard in the postupgrade command, this process lets you display warnings and errors that could make the migration fail. If errors are displayed, the migration has not been executed. If this happens, correct all the errors then re-start the postupgrade.","You can start the verification process on its own (without migration) using the command:","nlserver.exe config -postupgrade -check -instance:<instance-name>","NOTE","You can ignore all warnings and errors with the JST-310040 code.","The following expressions are searched for (case sensitive):","TABLE: Expression Error code Log type Comments .@ PU-0001 Warning This type of syntax is no longer supported in delivery personalization. common.js PU-0002 Warning This library must not be used. logon( PU-0003 Warning This connection method must be no longer be used. new SoapMethodCall( PU-0004 Warning This function is only supported when it is used in JavaScript code executed from a security zone that is in sessionTokenOnly mode. sql= PU-0005 Error This type of error leads to a migration failure. crmDeploymentType=\"onpremise\" PU-0007 Error This type of deployment is no longer supported. Office 365 and On-premise Microsoft CRM connector deployment type have now been deprecated. \n   If you are using one of these deprecated deployment types in an external account, this external account should be deleted and you should then run the postupgrade command. \n   To change to Web API deployment, refer to Web applications. CRM v1(mscrmWorkflow/sfdcWorkflow) PU-0008 Error Microsoft CRM, Salesforce, Oracle CRM On Demand action activities are no longer available. To configure the data synchronization between Adobe Campaign and a CRM system, you need to use the CRM connector targeting activity.","A database and schema coherence check is also carried out."]},{"section":"Restoration option","sectionId":"e597acba-eda9-47c7-a901-0c97fbb67547","paragraphs":["This option lets you restore out-of-the-box objects if they had been modified. For each restored object, a backup of your changes is stored in the selected folder:","nlserver.exe config -postupgrade -restoreFactory:<backupfolder> -instance:<instance-name>","NOTE","We strongly recommend using absolute folder paths and keeping the folder tree structure. For example: backupFolder\\nms\\srcSchema\\billing.xml."]},{"section":"Resume the migration","sectionId":"907bfe60-7f64-4837-b112-638348832f46","paragraphs":["If you restart the postupgrade after a migration failure, it resumes from the same place it was stopped."]}]}