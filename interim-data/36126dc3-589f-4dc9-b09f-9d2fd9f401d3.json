{"guid":"36126dc3-589f-4dc9-b09f-9d2fd9f401d3","title":"SQL Data Management","path":"help\\workflow\\using\\sql-data-management.md","fullText":"---\nproduct: campaign\ntitle: SQL Data Management\ndescription: Learn more about SQL Data Management workflow activity\nfeature: Workflows\nexl-id: cada78cb-658f-4b9e-8136-31c17cb1d82f\n---\n# SQL Data Management{#sql-data-management}\n\n\n\nThe **SQL Data Management** activity lets you write your own SQL scripts to create and populate work tables.\n\n## Prerequisites {#prerequisites}\n\nBefore configuring the activity, make sure the following prerequisites are fulfilled:\n\n* The activity is available for remote data sources only. The **[!UICONTROL FDA]** (Federated Data Access) package must therefore be installed on your instance. [Learn more](../../installation/using/about-fda.md).\n\n     For more on this, depending on your Campaign version, refer to these sections:\n   \n    ![](assets/do-not-localize/v7.jpeg)[  Campaign v7 documentation](../../installation/using/about-fda.md)\n\n    ![](assets/do-not-localize/v8.png)[  Campaign v8 documentation](https://experienceleague.adobe.com/docs/campaign/campaign-v8/connect/fda.html)\n\n* The Outbound schema must exist in the database and be linked to an FDA database.\n* The operator executing the workflow must have the **[!UICONTROL USE SQL DATA MANAGEMENT ACTIVITY (useSqlDmActivity)]** named right. [Learn more](../../platform/using/access-management-named-rights.md).\n\n## Configuring the SQL Data Management activity {#configuring-the-sql-data-management-activity}\n\n1. Specify the activity **[!UICONTROL Label]**.\n1. Select the **[!UICONTROL External account]** to use, then select the **[!UICONTROL Outbound schema]** linked to this external account.\n\n   >[!CAUTION]\n   >\n   >The Outbound schema is fixed and cannot be edited.\n\n1. Add the SQL script.\n\n   >[!CAUTION]\n   >\n   >It is the SQL script writer's responsibility to make sure that the SQL script is functional, and that its references (fields names, etc.) are in accordance with the Outbound schema.\n\n   If you want to load an existing SQL code, select the **[!UICONTROL The SQL script is contained in an entity stored in the database]** option. SQL scripts must be created and stored in the **[!UICONTROL Administration]** / **[!UICONTROL Configuration]** / **[!UICONTROL SQL scripts]** menu.\n\n   Otherwise, type or copy-paste your SQL script in the dedicated area.\n\n   ![](assets/sql_datamanagement.png)\n\n   The activity lets you use the following variables in the script:\n\n    * **activity.tableName**: SQL name of the outbound work table.\n    * **task.incomingTransitionByName(‘name’).tableName**: SQL name of the work table carried by the incoming transition to use (the transition is identified by its name).\n\n      >[!NOTE]\n      >\n      >The ('name') value corresponds to the **[!UICONTROL Name]** field from the transition properties.\n\n1. If the SQL script already contains commands to create an outbound work table, unselect the **[!UICONTROL Automatically create work table]** option. Otherwise, a work table is automatically created once the workflow executes.\n1. Click **[!UICONTROL Ok]** to confirm the activity configuration.\n\nThe activity is now configured. It is ready to be executed in the workflow.\n\n>[!CAUTION]\n>\n>Once the activity executed, the outbound transition records count is indicative only. It may vary according to the level of complexity of the SQL script. \n>  \n>If the activity is restarted, the whole script is executed from its beginning, regardless of it execution status.\n\n## SQL script samples {#sql-script-samples}\n\n>[!NOTE]\n>\n>The script samples in this section are meant to be executed under PostgreSQL.\n\nBelow script lets you create a work table and insert data into this same work table:\n\n```\nCREATE UNLOGGED TABLE <%= activity.tableName %> (\n  iRecipientId INTEGER DEFAULT 0,\n  sFirstName VARCHAR(100),\n  sMiddleName VARCHAR(100),\n  sLastName VARCHAR(100),\n  sEmail VARCHAR(100)\n);\n\nINSERT INTO <%= activity.tableName %>\nSELECT iRecipientId, sFirstName, sMiddleName, sLastName, sEmail\nFROM nmsRecipient\nGROUP BY iRecipientId, sFirstName, sMiddleName, sLastName, sEmail;\n```\n\nBelow script lets you perform a CTAS operation (CREATE TABLE AS SELECT) and create a work table index:\n\n```\nCREATE TABLE <%= activity.tableName %>\nAS SELECT iRecipientId, sEmail, sFirstName, sLastName, sMiddleName\nFROM nmsRecipient\nWHERE sEmail IS NOT NULL\nGROUP BY iRecipientId, sEmail, sFirstName, sLastName, sMiddleName;\n\nCREATE INDEX ON <%= activity.tableName %> (sEmail);\n\nANALYZE <%= activity.tableName %> (sEmail);\n```\n\nBelow script lets you merge two working tables:\n\n```\nCREATE TABLE <%= activity.tableName %>\nAS SELECT i1.sFirstName, i1.sLastName, i2.sEmail\nFROM <%= task.incomingTransitionByName('input1').tableName %> i1\nJOIN <%= task.incomingTransitionByName('input2').tableName %> i2 ON (i1.id = i2.id)\n```\n","headers":[["title","SQL Data Management"],["description","Learn more about SQL Data Management workflow activity"],["feature","Workflows"]],"sections":[{"section":"SQL Data Management","sectionId":"8e91a106-d44c-4428-962c-878336bfe704","paragraphs":["The SQL Data Management activity lets you write your own SQL scripts to create and populate work tables."]},{"section":"Prerequisites","sectionId":"982ce3c6-ab0a-4ea9-b462-e2cfffd6cc90","paragraphs":["Before configuring the activity, make sure the following prerequisites are fulfilled:","The activity is available for remote data sources only. The FDA (Federated Data Access) package must therefore be installed on your instance. Learn more.","For more on this, depending on your Campaign version, refer to these sections:","Campaign v7 documentation","Campaign v8 documentation","The Outbound schema must exist in the database and be linked to an FDA database.","The operator executing the workflow must have the USE SQL DATA MANAGEMENT ACTIVITY (useSqlDmActivity) named right. Learn more."]},{"section":"Configuring the SQL Data Management activity","sectionId":"5639beb5-f7c2-4511-86ce-2be910ee5c3c","paragraphs":["Specify the activity Label.","Select the External account to use, then select the Outbound schema linked to this external account.","CAUTION","The Outbound schema is fixed and cannot be edited.","Add the SQL script.","CAUTION","It is the SQL script writer's responsibility to make sure that the SQL script is functional, and that its references (fields names, etc.) are in accordance with the Outbound schema.","If you want to load an existing SQL code, select the The SQL script is contained in an entity stored in the database option. SQL scripts must be created and stored in the Administration / Configuration / SQL scripts menu.","Otherwise, type or copy-paste your SQL script in the dedicated area.","The activity lets you use the following variables in the script:","activity.tableName: SQL name of the outbound work table.","task.incomingTransitionByName(‘name’).tableName: SQL name of the work table carried by the incoming transition to use (the transition is identified by its name).","NOTE","The ('name') value corresponds to the Name field from the transition properties.","If the SQL script already contains commands to create an outbound work table, unselect the Automatically create work table option. Otherwise, a work table is automatically created once the workflow executes.","Click Ok to confirm the activity configuration.","The activity is now configured. It is ready to be executed in the workflow.","CAUTION","Once the activity executed, the outbound transition records count is indicative only. It may vary according to the level of complexity of the SQL script.","If the activity is restarted, the whole script is executed from its beginning, regardless of it execution status."]},{"section":"SQL script samples","sectionId":"4ce31fea-1374-4c3a-895c-5ae5a99094c5","paragraphs":["NOTE","The script samples in this section are meant to be executed under PostgreSQL.","Below script lets you create a work table and insert data into this same work table:","CREATE UNLOGGED TABLE <%= activity.tableName %> (\n  iRecipientId INTEGER DEFAULT 0,\n  sFirstName VARCHAR(100),\n  sMiddleName VARCHAR(100),\n  sLastName VARCHAR(100),\n  sEmail VARCHAR(100)\n);","INSERT INTO <%= activity.tableName %>\nSELECT iRecipientId, sFirstName, sMiddleName, sLastName, sEmail\nFROM nmsRecipient\nGROUP BY iRecipientId, sFirstName, sMiddleName, sLastName, sEmail;","Below script lets you perform a CTAS operation (CREATE TABLE AS SELECT) and create a work table index:","CREATE TABLE <%= activity.tableName %>\nAS SELECT iRecipientId, sEmail, sFirstName, sLastName, sMiddleName\nFROM nmsRecipient\nWHERE sEmail IS NOT NULL\nGROUP BY iRecipientId, sEmail, sFirstName, sLastName, sMiddleName;","CREATE INDEX ON <%= activity.tableName %> (sEmail);","ANALYZE <%= activity.tableName %> (sEmail);","Below script lets you merge two working tables:","CREATE TABLE <%= activity.tableName %>\nAS SELECT i1.sFirstName, i1.sLastName, i2.sEmail\nFROM <%= task.incomingTransitionByName('input1').tableName %> i1\nJOIN <%= task.incomingTransitionByName('input2').tableName %> i2 ON (i1.id = i2.id)"]}]}