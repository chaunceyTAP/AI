{"guid":"00c8eb91-430a-4ef3-90f3-4084a1725601","title":"Distributed architectures","path":"help\\interaction\\using\\distributed-architectures.md","fullText":"---\nproduct: campaign\ntitle: Distributed architectures\ndescription: Distributed architectures\nfeature: Interaction, Offers, Architecture\naudience: interaction\ncontent-type: reference\ntopic-tags: advanced-parameters\nexl-id: 083be073-aad4-4c81-aff2-77f5ef3e80db\n---\n# Distributed architectures{#distributed-architectures}\n\n\n\n## Principle {#principle}\n\nTo be able to support scalability and provide 24/7 service on the inbound channel, you can use Interaction with a distributed architecture. This type of architecture is already used with Message Center and is made up of several instances:\n\n* one or several control instances dedicated to the outbound channel and containing the marketing and environment design base\n* one or several execution instances dedicated to inbound channel\n\n![](assets/interaction_powerbooster_schema.png)\n\n>[!NOTE]\n>\n>Control instances are dedicated to the inbound channel and contain the online version of the catalog. Every execution instance is independent and dedicated to one contact segment (for example, one execution instance per country). Offer engine call-ups must be directly performed on the execution (one specific URL per execution instance). As synchronization between instances is not automatic, interactions from the same contact must be sent through the same instance.\n\n## Proposition synchronization {#proposition-synchronization}\n\nOffer synchronization is carried out via packages. On execution instances, all catalog objects are prefixed by the external account name. This means several control instances (development and production instances for example) can be supported on one same execution instance.\n\n>[!IMPORTANT]\n>\n>We recommend you use short and explicit internal names.\n\nOffers are automatically deployed then published on execution and control instances.\n\nOffers deleted in the design environment are disabled on all online instances. Obsolete propositions and offers are automatically deleted on all instances after the purge period (specified in each instance's deployment assistant) and sliding period (specified in the incoming propositions' typology rules).\n\n![](assets/interaction_powerbooster_schema2.png)\n\nA workflow is created for each environment and external account for proposition synchronization. Synchronization frequency can be adjusted for each environment and external account.\n\n## Limitations {#limitations}\n\n* If you use the fall back function from an anonymous environment to an identified environment, these two environments must be on the same execution instance. \n* The synchronization between several execution instances is not performed in real time. Interactions of the same contact must be sent to the same instance. The control instance must be dedicated to the outbound channel (no real time).\n* The marketing database is not automatically synchronized. The marketing data used in the weights and eligibility rules must be duplicated on execution instances. This process does not come as standard, you must develop it during the integration period. \n* Proposition synchronization is carried out exclusively by FDA connection.\n* If you use Interaction and Message Center on the same instance, synchronization will occur via FDA protocol in both cases.\n\n## Packages configuration {#packages-configuration}\n\nAny schema extensions directly linked to **Interaction** (offers, propositions, recipients, etc.) must be deployed on the execution instances.\n\nThe Interaction package must be installed on all instances (control and execution). Two additional packages are available: one package to be installed on the control instances, and another to be installed on each execution instance.\n\n>[!NOTE]\n>\n>When installing the package, the **long** type fields of the **nms:proposition** table such as the proposition ID, become **int64** type fields. This type of data is detailed in the [this section](../../configuration/using/schema-structure.md#mapping-the-types-of-adobe-campaign-dbms-data).\n\nThe data retention duration must be configured on each instance (via the **[!UICONTROL Data purge]** window in the deployment wizard). On execution instances, this period must correspond to the historical depth necessary for typology rules (sliding period) and eligibility rules to be calculated.\n\nOn the control instances:\n\n1. Create an external account by execution instance:\n\n   ![](assets/interaction_powerbooster1.png)\n\n    * Complete the label and add a short and explicit internal name.\n    * Select the **[!UICONTROL Execution instance]**.\n    * Check the **[!UICONTROL Enabled]** option.\n    * Complete the connection parameters for the execution instance.\n    * Every execution instance must be linked to an ID. This ID is assigned when you click on the **[!UICONTROL Initialize connection]** button.\n    * Check the type of application used: **[!UICONTROL Message Center]**, **[!UICONTROL Interaction]**, or both.\n    * Enter the FDA account used. An operator must be created on the execution instances and must have the following read and write rights on the database of the instance in question:\n\n      ```    \n      grant SELECT ON nmspropositionrcp, nmsoffer, nmsofferspace, xtkoption, xtkfolder TO user;\n      grant DELETE, INSERT, UPDATE ON nmspropositionrcp TO user;\n      ```\n\n   >[!NOTE]\n   >\n   >The IP address of the control instance must be authorized on the execution instances.\n\n1. Configure the environment:\n\n   ![](assets/interaction_powerbooster2.png)\n\n    * Add the list of execution instances.\n    * For each one, specify the synchronization period and filter criteria (for example, by country).\n\n      >[!NOTE]\n      >\n      >If you encounter an error, you can consult the synchronization workflows and offer notifications. These can be found in the technical workflows of the application.\n\nIf, for optimization reasons, only part of the marketing database is duplicated on the execution instances, you can specify a restricted schema linked to the environment to allow the users to only use data that is available on the execution instances. You can create an offer using data that is not available on execution instances. To do this, you must deactivate the rule on the other channels by limiting this rule on the outbound channel (**[!UICONTROL Taken into account if]** field).\n\n![](assets/ita_filtering.png)\n\n## Maintenance options {#maintenance-options}\n\nHere is a list of maintenance options available on the control instance:\n\n>[!IMPORTANT]\n>\n>These options must only be used for specific maintenance cases.\n\n* **`NmsInteraction_LastOfferEnvSynch_<offerEnvId>_<executionInstanceId>`**: last date that an environment was synced on a given instance.\n* **`NmsInteraction_LastPropositionSynch_<propositionSchema>_<executionInstanceIdSource>_<executionInstanceIdTarget>`**: last date that propositions from a given schema were synced from one instance to another.\n* **`NmsInteraction_MapWorkflowId`**: an option containing the list of all synchronization workflows generated.\n\nThe following option is available on execution instances:\n\n**NmsExecutionInstanceId**: option containing the instance ID.\n\n## Packages installation {#packages-installation}\n\nIf your instance did not previously have the Interaction package, no migration is necessary. By default, the proposition table will be in 64 bits after the packages have been installed.\n\n>[!IMPORTANT]\n>\n>Depending on the volume of existing propositions in your instance, this operation may take a while.\n\n* If your instance has little or no propositions, no manual modification of the proposition table is necessary. The modification will be done when packages are installed.\n* If your instance has a lot of propositions, it is better to change the structure of the propositions table before installing the control packages and running them. We recommend running the queries during a low-activity period.\n\n>[!NOTE]\n>\n>If you have carried out specific configurations in the proposition table, adapt the queries accordingly.\n\n### PostgreSQL {#postgresql}\n\nThere are two methods. The first (using a work table) is slightly faster.\n\n**Work table**\n\n```\nCREATE TABLE NmsPropositionRcp_tmp AS SELECT * FROM nmspropositionrcp WHERE 0=1;\nALTER TABLE nmspropositionrcp_tmp\n  ALTER COLUMN ipropositionid TYPE bigint,\n  ALTER COLUMN iinteractionid TYPE bigint;\nINSERT INTO nmspropositionrcp_tmp SELECT * FROM nmspropositionrcp;\nDROP TABLE nmspropositionrcp;\nCREATE INDEX proposition_id ON NmsPropositionRcp (ipropositionid);\nCREATE INDEX nmspropositionrcp_deliveryid ON NmsPropositionRcp (ideliveryid);\nCREATE INDEX nmspropositionrcp_lastmodified ON NmsPropositionRcp (tslastmodified);\nCREATE INDEX nmspropositionrcp_offerid ON NmsPropositionRcp (iofferid);\nCREATE INDEX nmspropositionrcp_offerspaceid ON NmsPropositionRcp (iofferspaceid);\nCREATE INDEX nmspropositionrcp_recipientidid ON NmsPropositionRcp (irecipientid);\nALTER TABLE nmspropositionrcp_tmp RENAME TO nmspropositionrcp;\n```\n\n**Alter Table**\n\n```\nALTER TABLE nmspropositionrcp\n  ALTER COLUMN ipropositionid TYPE bigint,\n  ALTER COLUMN iinteractionid TYPE bigint;\n```\n\n### Oracle {#oracle}\n\nEditing the size of a **Number** type does not lead to values or the index being re-written. It is therefore immediate.\n\nThe query to be executed is as follows:\n\n```\nALTER TABLE nmspropositionrcp MODIFY (\nipropositionid NUMBER(19, 0),\niinteractionid NUMBER(19, 0)\n);\n```\n\n### MSSQL {#mssql}\n\nThe queries to be executed are as follows:\n\n```\nSELECT * INTO NmsPropositionRcp_tmp FROM NmsPropositionRcp WHERE 1 = 0;\nGO\nALTER TABLE NmsPropositionRcp_tmp ALTER COLUMN ipropositionid BIGINT;\nGO\nALTER TABLE NmsPropositionRcp_tmp ALTER COLUMN iinteractionid BIGINT;\nGO\nINSERT INTO NmsPropositionRcp_tmp SELECT * FROM NmsPropositionRcp;\nGO\nDROP TABLE NmsPropositionRcp;\nGO\nsp_rename 'NmsPropositionRcp_tmp', NmsPropositionRcp\nGO\nALTER TABLE NmsPropositionRcp ADD DEFAULT ((0)) FOR dWeight\nGO\nALTER TABLE NmsPropositionRcp ADD DEFAULT ((0)) FOR iDeliveryId\nGO\nALTER TABLE NmsPropositionRcp ADD DEFAULT ((0)) FOR iEngineType\nGO\nALTER TABLE NmsPropositionRcp ADD DEFAULT ((0)) FOR iInteractionId\nGO\nALTER TABLE NmsPropositionRcp ADD DEFAULT ((0)) FOR iOfferId\nGO\nALTER TABLE NmsPropositionRcp ADD DEFAULT ((0)) FOR iOfferSpaceId\nGO\nALTER TABLE NmsPropositionRcp ADD DEFAULT ((0)) FOR iPropositionId\nGO\nALTER TABLE NmsPropositionRcp ADD DEFAULT ((0)) FOR iRank\nGO\nALTER TABLE NmsPropositionRcp ADD DEFAULT ((0)) FOR iRecipientId\nGO\nALTER TABLE NmsPropositionRcp ADD DEFAULT ((0)) FOR iStatus\nGO\nCREATE NONCLUSTERED INDEX NmsPropositionRcp_deliveryId ON NmsPropositionRcp (iDeliveryId)\nGO\nCREATE NONCLUSTERED INDEX NmsPropositionRcp_eventDate ON NmsPropositionRcp (tsEvent)\nGO\nCREATE UNIQUE NONCLUSTERED INDEX NmsPropositionRcp_id ON NmsPropositionRcp (iPropositionId)\nGO\nCREATE NONCLUSTERED INDEX NmsPropositionRcp_lastModified ON NmsPropositionRcp (tsLastModified)\nGO\nCREATE NONCLUSTERED INDEX NmsPropositionRcp_offerId ON NmsPropositionRcp (iOfferId)\nGO\nCREATE NONCLUSTERED INDEX NmsPropositionRcp_offerSpaceI ON NmsPropositionRcp (iOfferSpaceId)\nGO\nCREATE NONCLUSTERED INDEX NmsPropositionRcp_recipientId ON NmsPropositionRcp (iRecipientId)\nGO\n```\n","headers":[["title","Distributed architectures"],["description","Distributed architectures"],["feature","Interaction, Offers, Architecture"],["topic-tags","advanced-parameters"]],"sections":[{"section":"Distributed architectures","sectionId":"e217af1b-b071-4561-82f7-a9d96c26a5ab","paragraphs":[]},{"section":"Principle","sectionId":"a32eaa12-87f7-4b0c-a11e-e88e1069b68d","paragraphs":["To be able to support scalability and provide 24/7 service on the inbound channel, you can use Interaction with a distributed architecture. This type of architecture is already used with Message Center and is made up of several instances:","one or several control instances dedicated to the outbound channel and containing the marketing and environment design base\none or several execution instances dedicated to inbound channel","NOTE","Control instances are dedicated to the inbound channel and contain the online version of the catalog. Every execution instance is independent and dedicated to one contact segment (for example, one execution instance per country). Offer engine call-ups must be directly performed on the execution (one specific URL per execution instance). As synchronization between instances is not automatic, interactions from the same contact must be sent through the same instance."]},{"section":"Proposition synchronization","sectionId":"7c285fbb-97a9-4462-888e-e1b10bb2c38f","paragraphs":["Offer synchronization is carried out via packages. On execution instances, all catalog objects are prefixed by the external account name. This means several control instances (development and production instances for example) can be supported on one same execution instance.","IMPORTANT","We recommend you use short and explicit internal names.","Offers are automatically deployed then published on execution and control instances.","Offers deleted in the design environment are disabled on all online instances. Obsolete propositions and offers are automatically deleted on all instances after the purge period (specified in each instance's deployment assistant) and sliding period (specified in the incoming propositions' typology rules).","A workflow is created for each environment and external account for proposition synchronization. Synchronization frequency can be adjusted for each environment and external account."]},{"section":"Limitations","sectionId":"19bb0c4a-2905-4128-b773-045b5d8f0c0b","paragraphs":["If you use the fall back function from an anonymous environment to an identified environment, these two environments must be on the same execution instance. \nThe synchronization between several execution instances is not performed in real time. Interactions of the same contact must be sent to the same instance. The control instance must be dedicated to the outbound channel (no real time).\nThe marketing database is not automatically synchronized. The marketing data used in the weights and eligibility rules must be duplicated on execution instances. This process does not come as standard, you must develop it during the integration period. \nProposition synchronization is carried out exclusively by FDA connection.\nIf you use Interaction and Message Center on the same instance, synchronization will occur via FDA protocol in both cases."]},{"section":"Packages configuration","sectionId":"76a863a1-1646-4083-8645-881af0def5cc","paragraphs":["Any schema extensions directly linked to Interaction (offers, propositions, recipients, etc.) must be deployed on the execution instances.","The Interaction package must be installed on all instances (control and execution). Two additional packages are available: one package to be installed on the control instances, and another to be installed on each execution instance.","NOTE","When installing the package, the long type fields of the nms:proposition table such as the proposition ID, become int64 type fields. This type of data is detailed in the this section.","The data retention duration must be configured on each instance (via the Data purge window in the deployment wizard). On execution instances, this period must correspond to the historical depth necessary for typology rules (sliding period) and eligibility rules to be calculated.","On the control instances:","Create an external account by execution instance:","Complete the label and add a short and explicit internal name.","Select the Execution instance.","Check the Enabled option.","Complete the connection parameters for the execution instance.","Every execution instance must be linked to an ID. This ID is assigned when you click on the Initialize connection button.","Check the type of application used: Message Center, Interaction, or both.","Enter the FDA account used. An operator must be created on the execution instances and must have the following read and write rights on the database of the instance in question:","grant SELECT ON nmspropositionrcp, nmsoffer, nmsofferspace, xtkoption, xtkfolder TO user;\ngrant DELETE, INSERT, UPDATE ON nmspropositionrcp TO user;","NOTE","The IP address of the control instance must be authorized on the execution instances.","Configure the environment:","Add the list of execution instances.","For each one, specify the synchronization period and filter criteria (for example, by country).","NOTE","If you encounter an error, you can consult the synchronization workflows and offer notifications. These can be found in the technical workflows of the application.","If, for optimization reasons, only part of the marketing database is duplicated on the execution instances, you can specify a restricted schema linked to the environment to allow the users to only use data that is available on the execution instances. You can create an offer using data that is not available on execution instances. To do this, you must deactivate the rule on the other channels by limiting this rule on the outbound channel (Taken into account if field)."]},{"section":"Maintenance options","sectionId":"268c8e62-806d-4839-8231-a2ed918bf323","paragraphs":["Here is a list of maintenance options available on the control instance:","IMPORTANT","These options must only be used for specific maintenance cases.","NmsInteraction_LastOfferEnvSynch_<offerEnvId>_<executionInstanceId>: last date that an environment was synced on a given instance.\nNmsInteraction_LastPropositionSynch_<propositionSchema>_<executionInstanceIdSource>_<executionInstanceIdTarget>: last date that propositions from a given schema were synced from one instance to another.\nNmsInteraction_MapWorkflowId: an option containing the list of all synchronization workflows generated.","The following option is available on execution instances:","NmsExecutionInstanceId: option containing the instance ID."]},{"section":"Packages installation","sectionId":"0860e6c5-8024-4428-9e4e-c65ca26df8d8","paragraphs":["If your instance did not previously have the Interaction package, no migration is necessary. By default, the proposition table will be in 64 bits after the packages have been installed.","IMPORTANT","Depending on the volume of existing propositions in your instance, this operation may take a while.","If your instance has little or no propositions, no manual modification of the proposition table is necessary. The modification will be done when packages are installed.\nIf your instance has a lot of propositions, it is better to change the structure of the propositions table before installing the control packages and running them. We recommend running the queries during a low-activity period.","NOTE","If you have carried out specific configurations in the proposition table, adapt the queries accordingly."]},{"section":"PostgreSQL","sectionId":"9552a0b9-69ac-4af3-8893-be5a787639f2","paragraphs":["There are two methods. The first (using a work table) is slightly faster.","Work table","CREATE TABLE NmsPropositionRcp_tmp AS SELECT * FROM nmspropositionrcp WHERE 0=1;\nALTER TABLE nmspropositionrcp_tmp\n  ALTER COLUMN ipropositionid TYPE bigint,\n  ALTER COLUMN iinteractionid TYPE bigint;\nINSERT INTO nmspropositionrcp_tmp SELECT * FROM nmspropositionrcp;\nDROP TABLE nmspropositionrcp;\nCREATE INDEX proposition_id ON NmsPropositionRcp (ipropositionid);\nCREATE INDEX nmspropositionrcp_deliveryid ON NmsPropositionRcp (ideliveryid);\nCREATE INDEX nmspropositionrcp_lastmodified ON NmsPropositionRcp (tslastmodified);\nCREATE INDEX nmspropositionrcp_offerid ON NmsPropositionRcp (iofferid);\nCREATE INDEX nmspropositionrcp_offerspaceid ON NmsPropositionRcp (iofferspaceid);\nCREATE INDEX nmspropositionrcp_recipientidid ON NmsPropositionRcp (irecipientid);\nALTER TABLE nmspropositionrcp_tmp RENAME TO nmspropositionrcp;","Alter Table","ALTER TABLE nmspropositionrcp\n  ALTER COLUMN ipropositionid TYPE bigint,\n  ALTER COLUMN iinteractionid TYPE bigint;"]},{"section":"Oracle","sectionId":"065d76df-b15b-4443-8256-b231075ccc9a","paragraphs":["Editing the size of a Number type does not lead to values or the index being re-written. It is therefore immediate.","The query to be executed is as follows:","ALTER TABLE nmspropositionrcp MODIFY (\nipropositionid NUMBER(19, 0),\niinteractionid NUMBER(19, 0)\n);"]},{"section":"MSSQL","sectionId":"cb744a71-fd2a-4104-bd8d-288c53f93efb","paragraphs":["The queries to be executed are as follows:","SELECT * INTO NmsPropositionRcp_tmp FROM NmsPropositionRcp WHERE 1 = 0;\nGO\nALTER TABLE NmsPropositionRcp_tmp ALTER COLUMN ipropositionid BIGINT;\nGO\nALTER TABLE NmsPropositionRcp_tmp ALTER COLUMN iinteractionid BIGINT;\nGO\nINSERT INTO NmsPropositionRcp_tmp SELECT * FROM NmsPropositionRcp;\nGO\nDROP TABLE NmsPropositionRcp;\nGO\nsp_rename 'NmsPropositionRcp_tmp', NmsPropositionRcp\nGO\nALTER TABLE NmsPropositionRcp ADD DEFAULT ((0)) FOR dWeight\nGO\nALTER TABLE NmsPropositionRcp ADD DEFAULT ((0)) FOR iDeliveryId\nGO\nALTER TABLE NmsPropositionRcp ADD DEFAULT ((0)) FOR iEngineType\nGO\nALTER TABLE NmsPropositionRcp ADD DEFAULT ((0)) FOR iInteractionId\nGO\nALTER TABLE NmsPropositionRcp ADD DEFAULT ((0)) FOR iOfferId\nGO\nALTER TABLE NmsPropositionRcp ADD DEFAULT ((0)) FOR iOfferSpaceId\nGO\nALTER TABLE NmsPropositionRcp ADD DEFAULT ((0)) FOR iPropositionId\nGO\nALTER TABLE NmsPropositionRcp ADD DEFAULT ((0)) FOR iRank\nGO\nALTER TABLE NmsPropositionRcp ADD DEFAULT ((0)) FOR iRecipientId\nGO\nALTER TABLE NmsPropositionRcp ADD DEFAULT ((0)) FOR iStatus\nGO\nCREATE NONCLUSTERED INDEX NmsPropositionRcp_deliveryId ON NmsPropositionRcp (iDeliveryId)\nGO\nCREATE NONCLUSTERED INDEX NmsPropositionRcp_eventDate ON NmsPropositionRcp (tsEvent)\nGO\nCREATE UNIQUE NONCLUSTERED INDEX NmsPropositionRcp_id ON NmsPropositionRcp (iPropositionId)\nGO\nCREATE NONCLUSTERED INDEX NmsPropositionRcp_lastModified ON NmsPropositionRcp (tsLastModified)\nGO\nCREATE NONCLUSTERED INDEX NmsPropositionRcp_offerId ON NmsPropositionRcp (iOfferId)\nGO\nCREATE NONCLUSTERED INDEX NmsPropositionRcp_offerSpaceI ON NmsPropositionRcp (iOfferSpaceId)\nGO\nCREATE NONCLUSTERED INDEX NmsPropositionRcp_recipientId ON NmsPropositionRcp (iRecipientId)\nGO"]}]}