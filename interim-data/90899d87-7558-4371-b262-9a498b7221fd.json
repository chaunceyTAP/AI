{"guid":"90899d87-7558-4371-b262-9a498b7221fd","title":"Hooks","path":"help\\interaction\\using\\hooks.md","fullText":"---\nproduct: campaign\ntitle: Hooks\ndescription: Hooks\nfeature: Interaction, Offers\naudience: interaction\ncontent-type: reference\ntopic-tags: advanced-parameters\nexl-id: e1d7d7c2-61e7-40d6-a8ce-69bc976f8c73\n---\n# Modify the standard engine behavior{#hooks}\n\n\n\nHooks in Interaction let you modify the **standard engine behavior**.\n\nThe **[!UICONTROL Target loading]** and **[!UICONTROL Proposition post-processing]** hooks are configured, in Adobe Campaign, in the offer space:\n\n![](assets/interaction_hooks_1.png)\n\nThe **[!UICONTROL Dynamic offer]** hook is configured with the offer weight in Adobe Campaign:\n\n![](assets/interaction_hooks_2.png)\n\n## Target loading {#target-loading}\n\nThis hook lets you enrich the profile of the contact (that was loaded by the out-of-the-box query) with additional data from an external system.\n\nData collected must be inserted into the call data node (Interaction node). The integrator must have extended the call data schema beforehand to define the structure of the collected data. The user can access this data in the same way as for standard call data (at an eligibility rules and personalization level).\n\n**Input parameters:**\n\n* xmlInteraction (xml type): Interaction node\n* aTargetId (table type): target identifier\n* sUuid230 (string type): value of the uuid230 permanent cookie\n* sNlid (string type): value of the nlid session cookie\n\n**Return parameters:**\n\n* enriched Interaction node (first parameter of this hook)\n\n>[!NOTE]\n>\n>The **xmlInteraction** parameter contains both the call data and the profile of the contact that was loaded by the out-of-the-box query.\n\n**Example:**\n\n```\n// Call an external system to get additional data for the target\n  var additionalData  = getUrl(\"https://EXTERNAL_SYSTEM?target=\" + encodeURIComponent(aTargetId.join(\"|\")));\n  // Enrich the context with this data\n  interaction.@additionalData = additionalData;\n```\n\n## Proposition post-processing {#proposition-post-processing-}\n\nThis hook lets you check the consistency and compatibility of eligible propositions in a given interaction. It also lets you define a new scoring or probability calculation functionality.\n\nExample of using consistency rules:\n\n* Limiting the number of propositions in the same call, linked to the same product, or the same category.\n* Only presenting offers related to a product in the same interaction.\n\nThe post-processing is executed after the typology rules application and the eligible proposition sorting, and before the prioritization step.\n\n**Input parameters:**\n\n* aProposition: table of eligible propositions. Here is an example of the structure of an element in this table\n\n  ```\n  { offer_id:1234,\n    weight:2}\n  ```\n\n* dicOffer (xml type): dictionary of all the attributes of eligible offers (offer code, category id, category full name, start date, end date, label, internal name, offer id, additional offer fields). For example\n\n  ```\n  { \"1242\": <offer category-id=\"61242\" categoryFullName=\"/FULL/PATH/TO/CATEGORY/\" code=\"CODE\" endDate=\"\" id=\"62473\" label=\"LABEL\" name=\"OFR38_OE4\" product-id=\"43\" startDate=\"\"/>,\n    \"1243\": ...}\n  ```\n\n* xmlTarget (xml type): profile data node\n* xmlInteraction (xml type): call data node\n* iPropNumber (integer type): number of expected offers\n\n**Return parameters:**\n\n* list of modified propositions (first parameter of the hook)\n* modified Interaction node\n\n**Example:**\n\n```\nvar aReturnedProps = [];\n\nif( aProposition.length > 0 )\n{\n  var iReturnedProps = 0;\n  for( var iPropIdx = 0; iPropIdx < aProposition.length && iReturnedProps < iPropNumber; iPropIdx ++ )\n  {\n    // Check a consistency rule for instance\n    if( true )\n    {\n      aReturnedProps.push(aProposition[iPropIdx]);\n      iReturnedProps++;\n    }\n  }\n}\n\nreturn aReturnedProps;\n```\n\n## Dynamic offer {#dynamic-offer}\n\nThis hook allows you to make a call to an external engine to select a list of products linked to an offer. It is configured in the offer after eligibility rules, and before the typology rules application.\n\nBeforehand, the integrator should extend the propositions **PropositionRcp** schema with the additional info on the product. To specify where this data will be stored, a **[!UICONTROL Proposition being processed]** link is available in the **[!UICONTROL Storage]** tab of the space \n\n![](assets/interaction_hooks_3.png)\n\n**Input parameters:**\n\n* xmlOffer (xml type): offer (offer code, category id, category full name, start date, end date, label, internal name, offer id, additional offer fields)\n* dWeight: context weight (double type)\n* xmlTarget (xml type): profile data node\n* xmlInteraction (xml type): call data node\n\n**Return parameters:**\n\nA table of propositions to generate is returned. Each element of this table is composed of the following information:\n\n* offer identifier\n* additional product data (product code, for example)\n* weight\n\n>[!NOTE]\n>\n>The system checks that the offer id is the same for both the input and return parameters.\n\n**Example:**\n\n```\nvar product = getUrl(\"https://EXTERNAL_SYSTEM?offerCode=\" + encodeURIComponent(xmlOffer.@code));\nif( product )\n  return [{offer_id: parseInt(String(xmlOffer.@id)), weight: dWeight, productId: product}];\n```\n","headers":[["title","Hooks"],["description","Hooks"],["feature","Interaction, Offers"],["topic-tags","advanced-parameters"]],"sections":[{"section":"Modify the standard engine behavior","sectionId":"913c364b-c81a-4c71-a813-10905b7ca091","paragraphs":["Hooks in Interaction let you modify the standard engine behavior.","The Target loading and Proposition post-processing hooks are configured, in Adobe Campaign, in the offer space:","The Dynamic offer hook is configured with the offer weight in Adobe Campaign:"]},{"section":"Target loading","sectionId":"7e6a6309-26a6-4695-8ab7-014ac2c3e564","paragraphs":["This hook lets you enrich the profile of the contact (that was loaded by the out-of-the-box query) with additional data from an external system.","Data collected must be inserted into the call data node (Interaction node). The integrator must have extended the call data schema beforehand to define the structure of the collected data. The user can access this data in the same way as for standard call data (at an eligibility rules and personalization level).","Input parameters:","xmlInteraction (xml type): Interaction node\naTargetId (table type): target identifier\nsUuid230 (string type): value of the uuid230 permanent cookie\nsNlid (string type): value of the nlid session cookie","Return parameters:","enriched Interaction node (first parameter of this hook)","NOTE","The xmlInteraction parameter contains both the call data and the profile of the contact that was loaded by the out-of-the-box query.","Example:","// Call an external system to get additional data for the target\n  var additionalData  = getUrl(\"https://EXTERNAL_SYSTEM?target=\" + encodeURIComponent(aTargetId.join(\"|\")));\n  // Enrich the context with this data\n  interaction.@additionalData = additionalData;"]},{"section":"Proposition post-processing","sectionId":"39612504-53c5-4ac2-afbb-edd257b9191e","paragraphs":["This hook lets you check the consistency and compatibility of eligible propositions in a given interaction. It also lets you define a new scoring or probability calculation functionality.","Example of using consistency rules:","Limiting the number of propositions in the same call, linked to the same product, or the same category.\nOnly presenting offers related to a product in the same interaction.","The post-processing is executed after the typology rules application and the eligible proposition sorting, and before the prioritization step.","Input parameters:","aProposition: table of eligible propositions. Here is an example of the structure of an element in this table","{ offer_id:1234,\n  weight:2}","dicOffer (xml type): dictionary of all the attributes of eligible offers (offer code, category id, category full name, start date, end date, label, internal name, offer id, additional offer fields). For example","{ \"1242\": <offer category-id=\"61242\" categoryFullName=\"/FULL/PATH/TO/CATEGORY/\" code=\"CODE\" endDate=\"\" id=\"62473\" label=\"LABEL\" name=\"OFR38_OE4\" product-id=\"43\" startDate=\"\"/>,\n  \"1243\": ...}","xmlTarget (xml type): profile data node","xmlInteraction (xml type): call data node","iPropNumber (integer type): number of expected offers","Return parameters:","list of modified propositions (first parameter of the hook)\nmodified Interaction node","Example:","var aReturnedProps = [];","if( aProposition.length > 0 )\n{\n  var iReturnedProps = 0;\n  for( var iPropIdx = 0; iPropIdx < aProposition.length && iReturnedProps < iPropNumber; iPropIdx ++ )\n  {\n    // Check a consistency rule for instance\n    if( true )\n    {\n      aReturnedProps.push(aProposition[iPropIdx]);\n      iReturnedProps++;\n    }\n  }\n}","return aReturnedProps;"]},{"section":"Dynamic offer","sectionId":"6e400a31-a895-4655-9cd9-e4a6a286a83d","paragraphs":["This hook allows you to make a call to an external engine to select a list of products linked to an offer. It is configured in the offer after eligibility rules, and before the typology rules application.","Beforehand, the integrator should extend the propositions PropositionRcp schema with the additional info on the product. To specify where this data will be stored, a Proposition being processed link is available in the Storage tab of the space","Input parameters:","xmlOffer (xml type): offer (offer code, category id, category full name, start date, end date, label, internal name, offer id, additional offer fields)\ndWeight: context weight (double type)\nxmlTarget (xml type): profile data node\nxmlInteraction (xml type): call data node","Return parameters:","A table of propositions to generate is returned. Each element of this table is composed of the following information:","offer identifier\nadditional product data (product code, for example)\nweight","NOTE","The system checks that the offer id is the same for both the input and return parameters.","Example:","var product = getUrl(\"https://EXTERNAL_SYSTEM?offerCode=\" + encodeURIComponent(xmlOffer.@code));\nif( product )\n  return [];"]}]}