{"guid":"706ce3e1-05a8-4f95-b752-29174ce36d23","title":"Querying delivery information","path":"help\\workflow\\using\\querying-delivery-information.md","fullText":"---\nproduct: campaign\ntitle: Querying delivery information\ndescription: Learn how to query delivery information\nfeature: Query Editor, Workflows\nexl-id: b699b064-1287-41c9-8d94-1c1aa2c145ab\n---\n# Query delivery information {#querying-delivery-information}\n\n\n\n## Number of clicks for a specific delivery {#number-of-clicks-for-a-specific-delivery}\n\nIn this example, we are looking to recover the number of clicks for a specific delivery. These clicks are recorded thanks to recipient tracking logs taken over a given period. The recipient is identified via their email address. This query uses the **[!UICONTROL Recipient tracking logs]** table.\n\n* Which table needs to be selected?\n\n  The recipient log tracking table (**[!UICONTROL nms:trackingLogRcp]**)\n\n* Fields to be selected for output columns?\n\n  Primary key (with count) and Email\n\n* What criteria will information be filtered based on?\n\n  A specific period and an element of the delivery label\n\nTo carry out this example, apply the following steps:\n\n1. Open the **[!UICONTROL Generic query editor]** and select the **[!UICONTROL Recipient tracking logs]** schema.\n\n   ![](assets/query_editor_tracklog_05.png)\n\n1. In the **[!UICONTROL Data to extract]** window, we want to create an aggregate to collect information. To do this, add the primary key (located above the main **[!UICONTROL Recipient tracking logs]** element): Tracking log count is carried out on this **[!UICONTROL Primary key]** field. The edited expression will be **[!UICONTROL x=count(primary key)]**. It links the sum of various tracking logs to a single email address.\n\n   To do this:\n\n    * Click the **[!UICONTROL Add]** icon to the right of the **[!UICONTROL Output columns]** field. In the **[!UICONTROL Formula type]** window, select the **[!UICONTROL Edit the formula using an expression]** option and click **[!UICONTROL Next]**. In the **[!UICONTROL Field to select]** window, click **[!UICONTROL Advanced selection]**.\n    \n      ![](assets/query_editor_tracklog_06.png)\n\n    * In the **[!UICONTROL Formula type]** window, run a process on the aggregate function. This process will be a primary key count.\n\n      Select **[!UICONTROL Process on an aggregate function]** in the **[!UICONTROL Aggregate]** section and click **[!UICONTROL Count]**.\n    \n      ![](assets/query_editor_nveau_18.png)\n\n      Click **[!UICONTROL Next]**.\n    \n    * Select the **[!UICONTROL Primary key (@id)]** field. The **[!UICONTROL count (primary key)]** output column is configured.\n    \n      ![](assets/query_editor_nveau_19.png)\n\n1. Select the other field to be displayed in the output column. In the **[!UICONTROL Available fields]** column, open the **[!UICONTROL Recipient]** node and choose **[!UICONTROL Email]**. Check the **[!UICONTROL Group]** box to **[!UICONTROL Yes]** to group the tracking logs by email address: this group links each log to its recipient.\n\n   ![](assets/query_editor_nveau_20.png)\n\n1. Configure column sorting so that the most active recipients (with the most tracking logs) are displayed first. Check **[!UICONTROL Yes]** in the **[!UICONTROL Descending sort]** column.\n\n   ![](assets/query_editor_nveau_64.png)\n\n1. You must then filter the logs which interest you, i.e. those which are under 2 weeks old and which concern sales-related deliveries.\n\n   To do this:\n\n    * Configure data filtering. To do this, select **[!UICONTROL Filter conditions]** then click **[!UICONTROL Next]**.\n    \n      ![](assets/query_editor_nveau_22.png)\n\n    * Recover tracking logs over a given period for a specific delivery. Three filtering conditions are necessary: two date conditions to set the search period between 2 weeks before the current date and the day before the current date; and another condition to restrict the search to a specific delivery.\n\n      In the **[!UICONTROL Target element]** window, configure the date starting from which tracking logs will be taken into account. Click **[!UICONTROL Add]**. A condition line is displayed. Edit the **[!UICONTROL Expression]** column by clicking the **[!UICONTROL Edit expression]** function. In the **[!UICONTROL Field to select]** window, choose **[!UICONTROL Date (@logDate)]**.\n    \n      ![](assets/query_editor_nveau_23.png)\n\n      Select the **[!UICONTROL greater than]** operator. In the **[!UICONTROL Value]** column, click **[!UICONTROL Edit expression]**, and in the **[!UICONTROL Formula type]** window, select **[!UICONTROL Process on dates]**. Finally, in **[!UICONTROL Current date minus n days]**, enter \"15\".\n\n      Click **[!UICONTROL Finish]**.\n    \n      ![](assets/query_editor_nveau_24.png)\n\n    * To select the tracking log search end date, create a second condition by clicking **[!UICONTROL Add]**. In the **[!UICONTROL Expression]** column, choose **[!UICONTROL Date (@logDate)]** again.\n\n      Select the **[!UICONTROL less than]** operator. In the **[!UICONTROL Value]** column, click **[!UICONTROL Edit expression]**. For date processing, go to the **[!UICONTROL Formula type]** window, enter \"1\" in **[!UICONTROL Current date minus n days]**.\n\n      Click **[!UICONTROL Finish]**.\n    \n      ![](assets/query_editor_nveau_65.png)\n\n      Now we want to configure the third filter condition, i.e. the delivery label which our query concerns.\n    \n    * Click the **[!UICONTROL Add]** function to create another filtering condition. In the **[!UICONTROL Expression]** column, click **[!UICONTROL Edit expression]**. In the **[!UICONTROL Field to select]** window, choose **[!UICONTROL Label]** in the **[!UICONTROL Delivery]** node.\n\n      Click **[!UICONTROL Finish]**.\n    \n      ![](assets/query_editor_nveau_66.png)\n\n      Look for a delivery containing the word \"sales\". Since you don't remember its exact label, you can choose the **[!UICONTROL contains]** operator and enter \"sales\" in the **[!UICONTROL Value]** column.\n    \n      ![](assets/query_editor_nveau_25.png)\n\n1. Click **[!UICONTROL Next]** until you get to the **[!UICONTROL Data preview]** window: no formatting is necessary here.\n1. In the **[!UICONTROL Data preview]** window, click **[!UICONTROL Start the preview of the data]** to see the number of tracking logs for each delivery recipient.\n\n   The result is displayed in descending order.\n\n   ![](assets/query_editor_tracklog_04.png)\n\n   The highest number of logs for a user is 6 for this delivery. 5 different users opened the delivery email or clicked one of the links in the email.\n\n## Recipients who did not open any delivery {#recipients-who-did-not-open-any-delivery}\n\nIn this example, we want to filter recipients who didn't open an email in the last 7 days.\n\nTo create this example, apply the following steps:\n\n1. Drag and drop a **[!UICONTROL Query]** activity in a workflow and open the activity.\n1. Click **[!UICONTROL Edit query]** and set the target and filtering dimensions to **[!UICONTROL Recipients]**.\n\n   ![](assets/query_recipients_1.png)\n\n1. Select **[!UICONTROL Filtering conditions]** then click **[!UICONTROL Next]**.\n1. Click the **[!UICONTROL Add]** button and select **[!UICONTROL Tracking logs]**.\n1. Set the **[!UICONTROL Operator]** of the **[!UICONTROL Tracking logs]** expression to **[!UICONTROL Do not exist such as]**.\n\n   ![](assets/query_open_1.png)\n\n1. Add another expression. Select **[!UICONTROL Type]** in the **[!UICONTROL URL]** category.\n1. Then, set its **[!UICONTROL Operator]** to **[!UICONTROL equal to]** and its **[!UICONTROL Value]** to **[!UICONTROL Open]**.\n\n   ![](assets/query_open_2.png)\n\n1. Add another expression and select **[!UICONTROL Date]**. **[!UICONTROL Operator]** should be set to **[!UICONTROL on or after]**.\n\n   ![](assets/query_open_3.png)\n\n1. To set the value last 7 days, click the **[!UICONTROL Edit expression]** button in the **[!UICONTROL Value]** field.\n1. In the **[!UICONTROL Function]** category, select **[!UICONTROL Current date minus n days]** and add the number of days you want to target. Here, we want to target the last 7 days.\n\n   ![](assets/query_open_4.png)\n\nYour outbound transition will contain recipients who didn't open an email in the last 7 days.\n\nIf, on the opposite, you want to filter recipients who opened at least one email your query should be as follows. Please note that, in this case, the **[!UICONTROL Filtering dimension]** should be set to **[!UICONTROL Tracking logs (Recipients)]**.\n\n![](assets/query_open_5.png)\n\n## Recipients who have opened a delivery {#recipients-who-have-opened-a-delivery}\n\nThe following example shows how to target profiles who have opened a delivery within the last 2 weeks:\n\n1. To target profiles having opened a delivery, you need to use tracking logs. they are stored in a linked table: start by selecting this table in the drop-down list of the **[!UICONTROL Filtering dimension]** field, as shown below:\n\n   ![](assets/s_advuser_query_sample1.0.png)\n\n1. Concerning filtering conditions, click the **[!UICONTROL Edit expression]** icon of the criteria shown in the sub-tree structure of the tracking logs. Select the **[!UICONTROL Date]** field.\n\n   ![](assets/s_advuser_query_sample1.1.png)\n\n   Click **[!UICONTROL Finish]** to confirm selection.\n\n   In order to recover only the tracking logs less than two weeks old, select the **[!UICONTROL Greater than]** operator.\n\n   ![](assets/s_advuser_query_sample1.4.png)\n\n   Then click the **[!UICONTROL Edit expression]** icon in the **[!UICONTROL Value]** column to define the calculation formula to be applied. Select the **[!UICONTROL Current date minus n days]** formula and enter 15 in the related field.\n\n   ![](assets/s_advuser_query_sample1.5.png)\n\n   Click the **[!UICONTROL Finish]** button of the formula window. In the filtering window, click the **[!UICONTROL Preview]** tab to check targeting criteria.\n\n   ![](assets/s_advuser_query_sample1.6.png)\n\n## Filtering recipients' behavior following a delivery {#filtering-recipients--behavior-folllowing-a-delivery}\n\nIn a workflow, the **[!UICONTROL Query]** and **[!UICONTROL Split]** boxes let you select a behavior following a previous delivery. This selection is carried out via the **[!UICONTROL Delivery recipient]** filter.\n\n* Aim of the example\n\n  In a delivery workflow, there are several ways of following up a first email communication. This type of operation involves using the **[!UICONTROL Split]** box.\n\n* Context\n\n  A \"Summer sports offer\" delivery is sent. Four days after the delivery, two other deliveries are sent. One of them is \"watersports offer\", the other is a follow-up to the first \"Summer sports offer\" delivery.\n\n  The \"Watersports offer\" delivery is sent to recipients who clicked the \"watersports\" link in the first delivery. These clicks show that the recipient is interested in the topic. It makes sense to steer them towards similar offers. However, recipients who did not click in the \"Summer sports offer\" will receive the same content again.\n\nThe following steps show you how to configure the **[!UICONTROL Split]** box by integrating two different behaviors:\n\n1. Insert the **[!UICONTROL Split]** box into the workflow. This box will break down the recipients of the first delivery into the next two deliveries. Breakdown occurs based on the filtering conditions linked to recipient behavior during the first delivery.\n\n   ![](assets/query_editor_ex_09.png)\n\n1. Open the **[!UICONTROL Split]** box. In the **[!UICONTROL General]** tab, enter a label: **Split based on behavior** for instance.\n\n   ![](assets/query_editor_ex_04.png)\n\n1. In the **[!UICONTROL Subsets]** tab, define the first split branch. For example, enter the **Clicked** label for this branch.\n1. Select the **[!UICONTROL Add a filtering condition on the incoming population]** option. Click **[!UICONTROL Edit]**.\n1. In the **[!UICONTROL Targeting and filtering dimension]** window, double-click the **[!UICONTROL Recipients of a delivery]** filter.\n\n   ![](assets/query_editor_ex_05.png)\n\n1. In the **[!UICONTROL Target element]** window, select the behavior you want to apply to this branch: **[!UICONTROL Recipients having clicked (email)]**.\n\n   Below, select the **[!UICONTROL Delivery specified by the transition]** option. This functionality will automatically recover the people targeted during the first delivery.\n\n   This is the \"Watersports offer\" delivery.\n\n   ![](assets/query_editor_ex_08.png)\n\n1. Define the second branch. This branch will include the follow-up email with the same content as for the first delivery. Go to the **[!UICONTROL Subsets]** tab and click **[!UICONTROL Add]** to create it.\n\n   ![](assets/query_editor_ex_06.png)\n\n1. Another sub-tab is displayed. Name it \"**Did not click**\".\n1. Click **[!UICONTROL Add a filtering condition for the incoming population]**. Then click **[!UICONTROL Edit...]**.\n\n   ![](assets/query_editor_ex_07.png)\n\n1. Click **[!UICONTROL Delivery recipients]** in the **[!UICONTROL Targeting and filtering dimension]** window. \n1. In the **[!UICONTROL Target element]** window, select the **[!UICONTROL Recipients who did not click (email)]** behavior. Select the **[!UICONTROL Delivery specified by the transition]** option as shown for the last branch.\n\n   The **[!UICONTROL Split]** box is now fully configured.\n\n   ![](assets/query_editor_ex_03.png)\n\nBelow is the list of the various components configured by default:\n\n* **[!UICONTROL All recipients]** \n* **[!UICONTROL Recipients of successfully sent messages,]** \n* **[!UICONTROL Recipients who opened or clicked (email),]** \n* **[!UICONTROL Recipients who clicked (email),]** \n* **[!UICONTROL Recipients of a failed message,]** \n* **[!UICONTROL Recipients who didn't open or click (email),]** \n* **[!UICONTROL Recipients who didn't click (email).]** \n\n  ![](assets/query_editor_ex_02.png)\n","headers":[["title","Querying delivery information"],["description","Learn how to query delivery information"],["feature","Query Editor, Workflows"]],"sections":[{"section":"Query delivery information","sectionId":"0dd812ac-02ab-429b-96e6-39663b9d7145","paragraphs":[]},{"section":"Number of clicks for a specific delivery","sectionId":"758215aa-465f-41bf-93f9-730f03da782e","paragraphs":["In this example, we are looking to recover the number of clicks for a specific delivery. These clicks are recorded thanks to recipient tracking logs taken over a given period. The recipient is identified via their email address. This query uses the Recipient tracking logs table.","Which table needs to be selected?","The recipient log tracking table (nms:trackingLogRcp)","Fields to be selected for output columns?","Primary key (with count) and Email","What criteria will information be filtered based on?","A specific period and an element of the delivery label","To carry out this example, apply the following steps:","Open the Generic query editor and select the Recipient tracking logs schema.","In the Data to extract window, we want to create an aggregate to collect information. To do this, add the primary key (located above the main Recipient tracking logs element): Tracking log count is carried out on this Primary key field. The edited expression will be x=count(primary key). It links the sum of various tracking logs to a single email address.","To do this:","Click the Add icon to the right of the Output columns field. In the Formula type window, select the Edit the formula using an expression option and click Next. In the Field to select window, click Advanced selection.","In the Formula type window, run a process on the aggregate function. This process will be a primary key count.","Select Process on an aggregate function in the Aggregate section and click Count.","Click Next.","Select the Primary key (@id) field. The count (primary key) output column is configured.","Select the other field to be displayed in the output column. In the Available fields column, open the Recipient node and choose Email. Check the Group box to Yes to group the tracking logs by email address: this group links each log to its recipient.","Configure column sorting so that the most active recipients (with the most tracking logs) are displayed first. Check Yes in the Descending sort column.","You must then filter the logs which interest you, i.e. those which are under 2 weeks old and which concern sales-related deliveries.","To do this:","Configure data filtering. To do this, select Filter conditions then click Next.","Recover tracking logs over a given period for a specific delivery. Three filtering conditions are necessary: two date conditions to set the search period between 2 weeks before the current date and the day before the current date; and another condition to restrict the search to a specific delivery.","In the Target element window, configure the date starting from which tracking logs will be taken into account. Click Add. A condition line is displayed. Edit the Expression column by clicking the Edit expression function. In the Field to select window, choose Date (@logDate).","Select the greater than operator. In the Value column, click Edit expression, and in the Formula type window, select Process on dates. Finally, in Current date minus n days, enter \"15\".","Click Finish.","To select the tracking log search end date, create a second condition by clicking Add. In the Expression column, choose Date (@logDate) again.","Select the less than operator. In the Value column, click Edit expression. For date processing, go to the Formula type window, enter \"1\" in Current date minus n days.","Click Finish.","Now we want to configure the third filter condition, i.e. the delivery label which our query concerns.","Click the Add function to create another filtering condition. In the Expression column, click Edit expression. In the Field to select window, choose Label in the Delivery node.","Click Finish.","Look for a delivery containing the word \"sales\". Since you don't remember its exact label, you can choose the contains operator and enter \"sales\" in the Value column.","Click Next until you get to the Data preview window: no formatting is necessary here.","In the Data preview window, click Start the preview of the data to see the number of tracking logs for each delivery recipient.","The result is displayed in descending order.","The highest number of logs for a user is 6 for this delivery. 5 different users opened the delivery email or clicked one of the links in the email."]},{"section":"Recipients who did not open any delivery","sectionId":"9c03be6a-1ac5-4953-9625-8269e0e3b946","paragraphs":["In this example, we want to filter recipients who didn't open an email in the last 7 days.","To create this example, apply the following steps:","Drag and drop a Query activity in a workflow and open the activity.","Click Edit query and set the target and filtering dimensions to Recipients.","Select Filtering conditions then click Next.","Click the Add button and select Tracking logs.","Set the Operator of the Tracking logs expression to Do not exist such as.","Add another expression. Select Type in the URL category.","Then, set its Operator to equal to and its Value to Open.","Add another expression and select Date. Operator should be set to on or after.","To set the value last 7 days, click the Edit expression button in the Value field.","In the Function category, select Current date minus n days and add the number of days you want to target. Here, we want to target the last 7 days.","Your outbound transition will contain recipients who didn't open an email in the last 7 days.","If, on the opposite, you want to filter recipients who opened at least one email your query should be as follows. Please note that, in this case, the Filtering dimension should be set to Tracking logs (Recipients)."]},{"section":"Recipients who have opened a delivery","sectionId":"41c01213-8b0f-453d-a086-d25cde0529f9","paragraphs":["The following example shows how to target profiles who have opened a delivery within the last 2 weeks:","To target profiles having opened a delivery, you need to use tracking logs. they are stored in a linked table: start by selecting this table in the drop-down list of the Filtering dimension field, as shown below:","Concerning filtering conditions, click the Edit expression icon of the criteria shown in the sub-tree structure of the tracking logs. Select the Date field.","Click Finish to confirm selection.","In order to recover only the tracking logs less than two weeks old, select the Greater than operator.","Then click the Edit expression icon in the Value column to define the calculation formula to be applied. Select the Current date minus n days formula and enter 15 in the related field.","Click the Finish button of the formula window. In the filtering window, click the Preview tab to check targeting criteria."]},{"section":"Filtering recipients' behavior following a delivery","sectionId":"cade3ef5-b379-48e5-bda1-dd2edd88aa4a","paragraphs":["In a workflow, the Query and Split boxes let you select a behavior following a previous delivery. This selection is carried out via the Delivery recipient filter.","Aim of the example","In a delivery workflow, there are several ways of following up a first email communication. This type of operation involves using the Split box.","Context","A \"Summer sports offer\" delivery is sent. Four days after the delivery, two other deliveries are sent. One of them is \"watersports offer\", the other is a follow-up to the first \"Summer sports offer\" delivery.","The \"Watersports offer\" delivery is sent to recipients who clicked the \"watersports\" link in the first delivery. These clicks show that the recipient is interested in the topic. It makes sense to steer them towards similar offers. However, recipients who did not click in the \"Summer sports offer\" will receive the same content again.","The following steps show you how to configure the Split box by integrating two different behaviors:","Insert the Split box into the workflow. This box will break down the recipients of the first delivery into the next two deliveries. Breakdown occurs based on the filtering conditions linked to recipient behavior during the first delivery.","Open the Split box. In the General tab, enter a label: Split based on behavior for instance.","In the Subsets tab, define the first split branch. For example, enter the Clicked label for this branch.","Select the Add a filtering condition on the incoming population option. Click Edit.","In the Targeting and filtering dimension window, double-click the Recipients of a delivery filter.","In the Target element window, select the behavior you want to apply to this branch: Recipients having clicked (email).","Below, select the Delivery specified by the transition option. This functionality will automatically recover the people targeted during the first delivery.","This is the \"Watersports offer\" delivery.","Define the second branch. This branch will include the follow-up email with the same content as for the first delivery. Go to the Subsets tab and click Add to create it.","Another sub-tab is displayed. Name it \"Did not click\".","Click Add a filtering condition for the incoming population. Then click Edit....","Click Delivery recipients in the Targeting and filtering dimension window.","In the Target element window, select the Recipients who did not click (email) behavior. Select the Delivery specified by the transition option as shown for the last branch.","The Split box is now fully configured.","Below is the list of the various components configured by default:","All recipients","Recipients of successfully sent messages,","Recipients who opened or clicked (email),","Recipients who clicked (email),","Recipients of a failed message,","Recipients who didn't open or click (email),","Recipients who didn't click (email)."]}]}