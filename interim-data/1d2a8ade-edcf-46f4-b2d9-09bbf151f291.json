{"guid":"1d2a8ade-edcf-46f4-b2d9-09bbf151f291","title":"Deduplication","path":"help\\workflow\\using\\deduplication.md","fullText":"---\nproduct: campaign\ntitle: Deduplication\ndescription: Learn more about the Deduplication workflow activity\nfeature: Workflows, Targeting Activity\nexl-id: 38add4fe-6238-45de-863e-895ebca189b7\n---\n# Deduplication{#deduplication}\n\n\n\nDeduplication deletes duplicates from the results of inbound activities. Deduplication can be performed on the email address, telephone number, or another field.\n\nThe **[!UICONTROL Deduplication]** activity is used for removing duplicate rows from a data set. For example, the records below could be considered duplicate as they have the same email address and same mobile and/or home phone.\n\n| Last modification date | First Name | Last Name | Email | Mobile Phone | Phone |\n-----|------------|-----------|-------|--------------|------\n02/03/2020 | Bob | Tisner | bob@mycompany.com | 444-444-4444 | 888-888-8888\n05/19/2020 | Robert | Tisner | bob@mycompany.com | 444-444-4444 | 777-777-7777\n07/22/2020 | Bobby | Tisner | bob@mycompany.com | 444-444-4444 | 777-777-7777\n\nThe **[!UICONTROL Deduplication]** activity has the capability to keep an entire row as the unique record after duplicates were identified. For example, in the above use case, if the activity is configured to keep only the record with the oldest **[!UICONTROL Date]**, the result would be:\n\n| Date | First Name | Last Name | Email | Mobile Phone | Phone |\n-----|----------|------------|-------|--------------|------\n02/03/2020 | Bob | Tisner | bob@mycompany.com | 444-444-4444 | 888-888-8888\n\nThe selected main record will carry forward the data without any merging of field data with other relevant data in the duplicate rows.\n\nComplement:\n\n| Date | First Name | Last Name | Email | Mobile Phone | Phone |\n-----|------------|-----------|-------|--------------|------\n05/19/2020 | Robert | Tisner | bob@mycompany.com | 444-444-4444 | 777-777-7777\n07/22/2020 | Bobby | Tisner | bob@mycompany.com | 444-444-4444 | 777-777-7777\n\n## Best practices {#best-practices}\n\nDuring deduplication, inbound flows are processed separately. If for instance recipient A is found in the result of query 1 as well as in the result of query 2, they will not be deduplicated.\n\nThis issue needs to be addressed as follows:\n\n* Create a **Union** activity to unify each inbound flow.\n* Create a **Deduplication** activity after the **Union** activity.\n\n![](assets/dedup_bonnepratique.png)\n\n## Configuration {#configuration}\n\nTo configure a deduplication, enter its label, the method, and the deduplication criteria, and the options concerning the result.\n\n1. Click the **[!UICONTROL Edit configuration...]** link to define the deduplication mode.\n\n   ![](assets/s_user_segmentation_dedup_param.png)\n\n1. Select the type of target for this activity (by default, deduplication is linked to recipients) and the criterion to be used, i.e. the field for which identical values enable you to identify duplicates.\n\n   >[!NOTE]\n   >\n   >If you are using external data as input, for example from an external file, make sure you select the **[!UICONTROL Temporary schema]** option.\n   >\n   >In the next step, the **[!UICONTROL Other]** option lets you select the criterion or criteria to be used:\n\n   ![](assets/s_user_segmentation_dedup_param2.png)\n\n1. In the next step, the **[!UICONTROL Other]** option lets you select the criterion or criteria to be used in case of identical values.\n\n   ![](assets/s_user_segmentation_dedup_param3.png)\n\n1. From the drop-down list, select the deduplication method to be used, and enter the number of duplicates to be kept.\n\n   ![](assets/s_user_segmentation_dedup_param4.png)\n\n   The following methods are available:\n\n    * **[!UICONTROL Choose for me]**: randomly selects the record to be kept out of the duplicates.\n    * **[!UICONTROL Following a list of values]**: lets you define a value priority for one or more fields. To define the values, select a field or create an expression, then add the value(s) into the appropriate table. To define a new field, click the **[!UICONTROL Add]** button located above the list of values.\n\n      ![](assets/s_user_segmentation_dedup_param5.png)\n\n    * **[!UICONTROL Non-empty value]**: this lets you keep records for which the value of the selected expression is not empty as a priority.\n\n      ![](assets/s_user_segmentation_dedup_param6.png)\n\n    * **[!UICONTROL Using an expression]**: lets you keep records with the lowest (or highest) value of the given expression. \n\n      ![](assets/s_user_segmentation_dedup_param7.png)\n\n   >[!NOTE]\n   >\n   >The **[!UICONTROL Merge]** functionality, accessible via the **[!UICONTROL Advanced parameters]** link, allows you to configure a set of rules in order to merge a field or group of fields into a single resulting data record. For more on this, see [Merging fields into a single record](#merging-fields-into-single-record).\n\n1. Click **[!UICONTROL Finish]** to approve the selected deduplication method.\n\n   The middle section of the window summarizes the defined configuration.\n\n   In the lower section of the activity editor window, you can modify the label for the outbound transition of the graphical object and enter a segment code that will be associated with the result of the activity. This code can later be used as a targeting criterion.\n\n   ![](assets/s_user_segmentation_dedup_param8.png)\n\n1. Check the **[!UICONTROL Generate complement]** option if you wish to exploit the remaining population. The complement consists of all the duplicates. An additional transition will then be added to the activity, as follows:\n\n   ![](assets/s_user_segmentation_dedup_param9.png)\n\n## Example: Identify the duplicates before a delivery {#example--identify-the-duplicates-before-a-delivery}\n\nIn the following example, the deduplication concerns the union of three queries.\n\nThe aim of the workflow is to define the target for a delivery by excluding duplicates to avoid sending it to the same recipient several times.\n\nThe identified duplicates will also be integrated into a dedicated duplicates list that can be reused if necessary.\n\n![](assets/deduplication_example.png)\n\n1. Add and link the various activities required for the workflow to operate as shown above.\n\n   The union activity is used here to \"unify\" the three queries into one single transition. Thus, deduplication will not work for each query individually but for the whole of the query. For more on this subject, refer to [Best practices](#best-practices).\n\n1. Open the deduplication activity then click the **[!UICONTROL Edit configuration...]** link to define the deduplication mode.\n1. In the new window, select **[!UICONTROL Database schema]**.\n1. Select **Recipients** as targeting and filtering dimensions.\n1. Select the ID field for the **[!UICONTROL Email]** duplicates, to send the delivery only once to every email address, then click **[!UICONTROL Next]**.\n\n   If you wish to base the duplicate IDs on a specific field, select **[!UICONTROL Other]** to access the list of available fields.\n\n1. Choose to keep only one entry when the same email address is identified for multiple recipients.\n1. Select the **[!UICONTROL Choose for me]** deduplication mode so that the records saved in case of identified duplicates are randomly chosen, then click **[!UICONTROL Finish]**.\n\nWhen running the workflow, all recipients identified as duplicates are excluded from the result (and therefore the delivery) and added to the duplicates list. This list may be used again rather than having to re-identify the duplicates.\n\n## Merging fields into a single data record {#merging-fields-into-single-record}\n\nThe **[!UICONTROL Merge]** functionality allows you to configure a set of rules for the deduplication to define a field or group of fields to merge into a single resulting data record.\n\nFor example, with a set of duplicate records, you can choose to keep the oldest phone number or most recent name.\n\nA use case leveraging this feature is available in [this section](deduplication-merge.md).\n\nTo do this, follow these steps:\n\n1. In the **[!UICONTROL Deduplication method]** selection step, click the **[!UICONTROL Advanced Parameters]** link.\n\n   ![](assets/dedup1.png)\n\n1. Select the **[!UICONTROL Merge records]** option to activate the functionality.\n\n   If you want to group multiple data fields in each merging condition, activate the **[!UICONTROL Use several record merging criteria]** option.\n\n   ![](assets/dedup2.png)\n\n1. After activating the functionality, a **[!UICONTROL Merge]** tab is added to the **[!UICONTROL Deduplication]** activity. It allows you to define groups of fields to merge and their associated rules.\n\n   For more on this, refer to the dedicated use case available in [this section](deduplication-merge.md).\n\n   ![](assets/dedup3.png)\n\n## Input parameters {#input-parameters}\n\n* tableName\n* schema\n\nEach inbound event must specify a target defined by these parameters.\n\n## Output parameters {#output-parameters}\n\n* tableName\n* schema\n* recCount\n\nThis set of three values identifies the target resulting from the deduplication. **[!UICONTROL tableName]** is the name of the table which saves target identifiers, **[!UICONTROL schema]** is the schema of the population (usually nms:recipient) and **[!UICONTROL recCount]** is the number of elements in the table.\n\nThe transition associated with the complement has the same parameters.\n","headers":[["title","Deduplication"],["description","Learn more about the Deduplication workflow activity"],["feature","Workflows, Targeting Activity"]],"sections":[{"section":"Deduplication","sectionId":"195a9093-aa01-479e-a7a8-134df3af75b7","paragraphs":["Deduplication deletes duplicates from the results of inbound activities. Deduplication can be performed on the email address, telephone number, or another field.","The Deduplication activity is used for removing duplicate rows from a data set. For example, the records below could be considered duplicate as they have the same email address and same mobile and/or home phone.","Last modification date First Name Last Name Email Mobile Phone Phone\n02/03/2020 Bob Tisner &#98;&#111;&#98;&#x40;&#109;&#x79;&#x63;&#111;&#x6d;&#112;&#x61;&#110;&#x79;&#x2e;&#x63;&#111;&#x6d; 444-444-4444 888-888-8888\n05/19/2020 Robert Tisner &#x62;&#x6f;&#x62;&#x40;&#109;&#x79;&#x63;&#111;&#109;&#112;&#x61;&#x6e;&#121;&#x2e;&#99;&#111;&#109; 444-444-4444 777-777-7777\n07/22/2020 Bobby Tisner &#98;&#111;&#x62;&#x40;&#x6d;&#x79;&#x63;&#111;&#x6d;&#x70;&#x61;&#110;&#x79;&#x2e;&#x63;&#x6f;&#x6d; 444-444-4444 777-777-7777","The Deduplication activity has the capability to keep an entire row as the unique record after duplicates were identified. For example, in the above use case, if the activity is configured to keep only the record with the oldest Date, the result would be:","Date First Name Last Name Email Mobile Phone Phone\n02/03/2020 Bob Tisner &#x62;&#x6f;&#98;&#64;&#109;&#x79;&#99;&#111;&#109;&#x70;&#x61;&#x6e;&#121;&#46;&#x63;&#x6f;&#x6d; 444-444-4444 888-888-8888","The selected main record will carry forward the data without any merging of field data with other relevant data in the duplicate rows.","Complement:","Date First Name Last Name Email Mobile Phone Phone\n05/19/2020 Robert Tisner &#98;&#x6f;&#98;&#x40;&#109;&#x79;&#99;&#x6f;&#109;&#112;&#x61;&#110;&#121;&#46;&#x63;&#x6f;&#109; 444-444-4444 777-777-7777\n07/22/2020 Bobby Tisner &#98;&#x6f;&#x62;&#64;&#x6d;&#x79;&#x63;&#x6f;&#109;&#x70;&#x61;&#x6e;&#x79;&#x2e;&#x63;&#111;&#109; 444-444-4444 777-777-7777"]},{"section":"Best practices","sectionId":"e031f304-68d1-4196-a40a-059d39a0693d","paragraphs":["During deduplication, inbound flows are processed separately. If for instance recipient A is found in the result of query 1 as well as in the result of query 2, they will not be deduplicated.","This issue needs to be addressed as follows:","Create a Union activity to unify each inbound flow.\nCreate a Deduplication activity after the Union activity."]},{"section":"Configuration","sectionId":"cdfb06a0-9ba9-445c-9d13-7f10b1fddfe1","paragraphs":["To configure a deduplication, enter its label, the method, and the deduplication criteria, and the options concerning the result.","Click the Edit configuration... link to define the deduplication mode.","Select the type of target for this activity (by default, deduplication is linked to recipients) and the criterion to be used, i.e. the field for which identical values enable you to identify duplicates.","NOTE","If you are using external data as input, for example from an external file, make sure you select the Temporary schema option.","In the next step, the Other option lets you select the criterion or criteria to be used:","In the next step, the Other option lets you select the criterion or criteria to be used in case of identical values.","From the drop-down list, select the deduplication method to be used, and enter the number of duplicates to be kept.","The following methods are available:","Choose for me: randomly selects the record to be kept out of the duplicates.","Following a list of values: lets you define a value priority for one or more fields. To define the values, select a field or create an expression, then add the value(s) into the appropriate table. To define a new field, click the Add button located above the list of values.","Non-empty value: this lets you keep records for which the value of the selected expression is not empty as a priority.","Using an expression: lets you keep records with the lowest (or highest) value of the given expression.","NOTE","The Merge functionality, accessible via the Advanced parameters link, allows you to configure a set of rules in order to merge a field or group of fields into a single resulting data record. For more on this, see Merging fields into a single record.","Click Finish to approve the selected deduplication method.","The middle section of the window summarizes the defined configuration.","In the lower section of the activity editor window, you can modify the label for the outbound transition of the graphical object and enter a segment code that will be associated with the result of the activity. This code can later be used as a targeting criterion.","Check the Generate complement option if you wish to exploit the remaining population. The complement consists of all the duplicates. An additional transition will then be added to the activity, as follows:"]},{"section":"Example: Identify the duplicates before a delivery","sectionId":"b21b8431-9c43-4944-9a5a-b823a1cf796b","paragraphs":["In the following example, the deduplication concerns the union of three queries.","The aim of the workflow is to define the target for a delivery by excluding duplicates to avoid sending it to the same recipient several times.","The identified duplicates will also be integrated into a dedicated duplicates list that can be reused if necessary.","Add and link the various activities required for the workflow to operate as shown above.","The union activity is used here to \"unify\" the three queries into one single transition. Thus, deduplication will not work for each query individually but for the whole of the query. For more on this subject, refer to Best practices.","Open the deduplication activity then click the Edit configuration... link to define the deduplication mode.","In the new window, select Database schema.","Select Recipients as targeting and filtering dimensions.","Select the ID field for the Email duplicates, to send the delivery only once to every email address, then click Next.","If you wish to base the duplicate IDs on a specific field, select Other to access the list of available fields.","Choose to keep only one entry when the same email address is identified for multiple recipients.","Select the Choose for me deduplication mode so that the records saved in case of identified duplicates are randomly chosen, then click Finish.","When running the workflow, all recipients identified as duplicates are excluded from the result (and therefore the delivery) and added to the duplicates list. This list may be used again rather than having to re-identify the duplicates."]},{"section":"Merging fields into a single data record","sectionId":"0881d6ba-5d0f-4c40-a69e-ce8acaef2fb1","paragraphs":["The Merge functionality allows you to configure a set of rules for the deduplication to define a field or group of fields to merge into a single resulting data record.","For example, with a set of duplicate records, you can choose to keep the oldest phone number or most recent name.","A use case leveraging this feature is available in this section.","To do this, follow these steps:","In the Deduplication method selection step, click the Advanced Parameters link.","Select the Merge records option to activate the functionality.","If you want to group multiple data fields in each merging condition, activate the Use several record merging criteria option.","After activating the functionality, a Merge tab is added to the Deduplication activity. It allows you to define groups of fields to merge and their associated rules.","For more on this, refer to the dedicated use case available in this section."]},{"section":"Input parameters","sectionId":"75bbe702-d9b6-4953-af09-01ba21266cc6","paragraphs":["tableName\nschema","Each inbound event must specify a target defined by these parameters."]},{"section":"Output parameters","sectionId":"4d2dadfc-546c-42df-a734-5a6574919b37","paragraphs":["tableName\nschema\nrecCount","This set of three values identifies the target resulting from the deduplication. tableName is the name of the table which saves target identifiers, schema is the schema of the population (usually nms:recipient) and recCount is the number of elements in the table.","The transition associated with the complement has the same parameters."]}]}