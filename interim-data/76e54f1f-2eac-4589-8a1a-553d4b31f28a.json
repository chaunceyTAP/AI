{"guid":"76e54f1f-2eac-4589-8a1a-553d4b31f28a","title":"Integration via SOAP (server side)","path":"help\\interaction\\using\\integration-via-soap-server-side.md","fullText":"---\nproduct: campaign\ntitle: Integration via SOAP (server side)\ndescription: Integration via SOAP (server side)\nfeature: Interaction, Offers\naudience: interaction\ncontent-type: reference\ntopic-tags: unitary-interactions\nexl-id: 3eaef689-44fa-41b3-ade8-9fe447e165ec\n---\n# Integration via SOAP (server-side){#integration-via-soap-server-side}\n\n\n\nThe SOAP web services provided for offer management are different from those usually used in Adobe Campaign. They can be accessed via the interaction URL described in the previous section and let you present or update offers for a given contact.\n\n## Offer proposition {#offer-proposition}\n\nFor an offer proposition via SOAP, add the **nms:proposition#Propose** command followed by the following parameters:\n\n* **targetId**: primary key of the recipient (can be a composite key). \n* **maxCount**: specifies the number of offer propositions for the contact.\n* **context**: lets you add context information in the space schema. If the schema used is **nms:interaction**, **`<empty>`** should be added.\n* **categories**: specifies the category/ies that the offers must belong to.\n* **themes**: specifies the theme(s) that the offer(s) must belong to.\n* **uuid**: value of the Adobe Campaign permanent cookie (\"uuid230\").\n* **nli**: value of the Adobe Campaign session cookie (\"nlid\").\n* **noProp**: use the \"true\" value to deactivate proposal insertion.\n\n>[!NOTE]\n>\n>The **targetId** and **maxCount** settings are compulsory. The others are optional.\n\nIn response to the query, the SOAP service will return the following parameters:\n\n* **interactionId**: ID of the interaction.\n* **propositions**: XML element, contains the list of propositions, each with their own ID and HTML representation.\n\n## Offer update {#offer-update}\n\nAdd the **nms:interaction#UpdateStatus** command to the URL, followed by these parameters:\n\n* **proposition**: string of characters, it contains the proposition ID given as an output during an offer proposition. Refer to [Offer proposition](#offer-proposition).\n* **status**: string type, it specifies the new status of the offer. The possible values are listed in the **propositionStatus** enumeration, in the **nms:common** schema. For example, out-of-the-box, the number 3 corresponds to the **Accepted** status.\n* **context**: XML element, lets you add context information in the space schema. If the schema used is **nms:interaction**, **`<empty>`** should be added.\n\n## Example using a SOAP call {#example-using-a-soap-call}\n\nHere is an example of code for a SOAP call:\n\n```\n<%\n  var space = request.parameters.sp\n  var cnx = new HttpSoapConnection(\n    \"https://\" + request.serverName + \":\" + request.serverPort + \"/interaction/\" + env + \"/\" + space,\n    \"utf-8\",\n    HttpSoapConnection.SOAP_12)\n  var session = new SoapService(cnx, \"nms:interaction\")\n  var action = request.parameters.a\n  if( action == undefined )\n    action = 'propose'\n\n  try\n  {\n    switch( action )\n    {\n    case \"update\":\n      var proposition = request.parameters.p\n      var status      = request.parameters.st\n      session.addMethod(\"UpdateStatus\", \"nms:interaction#UpdateStatus\",\n       [\"proposition\", \"string\",\n        \"status\",      \"string\",\n        \"context\",     \"NLElement\"],\n       [])\n      session.UpdateStatus(proposition, status, <undef/>)\n      var redirect = request.parameters.r\n      if( redirect != undefined )\n        response.sendRedirect(redirect)\n      break;\n\n    case \"propose\":\n      var count = request.parameters.n\n      var target = request.parameters.t\n      var categorie = request.parameters.c\n      var theme = request.parameters.th\n      var layout = request.parameters.l\n      if( count == undefined )\n        count = 1\n      session.addMethod(\"Propose\", \"nms:proposition#Propose\",\n       [\"targetId\",      \"string\",\n        \"maxCount\",      \"string\",\n         \"categories\",    \"string\",\n         \"themes\",        \"string\",\n        \"context\",       \"NLElement\"],\n       [\"interactionId\", \"string\",\n        \"propositions\",  \"NLElement\"])\n      response.setContentType(\"text/html\")\n      var result = session.Propose(target, count, category, theme, <empty/>)\n      var props = result[1]\n  %><table><tr><%\n      for each( var propHtml in props.proposition.*.mdSource )\n      {\n        %><td><%=propHtml%></td><%\n      }\n  %></tr></table><%\n      break;\n    }\n  }\n  catch( e )\n  {\n  }\n  %>\n```\n","headers":[["title","Integration via SOAP (server side)"],["description","Integration via SOAP (server side)"],["feature","Interaction, Offers"],["topic-tags","unitary-interactions"]],"sections":[{"section":"Integration via SOAP (server-side)","sectionId":"07952eee-13bd-484d-a164-74672a13aa9d","paragraphs":["The SOAP web services provided for offer management are different from those usually used in Adobe Campaign. They can be accessed via the interaction URL described in the previous section and let you present or update offers for a given contact."]},{"section":"Offer proposition","sectionId":"024728c4-f929-4c2a-8f5e-31f8f781c500","paragraphs":["For an offer proposition via SOAP, add the nms:proposition#Propose command followed by the following parameters:","targetId: primary key of the recipient (can be a composite key). \nmaxCount: specifies the number of offer propositions for the contact.\ncontext: lets you add context information in the space schema. If the schema used is nms:interaction, <empty> should be added.\ncategories: specifies the category/ies that the offers must belong to.\nthemes: specifies the theme(s) that the offer(s) must belong to.\nuuid: value of the Adobe Campaign permanent cookie (\"uuid230\").\nnli: value of the Adobe Campaign session cookie (\"nlid\").\nnoProp: use the \"true\" value to deactivate proposal insertion.","NOTE","The targetId and maxCount settings are compulsory. The others are optional.","In response to the query, the SOAP service will return the following parameters:","interactionId: ID of the interaction.\npropositions: XML element, contains the list of propositions, each with their own ID and HTML representation."]},{"section":"Offer update","sectionId":"655e0218-c2d7-4c34-bdc0-f33842483253","paragraphs":["Add the nms:interaction#UpdateStatus command to the URL, followed by these parameters:","proposition: string of characters, it contains the proposition ID given as an output during an offer proposition. Refer to Offer proposition.\nstatus: string type, it specifies the new status of the offer. The possible values are listed in the propositionStatus enumeration, in the nms:common schema. For example, out-of-the-box, the number 3 corresponds to the Accepted status.\ncontext: XML element, lets you add context information in the space schema. If the schema used is nms:interaction, <empty> should be added."]},{"section":"Example using a SOAP call","sectionId":"b1c2e705-6da6-4adc-9272-20bf426887c0","paragraphs":["Here is an example of code for a SOAP call:","<%\n  var space = request.parameters.sp\n  var cnx = new HttpSoapConnection(\n    \"https://\" + request.serverName + \":\" + request.serverPort + \"/interaction/\" + env + \"/\" + space,\n    \"utf-8\",\n    HttpSoapConnection.SOAP_12)\n  var session = new SoapService(cnx, \"nms:interaction\")\n  var action = request.parameters.a\n  if( action == undefined )\n    action = 'propose'","try\n  {\n    switch( action )\n    {\n    case \"update\":\n      var proposition = request.parameters.p\n      var status      = request.parameters.st\n      session.addMethod(\"UpdateStatus\", \"nms:interaction#UpdateStatus\",\n       [\"proposition\", \"string\",\n        \"status\",      \"string\",\n        \"context\",     \"NLElement\"],\n       [])\n      session.UpdateStatus(proposition, status, <undef/>)\n      var redirect = request.parameters.r\n      if( redirect != undefined )\n        response.sendRedirect(redirect)\n      break;","case \"propose\":\n      var count = request.parameters.n\n      var target = request.parameters.t\n      var categorie = request.parameters.c\n      var theme = request.parameters.th\n      var layout = request.parameters.l\n      if( count == undefined )\n        count = 1\n      session.addMethod(\"Propose\", \"nms:proposition#Propose\",\n       [\"targetId\",      \"string\",\n        \"maxCount\",      \"string\",\n         \"categories\",    \"string\",\n         \"themes\",        \"string\",\n        \"context\",       \"NLElement\"],\n       [\"interactionId\", \"string\",\n        \"propositions\",  \"NLElement\"])\n      response.setContentType(\"text/html\")\n      var result = session.Propose(target, count, category, theme, <empty/>)\n      var props = result[1]\n  %>TABLE: <%=propHtml%><%\n      break;\n    }\n  }\n  catch( e )\n  {\n  }\n  %>"]}]}